<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Node.js 内存溢出时如何处理？ | 小鱼儿的博客</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="专注 Node.js 技术栈分享，从前端到Node.js再到数据库">
    
    <link rel="preload" href="/fish-vuePress/assets/css/0.styles.af3f7b63.css" as="style"><link rel="preload" href="/fish-vuePress/assets/js/app.960c0ef0.js" as="script"><link rel="preload" href="/fish-vuePress/assets/js/2.a7c701b2.js" as="script"><link rel="preload" href="/fish-vuePress/assets/js/40.fb547904.js" as="script"><link rel="prefetch" href="/fish-vuePress/assets/js/10.0f78eb6c.js"><link rel="prefetch" href="/fish-vuePress/assets/js/11.ebb2487e.js"><link rel="prefetch" href="/fish-vuePress/assets/js/12.52e94379.js"><link rel="prefetch" href="/fish-vuePress/assets/js/13.b238cea8.js"><link rel="prefetch" href="/fish-vuePress/assets/js/14.e132b3a9.js"><link rel="prefetch" href="/fish-vuePress/assets/js/15.747d533b.js"><link rel="prefetch" href="/fish-vuePress/assets/js/16.89300b7c.js"><link rel="prefetch" href="/fish-vuePress/assets/js/17.59807920.js"><link rel="prefetch" href="/fish-vuePress/assets/js/18.033c9513.js"><link rel="prefetch" href="/fish-vuePress/assets/js/19.230b8053.js"><link rel="prefetch" href="/fish-vuePress/assets/js/20.6739e841.js"><link rel="prefetch" href="/fish-vuePress/assets/js/21.afb111cf.js"><link rel="prefetch" href="/fish-vuePress/assets/js/22.96d782d8.js"><link rel="prefetch" href="/fish-vuePress/assets/js/23.0e594180.js"><link rel="prefetch" href="/fish-vuePress/assets/js/24.83089fe6.js"><link rel="prefetch" href="/fish-vuePress/assets/js/25.1b0c69e3.js"><link rel="prefetch" href="/fish-vuePress/assets/js/26.3469729f.js"><link rel="prefetch" href="/fish-vuePress/assets/js/27.f5713fab.js"><link rel="prefetch" href="/fish-vuePress/assets/js/28.3179bddf.js"><link rel="prefetch" href="/fish-vuePress/assets/js/29.0634a80e.js"><link rel="prefetch" href="/fish-vuePress/assets/js/3.64273e08.js"><link rel="prefetch" href="/fish-vuePress/assets/js/30.be7de9c6.js"><link rel="prefetch" href="/fish-vuePress/assets/js/31.e12e497c.js"><link rel="prefetch" href="/fish-vuePress/assets/js/32.01f433b3.js"><link rel="prefetch" href="/fish-vuePress/assets/js/33.8c980b4a.js"><link rel="prefetch" href="/fish-vuePress/assets/js/34.5c86cb8a.js"><link rel="prefetch" href="/fish-vuePress/assets/js/35.8ab7c1e1.js"><link rel="prefetch" href="/fish-vuePress/assets/js/36.2af554d3.js"><link rel="prefetch" href="/fish-vuePress/assets/js/37.4be84427.js"><link rel="prefetch" href="/fish-vuePress/assets/js/38.100d1140.js"><link rel="prefetch" href="/fish-vuePress/assets/js/39.ac2efbc8.js"><link rel="prefetch" href="/fish-vuePress/assets/js/4.11763c94.js"><link rel="prefetch" href="/fish-vuePress/assets/js/41.01e9b61c.js"><link rel="prefetch" href="/fish-vuePress/assets/js/42.94a07f0c.js"><link rel="prefetch" href="/fish-vuePress/assets/js/43.870ca5e5.js"><link rel="prefetch" href="/fish-vuePress/assets/js/44.64c093ea.js"><link rel="prefetch" href="/fish-vuePress/assets/js/45.5211013b.js"><link rel="prefetch" href="/fish-vuePress/assets/js/46.617903de.js"><link rel="prefetch" href="/fish-vuePress/assets/js/47.b4a3f111.js"><link rel="prefetch" href="/fish-vuePress/assets/js/48.011d18bb.js"><link rel="prefetch" href="/fish-vuePress/assets/js/49.20176e8c.js"><link rel="prefetch" href="/fish-vuePress/assets/js/5.b81bfd52.js"><link rel="prefetch" href="/fish-vuePress/assets/js/50.b7b839e7.js"><link rel="prefetch" href="/fish-vuePress/assets/js/51.e5f693d3.js"><link rel="prefetch" href="/fish-vuePress/assets/js/52.a7f08211.js"><link rel="prefetch" href="/fish-vuePress/assets/js/53.bd2b6259.js"><link rel="prefetch" href="/fish-vuePress/assets/js/54.eeafd5e5.js"><link rel="prefetch" href="/fish-vuePress/assets/js/55.c0df0943.js"><link rel="prefetch" href="/fish-vuePress/assets/js/56.bda221f6.js"><link rel="prefetch" href="/fish-vuePress/assets/js/57.1269681d.js"><link rel="prefetch" href="/fish-vuePress/assets/js/58.1be0fc81.js"><link rel="prefetch" href="/fish-vuePress/assets/js/59.9a19628c.js"><link rel="prefetch" href="/fish-vuePress/assets/js/6.105fa903.js"><link rel="prefetch" href="/fish-vuePress/assets/js/60.91ad2234.js"><link rel="prefetch" href="/fish-vuePress/assets/js/61.b60f7bba.js"><link rel="prefetch" href="/fish-vuePress/assets/js/62.2242a8b4.js"><link rel="prefetch" href="/fish-vuePress/assets/js/63.bb037e58.js"><link rel="prefetch" href="/fish-vuePress/assets/js/64.d72385a9.js"><link rel="prefetch" href="/fish-vuePress/assets/js/65.0dffac94.js"><link rel="prefetch" href="/fish-vuePress/assets/js/66.8f0899ce.js"><link rel="prefetch" href="/fish-vuePress/assets/js/67.05f4fdf6.js"><link rel="prefetch" href="/fish-vuePress/assets/js/68.e8b0764e.js"><link rel="prefetch" href="/fish-vuePress/assets/js/69.5ca63ae9.js"><link rel="prefetch" href="/fish-vuePress/assets/js/7.514531c3.js"><link rel="prefetch" href="/fish-vuePress/assets/js/70.6c3cab07.js"><link rel="prefetch" href="/fish-vuePress/assets/js/71.853bc0af.js"><link rel="prefetch" href="/fish-vuePress/assets/js/72.8ea506b4.js"><link rel="prefetch" href="/fish-vuePress/assets/js/73.2082f443.js"><link rel="prefetch" href="/fish-vuePress/assets/js/74.1d1b1175.js"><link rel="prefetch" href="/fish-vuePress/assets/js/75.da23d668.js"><link rel="prefetch" href="/fish-vuePress/assets/js/76.00fae968.js"><link rel="prefetch" href="/fish-vuePress/assets/js/77.63525f78.js"><link rel="prefetch" href="/fish-vuePress/assets/js/78.88b6aafe.js"><link rel="prefetch" href="/fish-vuePress/assets/js/8.80131140.js"><link rel="prefetch" href="/fish-vuePress/assets/js/9.aa22e2f1.js">
    <link rel="stylesheet" href="/fish-vuePress/assets/css/0.styles.af3f7b63.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/fish-vuePress/" class="home-link router-link-active"><!----> <span class="site-name">小鱼儿的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/fish-vuePress/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="小鱼儿" class="dropdown-title"><span class="title">小鱼儿</span> <span class="arrow down"></span></button> <button type="button" aria-label="小鱼儿" class="mobile-dropdown-title"><span class="title">小鱼儿</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fish-vuePress/node-zy/" class="nav-link">
  node
</a></li></ul></div></div><div class="nav-item"><a href="/fish-vuePress/node/" class="nav-link router-link-active">
  node
</a></div><div class="nav-item"><a href="/fish-vuePress/webframe/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/fish-vuePress/database/" class="nav-link">
  数据库
</a></div><div class="nav-item"><a href="/fish-vuePress/android/" class="nav-link">
  android
</a></div><div class="nav-item"><a href="/fish-vuePress/interview/" class="nav-link">
  面试问题
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/fish-vuePress/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="小鱼儿" class="dropdown-title"><span class="title">小鱼儿</span> <span class="arrow down"></span></button> <button type="button" aria-label="小鱼儿" class="mobile-dropdown-title"><span class="title">小鱼儿</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fish-vuePress/node-zy/" class="nav-link">
  node
</a></li></ul></div></div><div class="nav-item"><a href="/fish-vuePress/node/" class="nav-link router-link-active">
  node
</a></div><div class="nav-item"><a href="/fish-vuePress/webframe/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/fish-vuePress/database/" class="nav-link">
  数据库
</a></div><div class="nav-item"><a href="/fish-vuePress/android/" class="nav-link">
  android
</a></div><div class="nav-item"><a href="/fish-vuePress/interview/" class="nav-link">
  面试问题
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/fish-vuePress/node/" aria-current="page" class="sidebar-link">node目录</a></li><li><a href="/fish-vuePress/node/what.html" class="sidebar-link">node.js究竟是什么</a></li><li><a href="/fish-vuePress/node/event_loop.html" class="sidebar-link">node事件循环</a></li><li><a href="/fish-vuePress/node/path.html" class="sidebar-link">node核心模块-path</a></li><li><a href="/fish-vuePress/node/module_fs.html" class="sidebar-link">node核心模块-fs</a></li><li><a href="/fish-vuePress/node/stream.html" class="sidebar-link">node核心模块-stream</a></li><li><a href="/fish-vuePress/node/buffer.html" class="sidebar-link">node核心模块-buffer</a></li><li><a href="/fish-vuePress/node/processAndThread.html" class="sidebar-link">深入理解进程与线程</a></li><li><a href="/fish-vuePress/node/queue.html" class="sidebar-link">Node.js中的消息队列</a></li><li><a href="/fish-vuePress/node/overflow.html" aria-current="page" class="active sidebar-link">Node.js 内存溢出时如何处理？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fish-vuePress/node/overflow.html#本文涵盖" class="sidebar-link">本文涵盖</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/node/overflow.html#_1-内存溢出问题" class="sidebar-link">1.内存溢出问题</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/node/overflow.html#密集型运算" class="sidebar-link">密集型运算</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/node/overflow.html#操作的数据量较大" class="sidebar-link">操作的数据量较大</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/node/overflow.html#_2-为什么会内存溢出" class="sidebar-link">2. 为什么会内存溢出</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/node/overflow.html#_3-解决内存溢出问题" class="sidebar-link">3. 解决内存溢出问题</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/node/overflow.html#node系列原创文章" class="sidebar-link">Node系列原创文章</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/node/overflow.html#关注我" class="sidebar-link">关注我</a></li></ul></li><li><a href="/fish-vuePress/node/events.html" class="sidebar-link">[源码解读]一文彻底搞懂Events模块</a></li><li><a href="/fish-vuePress/node/errors.html" class="sidebar-link">nodejs十个常见误区</a></li><li><a href="/fish-vuePress/node/AsyncIO.html" class="sidebar-link">Node 与底层之间如何执行异步 I/O 调用</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>Node.js 做密集型运算，或者所操作的数组、对象本身较大时，容易出现内存溢出的问题，这是由于 Node.js 的运行环境依赖 V8 引擎导致的。如果经常有较大数据量运算等操作，需要对 Node.js 运行环境限制有充分的了解。</p> <h2 id="本文涵盖"><a href="#本文涵盖" class="header-anchor">#</a> 本文涵盖</h2> <ol><li>内存溢出问题</li> <li>为什么会内存溢出
<ul><li>2.1 V8内存分配机制</li> <li>2.2 内存溢出的原因</li></ul></li> <li>如何解决内存溢出问题</li></ol> <blockquote><p>作者简介：koala，专注完整的 Node.js 技术栈分享，从 JavaScript 到 Node.js,再到后端数据库，祝您成为优秀的高级 Node.js 工程师。【程序员成长指北】作者，Github 博客开源项目 https://github.com/koala-coding/goodBlog</p></blockquote> <h2 id="_1-内存溢出问题"><a href="#_1-内存溢出问题" class="header-anchor">#</a> 1.内存溢出问题</h2> <p>下面是我们在Node.js应用中经常遇到的两类内存溢出问题：</p> <h2 id="密集型运算"><a href="#密集型运算" class="header-anchor">#</a> 密集型运算</h2> <p>示例1：当我们需要批量处理一些数据（如：更新用户某项信息）时，我们可能需要一个较大的for或while循环来完成所有的数据的更新，如：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> site <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        site<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'koala'</span><span class="token punctuation">;</span>
        site<span class="token punctuation">.</span>domain <span class="token operator">=</span> <span class="token string">'程序员成长指北'</span><span class="token punctuation">;</span>
        <span class="token comment">// 这里是一个保存或更新等操作</span>

        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> site<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="操作的数据量较大"><a href="#操作的数据量较大" class="header-anchor">#</a> 操作的数据量较大</h2> <p>示例2：对象需要频繁的创建/销毁，或操作对象本身较大，如：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> sites <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> x<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>x<span class="token operator">&lt;</span><span class="token number">5000</span><span class="token punctuation">;</span>x<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> site<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> y<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>y<span class="token operator">&lt;</span><span class="token number">5000</span><span class="token punctuation">;</span>y<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        site <span class="token operator">=</span> <span class="token punctuation">[</span>y<span class="token punctuation">,</span> <span class="token string">'koala'</span><span class="token punctuation">,</span> <span class="token string">'程序员成长指北'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        sites<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>site<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面两类操作都会出现类似以下错误：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span><span class="token operator">--</span><span class="token operator">-</span> Last few GCs <span class="token operator">--</span><span class="token operator">-</span><span class="token operator">&gt;</span>
……
<span class="token constant">FATAL</span> <span class="token constant">ERROR</span><span class="token operator">:</span> <span class="token constant">CALL_AND_RETRY_LAST</span> Allocation failed <span class="token operator">-</span> process out <span class="token keyword">of</span> memory
Abort trap<span class="token operator">:</span> <span class="token number">6</span>
</code></pre></div><h2 id="_2-为什么会内存溢出"><a href="#_2-为什么会内存溢出" class="header-anchor">#</a> 2. 为什么会内存溢出</h2> <h3 id="_2-1-v8内存分配机制"><a href="#_2-1-v8内存分配机制" class="header-anchor">#</a> 2.1 V8内存分配机制</h3> <p>我们都知道，V8是 Google 在 Chrome 浏览器中使用的 JavaScript 引擎。而在浏览器环境中，运算一般不需要多大内存。
V8 对每个进程分配的运行内存，在32位系统中约为700MB，而在64位系统中约为1.4GB。</p> <h3 id="_2-2-内存溢出的原因"><a href="#_2-2-内存溢出的原因" class="header-anchor">#</a> 2.2 内存溢出的原因</h3> <p>Node.js 程序之所以会出内存溢出的情况，可以分为三方面的原因：</p> <ul><li><ol><li>V8本身分配的内存较小</li></ol></li> <li><ol start="2"><li>JavaScript语言本身限制</li></ol></li> <li><ol start="3"><li>程序员使用不当。</li></ol></li></ul> <p>在示例1中，每次运算所需的内存量并不大，但由于for循环，造成V8内存不能及时释放。随着程序运行时候的增加，内存占用量会越来越大，并最终导致内存的溢出。</p> <p>在示例2中，可能所创建对象本身并没有超过内存限制。但是除对象本身外：创建对象、对象引用、Node.js程序本身等都需要内存空间，这样就很容易导致内存的溢出。</p> <h2 id="_3-解决内存溢出问题"><a href="#_3-解决内存溢出问题" class="header-anchor">#</a> 3. 解决内存溢出问题</h2> <p>在Node.js应用开发过程中，了解V8内存分配和JavaScript语言限制是Node程序的基本素质。我们应该在应用中权衡利弊，综合考虑内存与程序的运行效率。以下几点防止内存溢出的建议：</p> <h3 id="_3-1-使用-async-await防止事件堆积-变为同步操作"><a href="#_3-1-使用-async-await防止事件堆积-变为同步操作" class="header-anchor">#</a> 3.1. 使用 async/await防止事件堆积,变为同步操作</h3> <p>await将代码执行顺序变为了同步。这样可以使 V8 获得内存回收的机会，有效解决过多事件堆积造成的内存溢出。
我们可以使用await方法处理：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">dbFuc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> site <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    site<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'koala'</span><span class="token punctuation">;</span>
    site<span class="token punctuation">.</span>domain <span class="token operator">=</span> <span class="token string">'程序员成长指北'</span><span class="token punctuation">;</span>
    <span class="token comment">// 这里是一个保存或更新等操作</span>

    <span class="token keyword">await</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> site<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">dbFuc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>每次循环V8都会回收内存一次，因此内存不会再溢出。但这样做必然会造成运行效率的降低，而应该在速度在安全之间平衡，控制好循环的安全次数。
说明:实际开发中，上面这种虽然解决了内存溢出，但是仍然会造成进程阻塞，可以开启一个进程/线程来解决阻塞问题(具体可以看我的这篇文章<a href="https://juejin.im/post/5d43017be51d4561f40adcf9" target="_blank" rel="noopener noreferrer">《深入理解Node.js 进程与线程(8000长文彻底搞懂)》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)</p> <h3 id="_3-2-增加v8内存空间"><a href="#_3-2-增加v8内存空间" class="header-anchor">#</a> 3.2. 增加V8内存空间</h3> <p>Node.js提供了一个程序运行参数<code>--max-old-space-size</code>，可以通过该参数指定V8所占用的内存空间，这样可以在一定程度上避免程序内存的溢出。
如，我们可以在运行示例2程序时指定使用4G的内存：
<code>node --max-old-space-size=4096 app</code></p> <h3 id="_3-3-使用非v8内存"><a href="#_3-3-使用非v8内存" class="header-anchor">#</a> 3.3. 使用非V8内存</h3> <p>Node.js程序所使用的内存分为两类：</p> <ul><li>V8内存：数组、字符串等JavaScript内置对象，运行时使用“V8内存”</li> <li>系统内存：Buffer 是 Node.js 的一个扩展对象，使用底层的系统内存，不占用V8内存空间。与 buffer 相关的文件系统 fs 和stream 流操作，都不会占用 V8 内存。</li></ul> <blockquote><p>(注: fs 和 stream 这两个模块我在 Node 进阶系列文章中已经详细介绍了, 这里就不赘述)</p></blockquote> <p>在程序允许的情况下，应该将数据保存在Buffer中，而不是转换成字符串等JS对象，这样可以避免V8内存的过多占用。（buffer可以看一下这篇文章<a href="https://juejin.im/post/5d2db6d9f265da1bcc1975d7" target="_blank" rel="noopener noreferrer">《Node进阶-探究不在V8堆内存中存储的Buffer对象》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>）</p> <h2 id="node系列原创文章"><a href="#node系列原创文章" class="header-anchor">#</a> Node系列原创文章</h2> <p><a href="https://juejin.im/post/5d43017be51d4561f40adcf9" target="_blank" rel="noopener noreferrer">深入理解Node.js 中的进程与线程
<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://juejin.im/post/5d25ce36f265da1ba84ab97a" target="_blank" rel="noopener noreferrer">想学Node.js，stream先有必要搞清楚
<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://juejin.im/post/5d5639c7e51d453b5c1218b4" target="_blank" rel="noopener noreferrer">require时，exports和module.exports的区别你真的懂吗<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://juejin.im/post/5d69eef7f265da03f12e70a5" target="_blank" rel="noopener noreferrer">源码解读一文彻底搞懂Events模块
<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://juejin.im/post/5d3f1664e51d4561a34618c1" target="_blank" rel="noopener noreferrer">Node.js 高级进阶之 fs 文件模块学习
<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="关注我"><a href="#关注我" class="header-anchor">#</a> 关注我</h2> <ul><li>欢迎加我微信(coder_qi)，拉你进技术群，长期交流学习...</li> <li>欢迎关注「程序员成长指北」,一个用心帮助你成长的公众号...
<img src="http://img.xiaogangzai.cn/leading.png" alt=""></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/fish-vuePress/node/queue.html" class="prev">
        Node.js中的消息队列
      </a></span> <span class="next"><a href="/fish-vuePress/node/events.html">
        [源码解读]一文彻底搞懂Events模块
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/fish-vuePress/assets/js/app.960c0ef0.js" defer></script><script src="/fish-vuePress/assets/js/2.a7c701b2.js" defer></script><script src="/fish-vuePress/assets/js/40.fb547904.js" defer></script>
  </body>
</html>
