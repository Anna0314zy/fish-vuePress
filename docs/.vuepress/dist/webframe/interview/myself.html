<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>面试题总结 | 小鱼儿的博客</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="专注 Node.js 技术栈分享，从前端到Node.js再到数据库">
    
    <link rel="preload" href="/fish-vuePress/assets/css/0.styles.0de575c4.css" as="style"><link rel="preload" href="/fish-vuePress/assets/js/app.e38c1a38.js" as="script"><link rel="preload" href="/fish-vuePress/assets/js/4.47c64f60.js" as="script"><link rel="preload" href="/fish-vuePress/assets/js/113.ec95cc9c.js" as="script"><link rel="prefetch" href="/fish-vuePress/assets/js/10.c86ad536.js"><link rel="prefetch" href="/fish-vuePress/assets/js/100.759ca827.js"><link rel="prefetch" href="/fish-vuePress/assets/js/101.4bded0a8.js"><link rel="prefetch" href="/fish-vuePress/assets/js/102.d65e75b9.js"><link rel="prefetch" href="/fish-vuePress/assets/js/103.d88365ec.js"><link rel="prefetch" href="/fish-vuePress/assets/js/104.69a8c662.js"><link rel="prefetch" href="/fish-vuePress/assets/js/105.59e6d7e0.js"><link rel="prefetch" href="/fish-vuePress/assets/js/106.14dbbcea.js"><link rel="prefetch" href="/fish-vuePress/assets/js/107.d38478ec.js"><link rel="prefetch" href="/fish-vuePress/assets/js/108.db8ad882.js"><link rel="prefetch" href="/fish-vuePress/assets/js/109.8f587cf1.js"><link rel="prefetch" href="/fish-vuePress/assets/js/11.754b29d5.js"><link rel="prefetch" href="/fish-vuePress/assets/js/110.c5e894a3.js"><link rel="prefetch" href="/fish-vuePress/assets/js/111.2df69db0.js"><link rel="prefetch" href="/fish-vuePress/assets/js/112.728cf1ce.js"><link rel="prefetch" href="/fish-vuePress/assets/js/114.7431d85e.js"><link rel="prefetch" href="/fish-vuePress/assets/js/115.0b11823c.js"><link rel="prefetch" href="/fish-vuePress/assets/js/116.de262d5e.js"><link rel="prefetch" href="/fish-vuePress/assets/js/117.b4ff302e.js"><link rel="prefetch" href="/fish-vuePress/assets/js/118.fb6742d2.js"><link rel="prefetch" href="/fish-vuePress/assets/js/119.28604668.js"><link rel="prefetch" href="/fish-vuePress/assets/js/12.f04e1f1f.js"><link rel="prefetch" href="/fish-vuePress/assets/js/120.d703c437.js"><link rel="prefetch" href="/fish-vuePress/assets/js/121.ff692d5f.js"><link rel="prefetch" href="/fish-vuePress/assets/js/122.5207210d.js"><link rel="prefetch" href="/fish-vuePress/assets/js/123.b45ae2a4.js"><link rel="prefetch" href="/fish-vuePress/assets/js/124.e3ba7b0d.js"><link rel="prefetch" href="/fish-vuePress/assets/js/125.a90be7d2.js"><link rel="prefetch" href="/fish-vuePress/assets/js/126.e14a08e2.js"><link rel="prefetch" href="/fish-vuePress/assets/js/127.08c070b6.js"><link rel="prefetch" href="/fish-vuePress/assets/js/128.31684ed5.js"><link rel="prefetch" href="/fish-vuePress/assets/js/129.4c4c425a.js"><link rel="prefetch" href="/fish-vuePress/assets/js/13.9f4bb48a.js"><link rel="prefetch" href="/fish-vuePress/assets/js/130.c887a352.js"><link rel="prefetch" href="/fish-vuePress/assets/js/131.f00cc32c.js"><link rel="prefetch" href="/fish-vuePress/assets/js/132.46a6efdd.js"><link rel="prefetch" href="/fish-vuePress/assets/js/133.6e8821b8.js"><link rel="prefetch" href="/fish-vuePress/assets/js/134.c0016c2e.js"><link rel="prefetch" href="/fish-vuePress/assets/js/135.5906d1ca.js"><link rel="prefetch" href="/fish-vuePress/assets/js/136.a250c35a.js"><link rel="prefetch" href="/fish-vuePress/assets/js/137.838c25a1.js"><link rel="prefetch" href="/fish-vuePress/assets/js/138.04d6feca.js"><link rel="prefetch" href="/fish-vuePress/assets/js/139.99fc80a8.js"><link rel="prefetch" href="/fish-vuePress/assets/js/14.05d29434.js"><link rel="prefetch" href="/fish-vuePress/assets/js/140.5a894eb5.js"><link rel="prefetch" href="/fish-vuePress/assets/js/141.0da10d3c.js"><link rel="prefetch" href="/fish-vuePress/assets/js/142.fdc49fcd.js"><link rel="prefetch" href="/fish-vuePress/assets/js/143.c5ecdffa.js"><link rel="prefetch" href="/fish-vuePress/assets/js/144.127e53eb.js"><link rel="prefetch" href="/fish-vuePress/assets/js/145.6339ec5a.js"><link rel="prefetch" href="/fish-vuePress/assets/js/146.b72ef101.js"><link rel="prefetch" href="/fish-vuePress/assets/js/147.a3fdaba8.js"><link rel="prefetch" href="/fish-vuePress/assets/js/148.60641d79.js"><link rel="prefetch" href="/fish-vuePress/assets/js/15.dcbeae73.js"><link rel="prefetch" href="/fish-vuePress/assets/js/16.7c89b3f8.js"><link rel="prefetch" href="/fish-vuePress/assets/js/17.527e7d63.js"><link rel="prefetch" href="/fish-vuePress/assets/js/18.7377f0d6.js"><link rel="prefetch" href="/fish-vuePress/assets/js/19.f5ba7f79.js"><link rel="prefetch" href="/fish-vuePress/assets/js/2.4bfdb790.js"><link rel="prefetch" href="/fish-vuePress/assets/js/20.b2243522.js"><link rel="prefetch" href="/fish-vuePress/assets/js/21.242b4d91.js"><link rel="prefetch" href="/fish-vuePress/assets/js/22.edb03dd2.js"><link rel="prefetch" href="/fish-vuePress/assets/js/23.09942154.js"><link rel="prefetch" href="/fish-vuePress/assets/js/24.6b33d47e.js"><link rel="prefetch" href="/fish-vuePress/assets/js/25.e51c2d41.js"><link rel="prefetch" href="/fish-vuePress/assets/js/26.577501f9.js"><link rel="prefetch" href="/fish-vuePress/assets/js/27.ec96f26b.js"><link rel="prefetch" href="/fish-vuePress/assets/js/28.20187a02.js"><link rel="prefetch" href="/fish-vuePress/assets/js/29.666c814c.js"><link rel="prefetch" href="/fish-vuePress/assets/js/3.9d9f38a6.js"><link rel="prefetch" href="/fish-vuePress/assets/js/30.bc05f7f4.js"><link rel="prefetch" href="/fish-vuePress/assets/js/31.3d280341.js"><link rel="prefetch" href="/fish-vuePress/assets/js/32.fdeaae53.js"><link rel="prefetch" href="/fish-vuePress/assets/js/33.9389c9ae.js"><link rel="prefetch" href="/fish-vuePress/assets/js/34.729b9efa.js"><link rel="prefetch" href="/fish-vuePress/assets/js/35.85bc9fac.js"><link rel="prefetch" href="/fish-vuePress/assets/js/36.464db47b.js"><link rel="prefetch" href="/fish-vuePress/assets/js/37.304de13a.js"><link rel="prefetch" href="/fish-vuePress/assets/js/38.a6f8671e.js"><link rel="prefetch" href="/fish-vuePress/assets/js/39.c7e19da5.js"><link rel="prefetch" href="/fish-vuePress/assets/js/40.fcb99a2f.js"><link rel="prefetch" href="/fish-vuePress/assets/js/41.6ca6eb36.js"><link rel="prefetch" href="/fish-vuePress/assets/js/42.f5056026.js"><link rel="prefetch" href="/fish-vuePress/assets/js/43.96291ec5.js"><link rel="prefetch" href="/fish-vuePress/assets/js/44.8436df96.js"><link rel="prefetch" href="/fish-vuePress/assets/js/45.39dc596b.js"><link rel="prefetch" href="/fish-vuePress/assets/js/46.0e73ce90.js"><link rel="prefetch" href="/fish-vuePress/assets/js/47.518dd04b.js"><link rel="prefetch" href="/fish-vuePress/assets/js/48.f36a449a.js"><link rel="prefetch" href="/fish-vuePress/assets/js/49.39d6e895.js"><link rel="prefetch" href="/fish-vuePress/assets/js/5.92e70f46.js"><link rel="prefetch" href="/fish-vuePress/assets/js/50.70b27645.js"><link rel="prefetch" href="/fish-vuePress/assets/js/51.e03f1f19.js"><link rel="prefetch" href="/fish-vuePress/assets/js/52.b6e55d8a.js"><link rel="prefetch" href="/fish-vuePress/assets/js/53.3730ee57.js"><link rel="prefetch" href="/fish-vuePress/assets/js/54.f2f22eee.js"><link rel="prefetch" href="/fish-vuePress/assets/js/55.b6c04cef.js"><link rel="prefetch" href="/fish-vuePress/assets/js/56.dd65b0d6.js"><link rel="prefetch" href="/fish-vuePress/assets/js/57.71e5285b.js"><link rel="prefetch" href="/fish-vuePress/assets/js/58.00297228.js"><link rel="prefetch" href="/fish-vuePress/assets/js/59.8d3ec4fa.js"><link rel="prefetch" href="/fish-vuePress/assets/js/6.7f1d02bc.js"><link rel="prefetch" href="/fish-vuePress/assets/js/60.dc481572.js"><link rel="prefetch" href="/fish-vuePress/assets/js/61.2b7311e6.js"><link rel="prefetch" href="/fish-vuePress/assets/js/62.54467563.js"><link rel="prefetch" href="/fish-vuePress/assets/js/63.f7739a24.js"><link rel="prefetch" href="/fish-vuePress/assets/js/64.ea92fd67.js"><link rel="prefetch" href="/fish-vuePress/assets/js/65.64813ff6.js"><link rel="prefetch" href="/fish-vuePress/assets/js/66.2c6c49f1.js"><link rel="prefetch" href="/fish-vuePress/assets/js/67.ed60e5c9.js"><link rel="prefetch" href="/fish-vuePress/assets/js/68.87948def.js"><link rel="prefetch" href="/fish-vuePress/assets/js/69.51414141.js"><link rel="prefetch" href="/fish-vuePress/assets/js/7.5066cb77.js"><link rel="prefetch" href="/fish-vuePress/assets/js/70.933862e1.js"><link rel="prefetch" href="/fish-vuePress/assets/js/71.394703c7.js"><link rel="prefetch" href="/fish-vuePress/assets/js/72.7b500072.js"><link rel="prefetch" href="/fish-vuePress/assets/js/73.52593ae5.js"><link rel="prefetch" href="/fish-vuePress/assets/js/74.6f25fbb4.js"><link rel="prefetch" href="/fish-vuePress/assets/js/75.9f29b3cc.js"><link rel="prefetch" href="/fish-vuePress/assets/js/76.690b7ad7.js"><link rel="prefetch" href="/fish-vuePress/assets/js/77.0c6ea2b4.js"><link rel="prefetch" href="/fish-vuePress/assets/js/78.319bd089.js"><link rel="prefetch" href="/fish-vuePress/assets/js/79.df0dfc28.js"><link rel="prefetch" href="/fish-vuePress/assets/js/8.f9028607.js"><link rel="prefetch" href="/fish-vuePress/assets/js/80.d1f63bac.js"><link rel="prefetch" href="/fish-vuePress/assets/js/81.e1cf6dc5.js"><link rel="prefetch" href="/fish-vuePress/assets/js/82.fafff4c2.js"><link rel="prefetch" href="/fish-vuePress/assets/js/83.f33da300.js"><link rel="prefetch" href="/fish-vuePress/assets/js/84.9348707d.js"><link rel="prefetch" href="/fish-vuePress/assets/js/85.7ace8919.js"><link rel="prefetch" href="/fish-vuePress/assets/js/86.0d8934a6.js"><link rel="prefetch" href="/fish-vuePress/assets/js/87.78b06dda.js"><link rel="prefetch" href="/fish-vuePress/assets/js/88.4da01134.js"><link rel="prefetch" href="/fish-vuePress/assets/js/89.9fc01a7f.js"><link rel="prefetch" href="/fish-vuePress/assets/js/9.27f97ad6.js"><link rel="prefetch" href="/fish-vuePress/assets/js/90.8684053a.js"><link rel="prefetch" href="/fish-vuePress/assets/js/91.46ffb1f5.js"><link rel="prefetch" href="/fish-vuePress/assets/js/92.313cf08a.js"><link rel="prefetch" href="/fish-vuePress/assets/js/93.c2643a36.js"><link rel="prefetch" href="/fish-vuePress/assets/js/94.f3055a01.js"><link rel="prefetch" href="/fish-vuePress/assets/js/95.940056d7.js"><link rel="prefetch" href="/fish-vuePress/assets/js/96.43739845.js"><link rel="prefetch" href="/fish-vuePress/assets/js/97.e243aa4a.js"><link rel="prefetch" href="/fish-vuePress/assets/js/98.561f7a88.js"><link rel="prefetch" href="/fish-vuePress/assets/js/99.921a1c32.js">
    <link rel="stylesheet" href="/fish-vuePress/assets/css/0.styles.0de575c4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/fish-vuePress/" class="home-link router-link-active"><!----> <span class="site-name">小鱼儿的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/fish-vuePress/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/fish-vuePress/node-quick/" class="nav-link">
  node
</a></div><div class="nav-item"><a href="/fish-vuePress/webframe/" class="nav-link router-link-active">
  前端基础
</a></div><div class="nav-item"><a href="/fish-vuePress/vue-quick/" class="nav-link">
  快速掌握vue
</a></div><div class="nav-item"><a href="/fish-vuePress/database/" class="nav-link">
  数据库
</a></div><div class="nav-item"><a href="/fish-vuePress/react/" class="nav-link">
  react
</a></div><div class="nav-item"><a href="/fish-vuePress/webpack/" class="nav-link">
  webpack
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/fish-vuePress/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/fish-vuePress/node-quick/" class="nav-link">
  node
</a></div><div class="nav-item"><a href="/fish-vuePress/webframe/" class="nav-link router-link-active">
  前端基础
</a></div><div class="nav-item"><a href="/fish-vuePress/vue-quick/" class="nav-link">
  快速掌握vue
</a></div><div class="nav-item"><a href="/fish-vuePress/database/" class="nav-link">
  数据库
</a></div><div class="nav-item"><a href="/fish-vuePress/react/" class="nav-link">
  react
</a></div><div class="nav-item"><a href="/fish-vuePress/webpack/" class="nav-link">
  webpack
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/fish-vuePress/webframe/" aria-current="page" class="sidebar-link">前端</a></li><li><a href="/fish-vuePress/webframe/javascript/promise.html" class="sidebar-link">深度了解promise</a></li><li><a href="/fish-vuePress/webframe/js/regexp.html" class="sidebar-link">正则</a></li><li><a href="/fish-vuePress/webframe/js/JS2.html" class="sidebar-link">js数据类型</a></li><li><a href="/fish-vuePress/webframe/js/math.html" class="sidebar-link">前端算法</a></li><li><a href="/fish-vuePress/webframe/js/modules.html" class="sidebar-link">其他</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>javascript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>es6</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>tool</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>面试题</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fish-vuePress/webframe/interview/css.html" class="sidebar-link">面试题-CSS篇</a></li><li><a href="/fish-vuePress/webframe/interview/js10.html" class="sidebar-link">面试题-JS篇</a></li><li><a href="/fish-vuePress/webframe/interview/unique.html" class="sidebar-link">如何答一道惊艳面试官的数组去重问题？</a></li><li><a href="/fish-vuePress/webframe/interview/rewriteJs.html" class="sidebar-link">手写代码[`编程`]</a></li><li><a href="/fish-vuePress/webframe/interview/vue.html" class="sidebar-link">vue篇</a></li><li><a href="/fish-vuePress/webframe/interview/project.html" class="sidebar-link">项目实战篇</a></li><li><a href="/fish-vuePress/webframe/interview/promise.html" class="sidebar-link">promise</a></li><li><a href="/fish-vuePress/webframe/interview/api.html" class="sidebar-link">如何处理异步并发</a></li><li><a href="/fish-vuePress/webframe/interview/JS3.html" class="sidebar-link">前端底层的实现</a></li><li><a href="/fish-vuePress/webframe/interview/questions.html" class="sidebar-link">代码题</a></li><li><a href="/fish-vuePress/webframe/interview/myself.html" aria-current="page" class="active sidebar-link">面试总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#浏览器渲染" class="sidebar-link">浏览器渲染</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#script-标签-调整加载顺序提升渲染速度" class="sidebar-link">script 标签：调整加载顺序提升渲染速度</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#link-标签-通过预处理提升渲染速度" class="sidebar-link">link 标签：通过预处理提升渲染速度</a></li></ul></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#mvc-和-mvvm-区别" class="sidebar-link">MVC 和 MVVM 区别</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#组件间如何通信" class="sidebar-link">组件间如何通信</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#_3-vue的双向绑定原理" class="sidebar-link">3.vue的双向绑定原理</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#浏览器-渲染" class="sidebar-link">浏览器 渲染</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#http" class="sidebar-link">http</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#强缓存-和-协商缓存" class="sidebar-link">强缓存 和 协商缓存</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#set" class="sidebar-link">$set</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#dipatch" class="sidebar-link">$dipatch</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#vue的模板解析" class="sidebar-link">vue的模板解析</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#代码生成器" class="sidebar-link">代码生成器</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#axios" class="sidebar-link">axios</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#vuex" class="sidebar-link">vuex</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#对vuex的理解" class="sidebar-link">对vueX的理解</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#vue和react的不同" class="sidebar-link">Vue和React的不同</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#react-hooks" class="sidebar-link">react-hooks</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#_3-vue的双向绑定原理-2" class="sidebar-link">3.vue的双向绑定原理</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#浏览器-渲染-2" class="sidebar-link">浏览器 渲染</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#http-2" class="sidebar-link">http</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#强缓存-和-协商缓存-2" class="sidebar-link">强缓存 和 协商缓存</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#bind-call-apply-的区别" class="sidebar-link">bind call apply 的区别</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#浏览器加载js-和-css" class="sidebar-link">浏览器加载js 和 css</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#set-2" class="sidebar-link">$set</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#instaceof" class="sidebar-link">instaceOf</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#dipatch-2" class="sidebar-link">$dipatch</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#vue的模板解析-2" class="sidebar-link">vue的模板解析</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#代码生成器-2" class="sidebar-link">代码生成器</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#axios-2" class="sidebar-link">axios</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#vuex-2" class="sidebar-link">vuex</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#对vuex的理解-2" class="sidebar-link">对vueX的理解</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#vue和react的不同-2" class="sidebar-link">Vue和React的不同</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#react-hooks-2" class="sidebar-link">react-hooks</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#redux" class="sidebar-link">redux</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#componse" class="sidebar-link">componse</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#api限制并发" class="sidebar-link">api限制并发</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#componse-2" class="sidebar-link">componse</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#性能优化" class="sidebar-link">性能优化</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#reduce" class="sidebar-link">reduce</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#vue-router" class="sidebar-link">vue-router</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#异步组件" class="sidebar-link">异步组件</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#表头固定" class="sidebar-link">表头固定</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#树形结构生成" class="sidebar-link">树形结构生成</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#算法" class="sidebar-link">算法</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#require" class="sidebar-link">require</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#events" class="sidebar-link">events</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#如何实现图片压缩" class="sidebar-link">如何实现图片压缩</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#webpack-项目体积过大-怎么优化" class="sidebar-link">webpack 项目体积过大 怎么优化</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#如何实现请求并发" class="sidebar-link">如何实现请求并发</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#promise-all-的原理" class="sidebar-link">Promise.all 的原理</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#如何实现虚拟滚动" class="sidebar-link">如何实现虚拟滚动</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#webpack优化" class="sidebar-link">webpack优化</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#redux-2" class="sidebar-link">redux</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#componse-3" class="sidebar-link">componse</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#api限制并发-2" class="sidebar-link">api限制并发</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#componse-4" class="sidebar-link">componse</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#性能优化-2" class="sidebar-link">性能优化</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#reduce-2" class="sidebar-link">reduce</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#vue-router-2" class="sidebar-link">vue-router</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#异步组件-2" class="sidebar-link">异步组件</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#表头固定-2" class="sidebar-link">表头固定</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#树形结构生成-2" class="sidebar-link">树形结构生成</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#require-2" class="sidebar-link">require</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#events源码模拟" class="sidebar-link">events源码模拟</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#如何实现图片压缩-2" class="sidebar-link">如何实现图片压缩</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#webpack-项目体积过大-怎么优化-2" class="sidebar-link">webpack 项目体积过大 怎么优化</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#如何实现请求并发-2" class="sidebar-link">如何实现请求并发</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#promise-all-的原理-2" class="sidebar-link">Promise.all 的原理</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#如何实现虚拟滚动-2" class="sidebar-link">如何实现虚拟滚动</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/interview/myself.html#webpack优化-2" class="sidebar-link">webpack优化</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="浏览器渲染"><a href="#浏览器渲染" class="header-anchor">#</a> 浏览器渲染</h2> <p>性能优化是前端开发中避不开的问题，性能问题无外乎两方面原因：渲染速度慢、请求时间长。性能优化虽然涉及很多复杂的原因和解决方案，但其实只要通过合理地使用标签，就可以在一定程度上提升渲染速度以及减少请求时间。</p> <h3 id="script-标签-调整加载顺序提升渲染速度"><a href="#script-标签-调整加载顺序提升渲染速度" class="header-anchor">#</a> script 标签：调整加载顺序提升渲染速度</h3> <p>由于浏览器的底层运行机制，渲染引擎在解析 HTML 时，若遇到 script 标签引用文件，则会暂停解析过程，同时通知网络线程加载文件，文件加载后会切换至 JavaScript 引擎来执行对应代码，代码执行完成之后切换至渲染引擎继续渲染页面。</p> <p>在这一过程中可以看到，页面渲染过程中包含了请求文件以及执行文件的时间，但页面的首次渲染可能并不依赖这些文件，这些请求和执行文件的动作反而延长了用户看到页面的时间，从而降低了用户体验。</p> <p>为了减少这些时间损耗，可以借助 script 标签的 3 个属性来实现。</p> <ul><li><p>async 属性。立即请求文件，但不阻塞渲染引擎，而是文件加载完毕后阻塞渲染引擎并立即执行文件内容。</p></li> <li><p>defer 属性。立即请求文件，但不阻塞渲染引擎，等到解析完 HTML 之后再执行文件内容。</p></li> <li><p>HTML5 标准 type 属性，对应值为“module”。让浏览器按照 ECMA Script 6 标准将文件当作模块进行解析，默认阻塞效果同 defer，也可以配合 async 在请求完成后立即执行。</p></li></ul> <p>从图中可以得知，采用 3 种属性都能减少请求文件引起的阻塞时间，只有 defer 属性以及 type=&quot;module&quot; 情况下能保证渲染引擎的优先执行，从而减少执行文件内容消耗的时间，让用户更快地看见页面（即使这些页面内容可能并没有完全地显示）。</p> <p>除此之外还应当注意，当渲染引擎解析 HTML 遇到 script 标签引入文件时，会立即进行一次渲染。所以这也就是为什么构建工具会把编译好的引用 JavaScript 代码的 script 标签放入到 body 标签底部，因为当渲染引擎执行到 body 底部时会先将已解析的内容渲染出来，然后再去请求相应的 JavaScript 文件。如果是内联脚本（即不通过 src 属性引用外部脚本文件直接在 HTML 编写 JavaScript 代码的形式），渲染引擎则不会渲染。</p> <h3 id="link-标签-通过预处理提升渲染速度"><a href="#link-标签-通过预处理提升渲染速度" class="header-anchor">#</a> link 标签：通过预处理提升渲染速度</h3> <ul><li><p>dns-prefetch。当 link 标签的 rel 属性值为“dns-prefetch”时，浏览器会对某个域名预先进行 DNS 解析并缓存。这样，当浏览器在请求同域名资源的时候，能省去从域名查询 IP 的过程，从而减少时间损耗。下图是淘宝网设置的 DNS 预解析。</p></li> <li><p>preconnect。让浏览器在一个 HTTP 请求正式发给服务器前预先执行一些操作，这包括 DNS 解析、TLS 协商、TCP 握手，通过消除往返延迟来为用户节省时间。</p></li> <li><p>prefetch/preload。两个值都是让浏览器预先下载并缓存某个资源，但不同的是，prefetch 可能会在浏览器忙时被忽略，而 preload 则是一定会被预先下载。</p></li> <li><p>prerender。浏览器不仅会加载资源，还会解析执行页面，进行预渲染。</p></li></ul> <h2 id="mvc-和-mvvm-区别"><a href="#mvc-和-mvvm-区别" class="header-anchor">#</a> MVC 和 MVVM 区别</h2> <p>传统的 MVC 指的是,用户操作会请求服务端路由，路由会调用对应的控制器来处理,控制器会获取数 据。将结果返回给前端,页面重新渲染
MVVM :传统的前端会将数据手动渲染到页面上, MVVM 模式不需要用户收到操作 dom 元素,
将数据绑 定到 viewModel 层上，会自动将数据渲染到页面中，
视图变化会通知 viewModel层 更新数据。 ViewModel 就是我们 MVVM 模式中的桥梁.
Vue并没有完全遵循MVVM模型，严格的MVVM模式中,View层不能直接和Model层通信,只能通过ViewModel来进行通信。</p> <h2 id="组件间如何通信"><a href="#组件间如何通信" class="header-anchor">#</a> 组件间如何通信</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">broadcast</span><span class="token punctuation">(</span><span class="token parameter">componentName<span class="token punctuation">,</span> eventName<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">child</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> name <span class="token operator">=</span> child<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>componentName<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">===</span> componentName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      child<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> <span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">broadcast</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> <span class="token punctuation">[</span>componentName<span class="token punctuation">,</span> eventName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>params<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token parameter">componentName<span class="token punctuation">,</span> eventName<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> parent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$parent <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$root<span class="token punctuation">;</span>
      <span class="token keyword">var</span> name <span class="token operator">=</span> parent<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>componentName<span class="token punctuation">;</span>

      <span class="token keyword">while</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>name <span class="token operator">||</span> name <span class="token operator">!==</span> componentName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        parent <span class="token operator">=</span> parent<span class="token punctuation">.</span>$parent<span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          name <span class="token operator">=</span> parent<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>componentName<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        parent<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">broadcast</span><span class="token punctuation">(</span><span class="token parameter">componentName<span class="token punctuation">,</span> eventName<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">broadcast</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> componentName<span class="token punctuation">,</span> eventName<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_3-vue的双向绑定原理"><a href="#_3-vue的双向绑定原理" class="header-anchor">#</a> 3.vue的双向绑定原理</h2> <p>数据---&gt;驱动视图</p> <p>视图改变去驱动数据</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//手写vue的数据双向绑定原理</span>

<span class="token comment">// import { nextTick } from &quot;../util&quot;;</span>

<span class="token comment">// 原理 new Vue 对申明在data里的数据 每一项声明 getter 和 Setter </span>

<span class="token comment">//数组观测是改写数组原型改写 切片编程 加一些逻辑 </span>

<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'zy'</span><span class="token punctuation">,</span>
    obj<span class="token operator">:</span><span class="token punctuation">{</span>
        name<span class="token operator">:</span><span class="token string">'li'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    arr<span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            name<span class="token operator">:</span><span class="token string">'zou'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> oldPrototype <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>

<span class="token keyword">let</span> arraryProtype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>oldPrototype<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> methods <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'shift'</span><span class="token punctuation">,</span>
    <span class="token string">'unshift'</span><span class="token punctuation">,</span>
    <span class="token string">'pop'</span><span class="token punctuation">,</span>
    <span class="token string">'push'</span><span class="token punctuation">,</span>
    <span class="token string">'reverse'</span><span class="token punctuation">,</span>
    <span class="token string">'splice'</span>

<span class="token punctuation">]</span>

methods<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">method</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    arraryProtype<span class="token punctuation">[</span>method<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       oldPrototype<span class="token punctuation">[</span>method<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span>args<span class="token punctuation">)</span>
       <span class="token keyword">let</span> inserted<span class="token punctuation">;</span>
       <span class="token keyword">let</span> ob <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__ob__<span class="token punctuation">;</span>
       <span class="token keyword">switch</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">case</span> <span class="token string">'unshift'</span><span class="token operator">:</span>
           <span class="token keyword">case</span> <span class="token string">'push'</span><span class="token operator">:</span>
            inserted <span class="token operator">=</span> args<span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token string">'splice'</span><span class="token operator">:</span>
            inserted <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>inserted<span class="token punctuation">,</span><span class="token string">'inserted'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>inserted<span class="token punctuation">)</span> ob<span class="token punctuation">.</span><span class="token function">observeArray</span><span class="token punctuation">(</span>inserted<span class="token punctuation">)</span><span class="token punctuation">;</span>

       ob<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Observe</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span><span class="token string">'__ob__'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
            value<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">,</span>
            enumerable<span class="token operator">:</span><span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            data<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> arraryProtype<span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">walk</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
    <span class="token function">walk</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">defineReative</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span>key<span class="token punctuation">,</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">observeArray</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        value<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token function">observe</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 观测数组中的对象类型</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数组修改了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">observe</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//观测数据变化</span>
<span class="token keyword">function</span> <span class="token function">observe</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> data <span class="token operator">!==</span><span class="token string">'object'</span> <span class="token operator">&amp;&amp;</span> data <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>__ob__<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> data<span class="token punctuation">.</span>__ob__<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Observe</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">defineReative</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span>key<span class="token punctuation">,</span>value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">observe</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>

    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span>key<span class="token punctuation">,</span><span class="token punctuation">{</span>
        <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> value
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">set</span><span class="token punctuation">(</span>newVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'更新了---'</span><span class="token punctuation">)</span>
            value <span class="token operator">=</span> newVal

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>
data<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'ppp'</span>
<span class="token comment">// data.obj.name= 'pppp'</span>
data<span class="token punctuation">.</span>arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span><span class="token string">'ppp'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//数据驱动视图  视图更改影响数据</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">const</span> toProxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 存放被代理过的对象</span>
<span class="token keyword">const</span> toRaw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 存放已经代理过的对</span>
<span class="token keyword">function</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// 创建响应式对象</span>
  <span class="token keyword">return</span> <span class="token function">createReactiveObject</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">isObject</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">typeof</span> target <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">&amp;&amp;</span> target<span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">hasOwn</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span>key</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> target<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">createReactiveObject</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// 判断target是不是对象,不是对象不必继续</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isObject</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> target<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
 
  <span class="token keyword">let</span> observed <span class="token operator">=</span> toProxy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>observed<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 判断是否被代理过</span>
    <span class="token keyword">return</span> observed<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>toRaw<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 判断是否要重复代理</span>
    <span class="token keyword">return</span> target<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> handlers <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>key<span class="token punctuation">,</span>receiver<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 取值</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;获取&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> res <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">isObject</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// 懒代理，只有当取值时再次做代理，vue2.0中一上来就会全部递归增加getter,setter</span>
        <span class="token operator">?</span> <span class="token function">reactive</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">:</span> res<span class="token punctuation">;</span>
    
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>key<span class="token punctuation">,</span>value<span class="token punctuation">,</span>receiver<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 更改 、 新增属性</span>
        <span class="token keyword">let</span> oldValue <span class="token operator">=</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 获取上次的值</span>
        <span class="token keyword">let</span> hadKey <span class="token operator">=</span> <span class="token function">hasOwn</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 看这个属性是否存在</span>
        <span class="token keyword">let</span> result <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>hadKey<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 新增属性</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'更新 添加'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>oldValue <span class="token operator">!==</span> value<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 修改存在的属性</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'更新 修改'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 当调用push 方法第一次修改时数组长度已经发生变化</span>
        <span class="token comment">// 如果这次的值和上次的值一样则不触发更新</span>
    
          <span class="token keyword">return</span> result<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">deleteProperty</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span>key</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 删除属性</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'删除'</span><span class="token punctuation">)</span>
          <span class="token keyword">const</span> result <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">deleteProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> result<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 开始代理</span>
  observed <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>handlers<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> observed<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token string">'youxuan'</span><span class="token punctuation">,</span>obj<span class="token operator">:</span><span class="token punctuation">{</span>a<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>obj<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取</span>

<span class="token comment">// p.name = 'webyouxuan'; // 设置</span>
<span class="token comment">// p.age = 10</span>
p<span class="token punctuation">.</span>obj<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">10</span>
<span class="token keyword">delete</span> p<span class="token punctuation">.</span>name<span class="token punctuation">;</span> <span class="token comment">// 删除</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="浏览器-渲染"><a href="#浏览器-渲染" class="header-anchor">#</a> 浏览器 渲染</h2> <p>性能优化
性能优化是前端开发中避不开的问题，性能问题无外乎两方面原因：渲染速度慢、请求时间长。性能优化虽然涉及很多复杂的原因和解决方案，但其实只要通过合理地使用标签，就可以在一定程度上提升渲染速度以及减少请求时间。</p> <p>script 标签：调整加载顺序提升渲染速度
由于浏览器的底层运行机制，渲染引擎在解析 HTML 时，若遇到 script 标签引用文件，则会暂停解析过程，同时通知网络线程加载文件，文件加载后会切换至 JavaScript 引擎来执行对应代码，代码执行完成之后切换至渲染引擎继续渲染页面。</p> <p>在这一过程中可以看到，页面渲染过程中包含了请求文件以及执行文件的时间，但页面的首次渲染可能并不依赖这些文件，这些请求和执行文件的动作反而延长了用户看到页面的时间，从而降低了用户体验。</p> <p>为了减少这些时间损耗，可以借助 script 标签的 3 个属性来实现。</p> <p>async 属性。立即请求文件，但不阻塞渲染引擎，而是文件加载完毕后阻塞渲染引擎并立即执行文件内容。</p> <p>defer 属性。立即请求文件，但不阻塞渲染引擎，等到解析完 HTML 之后再执行文件内容。</p> <p>HTML5 标准 type 属性，对应值为“module”。让浏览器按照 ECMA Script 6 标准将文件当作模块进行解析，默认阻塞效果同 defer，也可以配合 async 在请求完成后立即执行。</p> <p>从图中可以得知，采用 3 种属性都能减少请求文件引起的阻塞时间，只有 defer 属性以及 type=&quot;module&quot; 情况下能保证渲染引擎的优先执行，从而减少执行文件内容消耗的时间，让用户更快地看见页面（即使这些页面内容可能并没有完全地显示）。</p> <p>除此之外还应当注意，当渲染引擎解析 HTML 遇到 script 标签引入文件时，会立即进行一次渲染。所以这也就是为什么构建工具会把编译好的引用 JavaScript 代码的 script 标签放入到 body 标签底部，因为当渲染引擎执行到 body 底部时会先将已解析的内容渲染出来，然后再去请求相应的 JavaScript 文件。如果是内联脚本（即不通过 src 属性引用外部脚本文件直接在 HTML 编写 JavaScript 代码的形式），渲染引擎则不会渲染。</p> <p>link 标签：通过预处理提升渲染速度
dns-prefetch。当 link 标签的 rel 属性值为“dns-prefetch”时，浏览器会对某个域名预先进行 DNS 解析并缓存。这样，当浏览器在请求同域名资源的时候，能省去从域名查询 IP 的过程，从而减少时间损耗。下图是淘宝网设置的 DNS 预解析。</p> <p>preconnect。让浏览器在一个 HTTP 请求正式发给服务器前预先执行一些操作，这包括 DNS 解析、TLS 协商、TCP 握手，通过消除往返延迟来为用户节省时间。</p> <p>prefetch/preload。两个值都是让浏览器预先下载并缓存某个资源，但不同的是，prefetch 可能会在浏览器忙时被忽略，而 preload 则是一定会被预先下载。</p> <p>prerender。浏览器不仅会加载资源，还会解析执行页面，进行预渲染。</p> <h2 id="http"><a href="#http" class="header-anchor">#</a> http</h2> <p>协议版本	解决的核心问题	解决方式
0.9	HTML 文件传输	确立了客户端请求、服务端响应的通信流程
1.0	不同类型文件传输	设立头部字段
1.1	创建/断开 TCP 连接开销大	建立长连接进行复用
2	并发数有限	二进制分帧
3	TCP 丢包阻塞	采用 UDP 协议</p> <h2 id="强缓存-和-协商缓存"><a href="#强缓存-和-协商缓存" class="header-anchor">#</a> 强缓存 和 协商缓存</h2> <p>需要注意的是，cache-control 的 max-age 优先级高于 Expires，也就是说如果它们同时出现，浏览器会使用 max-age 的值。</p> <p>http 1.0 Expires</p> <p>http 1.1 Cache-Control</p> <p>no-cache，表示使用协商缓存，即每次使用缓存前必须向服务端确认缓存资源是否更新；</p> <p>no-store，禁止浏览器以及所有中间缓存存储响应内容；</p> <p>public，公有缓存，表示可以被代理服务器缓存，可以被多个用户共享；</p> <p>private，私有缓存，不能被代理服务器缓存，不可以被多个用户共享；</p> <p>max-age，以秒为单位的数值，表示缓存的有效时间；</p> <p>must-revalidate，当缓存过期时，需要去服务端校验缓存的有效性。</p> <p>需要注意的是，cache-control 的 max-age 优先级高于 Expires，也就是说如果它们同时出现，浏览器会使用 max-age 的值。</p> <p>cache-control: public, max-age=31536000</p> <p>协商缓存</p> <p>协商缓存的更新策略是不再指定缓存的有效时间了，而是浏览器直接发送请求到服务端进行确认缓存是否更新，如果请求响应返回的 HTTP 状态为 304，则表示缓存仍然有效。控制缓存的难题就是从浏览器端转移到了服务端。</p> <ol><li>Last-Modified 和 If-Modified-Since</li></ol> <p>服务端要判断缓存有没有过期，只能将双方的资源进行对比。若浏览器直接把资源文件发送给服务端进行比对的话，网络开销太大，而且也会失去缓存的意义，所以显然是不可取的。有一种简单的判断方法，那就是通过响应头部字段 Last-Modified 和请求头部字段 If-Modified-Since 比对双方资源的修改时间。</p> <p>具体工作流程如下：</p> <p>浏览器第一次请求资源，服务端在返回资源的响应头中加入 Last-Modified 字段，该字段表示这个资源在服务端上的最近修改时间；</p> <p>当浏览器再次向服务端请求该资源时，请求头部带上之前服务端返回的修改时间，这个请求头叫 If-Modified-Since；</p> <p>服务端再次收到请求，根据请求头 If-Modified-Since 的值，判断相关资源是否有变化，如果没有，则返回 304 Not Modified，并且不返回资源内容，浏览器使用资源缓存值；否则正常返回资源内容，且更新 Last-Modified 响应头内容。</p> <p>这种方式虽然能判断缓存是否失效，但也存在两个问题：</p> <p>精度问题，Last-Modified 的时间精度为秒，如果在 1 秒内发生修改，那么缓存判断可能会失效；</p> <p>准度问题，考虑这样一种情况，如果一个文件被修改，然后又被还原，内容并没有发生变化，在这种情况下，浏览器的缓存还可以继续使用，但因为修改时间发生变化，也会重新返回重复的内容。</p> <ol start="2"><li>ETag 和 If-None-Match</li></ol> <p>为了解决精度问题和准度问题，HTTP 提供了另一种不依赖于修改时间，而依赖于文件哈希值的精确判断缓存的方式，那就是响应头部字段 ETag 和请求头部字段 If-None-Match。</p> <p>具体工作流程如下：</p> <p>浏览器第一次请求资源，服务端在返响应头中加入 Etag 字段，Etag 字段值为该资源的哈希值；</p> <p>当浏览器再次跟服务端请求这个资源时，在请求头上加上 If-None-Match，值为之前响应头部字段 ETag 的值；</p> <p>服务端再次收到请求，将请求头 If-None-Match 字段的值和响应资源的哈希值进行比对，如果两个值相同，则说明资源没有变化，返回 304 Not Modified；否则就正常返回资源内容，无论是否发生变化，都会将计算出的哈希值放入响应头部的 ETag 字段中。</p> <p>这种缓存比较的方式也会存在一些问题，具体表现在以下两个方面。</p> <p>计算成本。生成哈希值相对于读取文件修改时间而言是一个开销比较大的操作，尤其是对于大文件而言。如果要精确计算则需读取完整的文件内容，如果从性能方面考虑，只读取文件部分内容，又容易判断出错。</p> <p>计算误差。HTTP 并没有规定哈希值的计算方法，所以不同服务端可能会采用不同的哈希值计算方式。这样带来的问题是，同一个资源，在两台服务端产生的 Etag 可能是不相同的，所以对于使用服务器集群来处理请求的网站来说，使用 Etag 的缓存命中率会有所降低。</p> <p>需要注意的是，强制缓存的优先级高于协商缓存，在协商缓存中，Etag 优先级比 Last-Modified 高。既然协商缓存策略也存在一些缺陷，那么我们转移到浏览器端看看 ServiceWorker 能不能给我们带来惊喜。</p> <p>ServiceWorker
ServiceWorker 是浏览器在后台独立于网页运行的脚本，也可以这样理解，它是浏览器和服务端之间的代理服务器。ServiceWorker 非常强大，可以实现包括推送通知和后台同步等功能，更多功能还在进一步扩展，但其最主要的功能是实现离线缓存。</p> <ol><li>使用限制
越强大的东西往往越危险，所以浏览器对 ServiceWorker 做了很多限制：</li></ol> <p>在 ServiceWorker 中无法直接访问 DOM，但可以通过 postMessage 接口发送的消息来与其控制的页面进行通信；</p> <p>ServiceWorker 只能在本地环境下或 HTTPS 网站中使用；</p> <p>ServiceWorker 有作用域的限制，一个 ServiceWorker 脚本只能作用于当前路径及其子路径；</p> <p>由于 ServiceWorker 属于实验性功能，所以兼容性方面会存在一些问题，具体兼容情况请看下面的截图。</p> <p>ServiceWorker 在浏览器中的支持情况</p> <ol start="2"><li>使用方法
在使用 ServiceWorker 脚本之前先要通过“注册”的方式加载它。常见的注册代码如下所示：</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>复制代码
<span class="token keyword">if</span><span class="token function"> </span><span class="token punctuation">(</span><span class="token string">'serviceWorker'</span> <span class="token keyword">in</span> window<span class="token punctuation">.</span>navigator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span>navigator<span class="token punctuation">.</span>serviceWorker
    <span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'./sw.js'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>error<span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'浏览器不支持 ServiceWorker!'</span><span class="token punctuation">)</span>
</code></pre></div><p>首先考虑到浏览器的兼容性，判断 window.navigator 中是否存在 serviceWorker 属性，然后通过调用这个属性的 register 函数来告诉浏览器 ServiceWorker 脚本的路径。</p> <p>浏览器获取到 ServiceWorker 脚本之后会进行解析，解析完成会进行安装。可以通过监听 “install” 事件来监听安装，但这个事件只会在第一次加载脚本的时候触发。要让脚本能够监听浏览器的网络请求，还需要激活脚本。</p> <p>在脚本被激活之后，我们就可以通过监听 fetch 事件来拦截请求并加载缓存的资源了。</p> <p>下面是一个利用 ServiceWorker 内部的 caches 对象来缓存文件的示例代码。</p> <div class="language-js extra-class"><pre class="language-js"><code>
复制代码
<span class="token keyword">const</span> <span class="token constant">CACHE_NAME</span> <span class="token operator">=</span> <span class="token string">'ws'</span>
<span class="token keyword">let</span> preloadUrls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'/index.css'</span><span class="token punctuation">]</span>

self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'install'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token function"> </span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token constant">CACHE_NAME</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token function"> </span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>preloadUrls<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token function"> </span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token function"> </span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token function"> </span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> response<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token constant">CACHE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token function"> </span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> path <span class="token operator">=</span> event<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>location<span class="token punctuation">.</span>origin<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
          <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">e </span><span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>这段代码首先监听 install 事件，在回调函数中调用了 event.waitUntil() 函数并传入了一个 Promise 对象。event.waitUntil 用来监听多个异步操作，包括缓存打开和添加缓存路径。如果其中一个操作失败，则整个 ServiceWorker 启动失败。</p> <p>然后监听了 fetch 事件，在回调函数内部调用了函数 event.respondWith() 并传入了一个 Promise 对象，当捕获到 fetch 请求时，会直接返回 event.respondWith 函数中 Promise 对象的结果。</p> <p>在这个 Promise 对象中，我们通过 caches.match 来和当前请求对象进行匹配，如果匹配上则直接返回匹配的缓存结果，否则返回该请求结果并缓存。</p> <p>总结
缓存是解决性能问题的重要手段，使用缓存的好处很多，除了能让浏览器更快地加载网络资源之外，还会带来其他好处，比如节省网络流量和带宽，以及减少服务端的负担。</p> <p>本课时介绍了 HTTP 缓存策略及 ServiceWorker，HTTP 缓存可以分为强制缓存和协商缓存，强制缓存就是在缓存有效期内直接使用浏览器缓存；协商缓存则需要先询问服务端资源是否发生改变，如果未改变再使用浏览器缓存。</p> <p>ServiceWorker 可以用来实现离线缓存，主要实现原理是拦截浏览器请求并返回缓存的资源文件。</p> <h2 id="set"><a href="#set" class="header-anchor">#</a> $set</h2> <p>不能监听到对象新增属性</p> <p>数组不能够操作索引去响应数据的变化</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span>key<span class="token punctuation">,</span>val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     target<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>val<span class="token punctuation">)</span>
     <span class="token keyword">return</span> val<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> ob <span class="token operator">=</span> target<span class="token punctuation">.</span>__ob__<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ob<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val<span class="token punctuation">;</span>
      <span class="token keyword">return</span> val<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">defineReative</span><span class="token punctuation">(</span>ob<span class="token punctuation">.</span>value<span class="token punctuation">,</span>key<span class="token punctuation">,</span>val<span class="token punctuation">)</span>
  ob<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="dipatch"><a href="#dipatch" class="header-anchor">#</a> $dipatch</h2> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">function</span> <span class="token function">broadcast</span><span class="token punctuation">(</span><span class="token parameter">componentName<span class="token punctuation">,</span> eventName<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">child</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> name <span class="token operator">=</span> child<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>componentName<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">===</span> componentName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      child<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> <span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">broadcast</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> <span class="token punctuation">[</span>componentName<span class="token punctuation">,</span> eventName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>params<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token parameter">componentName<span class="token punctuation">,</span> eventName<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> parent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$parent <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$root<span class="token punctuation">;</span>
      <span class="token keyword">var</span> name <span class="token operator">=</span> parent<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>componentName<span class="token punctuation">;</span>

      <span class="token keyword">while</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>name <span class="token operator">||</span> name <span class="token operator">!==</span> componentName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        parent <span class="token operator">=</span> parent<span class="token punctuation">.</span>$parent<span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          name <span class="token operator">=</span> parent<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>componentName<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        parent<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">broadcast</span><span class="token punctuation">(</span><span class="token parameter">componentName<span class="token punctuation">,</span> eventName<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">broadcast</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> componentName<span class="token punctuation">,</span> eventName<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="vue的模板解析"><a href="#vue的模板解析" class="header-anchor">#</a> vue的模板解析</h2> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">compileToFunctions</span><span class="token punctuation">(</span><span class="token parameter">template</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// html模板 =&gt; render函数  (ast是用来描述代码的)</span>
    <span class="token comment">// 1.需要将html代码转化成&quot;ast&quot;语法树 可以用ast树来描述语言本身</span>

    <span class="token comment">// 前端必须要掌握的数据结构 (树)</span>
    <span class="token keyword">let</span> ast <span class="token operator">=</span> <span class="token function">parseHTML</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//生成的AST语法树主要是层级关系 包括 标签名 标签属性 父子关系 标签类型</span>

 
     <span class="token keyword">let</span> root<span class="token punctuation">,</span> currentParent<span class="token punctuation">,</span>
         stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//维护dom层级</span>

      <span class="token keyword">while</span> <span class="token punctuation">(</span>html<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     对标签的解析 
    标签分为开始标签和结束标签和文本节点
    解析开始标签拿到 解析到的标签名 标签属性等  如果遇到 <span class="token operator">&gt;</span> 则开始标签解析完毕
    <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 可以拿到当前解析的内容，生成ast<span class="token punctuation">,</span>放到栈中，声明根元素， 并记录当前正在渲染的元素<span class="token punctuation">,</span>
    <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 匹配结束标签 删除栈中pop 记录当前渲染元素 并生成父子关系
    
    解析元素节点 生成ast
   当元素全部解析完  返回 root

    <span class="token comment">// 2.优化静态节点  对静态节点打上标记</span>

    <span class="token comment">// 3.通过这课树 重新的生成代码</span>
    <span class="token keyword">let</span> code <span class="token operator">=</span> <span class="token function">generate</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment">// 1.对文本节点生成_c </span>

     <span class="token comment">//代码生成器</span>
    <span class="token comment">// 4.将字符串变成函数 限制取值范围 通过with来进行取值 稍后调用render函数就可以通过改变this 让这个函数内部取到结果了</span>
    <span class="token keyword">let</span> render <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">with(this){return </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">}</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> render<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="代码生成器"><a href="#代码生成器" class="header-anchor">#</a> 代码生成器</h2> <p>_c('p',undefined,_v(&quot;多层obj&quot;+_s(obj))
_c('span',{style:{&quot;background-color&quot;:&quot;aqua&quot;,&quot;font-size&quot;:&quot;60px&quot;},name:&quot;zy&quot;},_v(&quot;哈哈&quot;),_c('span',undefined,_v(&quot;wowo&quot;))) code--------</p> <p>//子元素是平级关系的</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">generate</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> children <span class="token operator">=</span> <span class="token function">genChildren</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 儿子的生成</span>
    <span class="token keyword">let</span> code <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_c('</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>el<span class="token punctuation">.</span>tag<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">',</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>
        el<span class="token punctuation">.</span>attrs<span class="token punctuation">.</span>length<span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">genProps</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>attrs<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token operator">:</span><span class="token string">'undefined'</span>
    <span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>
        children<span class="token operator">?</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>children<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token operator">:</span><span class="token string">''</span>
    <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> code<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">genChildren</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> children <span class="token operator">=</span> el<span class="token punctuation">.</span>children<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 将所有转化后的儿子用逗号拼接起来</span>
        <span class="token keyword">return</span> children<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">child</span> <span class="token operator">=&gt;</span> <span class="token function">gen</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//gen  如果是元素节点解析成_c  文本节点 _s</span>
</code></pre></div><h2 id="axios"><a href="#axios" class="header-anchor">#</a> axios</h2> <p>从浏览器中创建 XMLHttpRequests
从 node.js 创建 http 请求
支持 Promise API
拦截请求和响应
转换请求数据和响应数据
取消请求
自动转换 JSON 数据
客户端支持防御 XSRF</p> <p>axios.all(iterable)
axios.spread(callback)</p> <p>CancelToken是一个构造函数，通过new CancelToken()得到的是一个实例对象，它只有一个属性promise, 它的值是一个能触发取消请求的Promise对象。</p> <p>执行CancelToken函数做了两件事：</p> <p>创建一个Promise对象，且将这个对象赋值给promise属性，其resolve参数被暴露出来以备外部引用。
执行executor函数，将内部定义的cancel函数作为参数传递给executor</p> <p>token值为{promise: Promise对象}
executor函数被执行，即cancel = c执行，因此变量cancel被赋值了，值就是CanelToken内部的那个cancel函数。</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token comment">// axios --- index.js 源码 </span>


<span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span>CancelToken<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//config.cancelToken = source.token: new Promise(() =&gt; )</span>
               config<span class="token punctuation">.</span>CancelToken<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token operator">:</span>string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                   request<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                   <span class="token function">reject</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//此处的message</span>
               <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>

axios<span class="token punctuation">.</span>CancelToken <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CancelToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
axios<span class="token punctuation">.</span>isCancel <span class="token operator">=</span> isCancel<span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Cancel</span> <span class="token punctuation">{</span>
    message<span class="token operator">:</span> string<span class="token punctuation">;</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> message<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">isCancel</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> error <span class="token keyword">instanceof</span> <span class="token class-name">Cancel</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CancelToken</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> resolve<span class="token operator">:</span> any<span class="token punctuation">;</span>

    <span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            token<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">'this----'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>resolve <span class="token operator">=</span> resolve<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function-variable function">cancel</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">message<span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Cancel</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//看下 message 是不是 Cancle实例的</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>实际使用</p> <div class="language-js extra-class"><pre class="language-js"><code>instance<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 请求拦截</span>
      <span class="token comment">// console.log('请求前');</span>
      <span class="token keyword">const</span> Cancel <span class="token operator">=</span> axios<span class="token punctuation">.</span>CancelToken<span class="token punctuation">;</span>
      <span class="token comment">// 每次请求前 将token 放到请求中</span>
      config<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>token <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">;</span>
      config<span class="token punctuation">.</span>cancelToken <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cancel</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// console.log(c);</span>
        store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span>types<span class="token punctuation">.</span><span class="token constant">PUSH_TOKEN</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//订阅</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 请求前  增加请求队列</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>queue<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>toast <span class="token operator">=</span> Toast<span class="token punctuation">.</span><span class="token function">$create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          txt<span class="token operator">:</span> <span class="token string">'正在加载'</span><span class="token punctuation">,</span>
          time<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>toast<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>queue<span class="token punctuation">[</span>url<span class="token punctuation">]</span> <span class="token operator">=</span> url<span class="token punctuation">;</span>
      <span class="token keyword">return</span> config<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> CancelToken <span class="token operator">=</span> axios<span class="token punctuation">.</span>CancelToken<span class="token punctuation">;</span>
<span class="token keyword">let</span> cancel<span class="token punctuation">;</span>

axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user/12345'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  cancelToken<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">CancelToken</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">executor</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// executor 函数接收一个 cancel 函数作为参数</span>
    cancel <span class="token operator">=</span> c<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// cancel the request</span>
<span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="vuex"><a href="#vuex" class="header-anchor">#</a> vuex</h2> <p>Vuex采用MVC模式中的Model层，规定所有的数据必须通过action—&gt;mutaion—&gt;state这个流程进行来改变状态的。再结合Vue的数据视图双向绑定实现页面的更新。统一页面状态管理，</p> <p>可以让复杂的组件交互变的简单清晰，同时在调试时也可以通过DEVtools去查看状态。</p> <h2 id="对vuex的理解"><a href="#对vuex的理解" class="header-anchor">#</a> 对vueX的理解</h2> <p>单向数据流 store统一管理state,</p> <p>内部定义 方法 action---dipatch({commit},payload)     mutation - commit(state,payload)</p> <p>实例化过程</p> <p>install 方法 通过Vue.minins 给每个组件注册this.$store</p> <p>可以模块写法</p> <p>实例化的时候 把所有方法都注册到 store实例上的this.$mutations  相同事件名用数组存放</p> <p>如果定义多个相同的事件方法--依次执行</p> <p>所以注意不要同名</p> <p>同名问题 --- 可以通过namespace 触发</p> <p>---调用方便 vuex内部写了帮助函数mapState mapGtters mapAction</p> <p>--- 返回的是一个对象 直接通过解构 把方法都统一放到了组件实例上 进行调用</p> <h2 id="vue和react的不同"><a href="#vue和react的不同" class="header-anchor">#</a> Vue和React的不同</h2> <p>组件化：React与Vue都鼓励将你的应用分拆成一个个功能明确的模块，这样的组件化使得结构清晰且易复用。</p> <p>虚拟Dom：为高效渲染页面，减少性能的消耗，都采取了Virtual Dom。</p> <p>配套框架：两个框架都专注于UI层，其他的功能如路由、状态管理（vuex,redux）等都交由同伴框架进行处理。</p> <p>构建工具：React可以使用Create React App (CRA)，而Vue对应的则是vue-cli。</p> <p>不同</p> <p>1.ui层</p> <p>vue 侧重模板语法</p> <p>react</p> <ul><li><p>vue更侧重双向数据流 vue通信</p></li> <li><p>react 是单向数据流</p></li></ul> <p>2.domdiff 工作原理
diff 算法是指生成更新补丁的方式，主要应用于虚拟 DOM 树变化后，更新真实 DOM。
所以 diff 算法一定存在这样一个过程：触发更新 → 生成补丁 → 应用补丁</p> <p>React 的 diff 算法，触发更新的时机主要在 state 变化与 hooks 调用之后。
此时触发虚拟 DOM 树变更遍历，采用了深度优先遍历算法。但传统的遍历方式，效率较低。为了优化效率，使用了分治的方式。将单一节点比对转化为了 3 种类型节点的比对，分别是树、组件及元素，以此提升效率。</p> <p>树比对：由于网页视图中较少有跨层级节点移动，两株虚拟 DOM 树只对同一层次的节点进行比较。</p> <p>组件比对：如果组件是同一类型，则进行树比对，如果不是，则直接放入到补丁中。</p> <p>元素比对：主要发生在同层级中，通过标记节点操作生成补丁，节点操作对应真实的 DOM 剪裁操作。</p> <p>自 React 16 起，引入了 Fiber 架构。为了使整个更新过程可随时暂停恢复，节点与树分别采用了 FiberNode 与 FiberTree 进行重构。
fiberNode 使用了双链表的结构，可以直接找到兄弟节点与子节点。</p> <p>整个更新过程由 current 与 workInProgress 两株树双缓冲完成。
workInProgress 更新完成后，再通过修改 current 相关指针指向新节点。</p> <p>React 拥有完整的 Diff 算法策略，且拥有随时中断更新的时间切片能力，
在大批量节点更新的极端情况下，拥有更友好的交互体验。</p> <h2 id="react-hooks"><a href="#react-hooks" class="header-anchor">#</a> react-hooks</h2> <p>首先用 Hooks 开发需要抛弃生命周期的思考模式，以 effects 的角度重新思考。</p> <p>过去类组件的开发模式中，在 componentDidMount 中放置一个监听事件，
还需要考虑在 componentWillUnmount 中取消监听，甚至可能由于部分值变化，
还需要在其他生命周期函数中对监听事件做特殊处理。
在 Hooks 的设计思路中，
可以将这一系列监听与取消监听放置在一个 useEffect 中，
useEffect 可以不关心组件的生命周期，只需要关心外部依赖的变化即可，</p> <p>对于开发心智而言是极大的减负。这是 Hooks 的设计根本。</p> <p>首先用 Hooks 开发需要抛弃生命周期的思考模式，以 effects 的角度重新思考。过去类组件的开发模式中，
在 componentDidMount 中放置一个监听事件，还需要考虑在 componentWillUnmount 中取消监听，
甚至可能由于部分值变化，还需要在其他生命周期函数中对监听事件做特殊处理。在 Hooks 的设计思路中，可以将这一系列监听与取消监听放置在一个 useEffect 中，useEffect 可以不关心组件的生命周期，只需要关心外部依赖的变化即可，对于开发心智而言是极大的减负。这是 Hooks 的设计根本。</p> <p>在这样一个认知基础上，我总结了一些在团队内部开发实践的心得，做成了开发规范进行推广。</p> <p>第一点就是 React.useMemo 取代 React.memo，因为 React.memo 并不能控制组件内部共享状态的变化，
而 React.useMemo 更适合于 Hooks 的场景。</p> <p>第二点就是常量，在类组件中，我们很</p> <h2 id="_3-vue的双向绑定原理-2"><a href="#_3-vue的双向绑定原理-2" class="header-anchor">#</a> 3.vue的双向绑定原理</h2> <p>数据---&gt;驱动视图</p> <p>视图改变去驱动数据</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//手写vue的数据双向绑定原理</span>

<span class="token comment">// import { nextTick } from &quot;../util&quot;;</span>



<span class="token comment">// 原理 new Vue 对申明在data里的数据 每一项声明 getter 和 Setter </span>

<span class="token comment">//数组观测是改写数组原型改写 切片编程 加一些逻辑 </span>

<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'zy'</span><span class="token punctuation">,</span>
    obj<span class="token operator">:</span><span class="token punctuation">{</span>
        name<span class="token operator">:</span><span class="token string">'li'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    arr<span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            name<span class="token operator">:</span><span class="token string">'zou'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> oldPrototype <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>

<span class="token keyword">let</span> arraryProtype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>oldPrototype<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> methods <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'shift'</span><span class="token punctuation">,</span>
    <span class="token string">'unshift'</span><span class="token punctuation">,</span>
    <span class="token string">'pop'</span><span class="token punctuation">,</span>
    <span class="token string">'push'</span><span class="token punctuation">,</span>
    <span class="token string">'reverse'</span><span class="token punctuation">,</span>
    <span class="token string">'splice'</span>

<span class="token punctuation">]</span>

methods<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">method</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    arraryProtype<span class="token punctuation">[</span>method<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       oldPrototype<span class="token punctuation">[</span>method<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span>args<span class="token punctuation">)</span>
       <span class="token keyword">let</span> inserted<span class="token punctuation">;</span>
       <span class="token keyword">let</span> ob <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__ob__<span class="token punctuation">;</span>
       <span class="token keyword">switch</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">case</span> <span class="token string">'unshift'</span><span class="token operator">:</span>
           <span class="token keyword">case</span> <span class="token string">'push'</span><span class="token operator">:</span>
            inserted <span class="token operator">=</span> args<span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token string">'splice'</span><span class="token operator">:</span>
            inserted <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>inserted<span class="token punctuation">,</span><span class="token string">'inserted'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>inserted<span class="token punctuation">)</span> ob<span class="token punctuation">.</span><span class="token function">observeArray</span><span class="token punctuation">(</span>inserted<span class="token punctuation">)</span><span class="token punctuation">;</span>

       ob<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Observe</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span><span class="token string">'__ob__'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
            value<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">,</span>
            enumerable<span class="token operator">:</span><span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            data<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> arraryProtype<span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">walk</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
    <span class="token function">walk</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">defineReative</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span>key<span class="token punctuation">,</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">observeArray</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        value<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token function">observe</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 观测数组中的对象类型</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数组修改了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">observe</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//观测数据变化</span>
<span class="token keyword">function</span> <span class="token function">observe</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> data <span class="token operator">!==</span><span class="token string">'object'</span> <span class="token operator">&amp;&amp;</span> data <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>__ob__<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> data<span class="token punctuation">.</span>__ob__<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>





    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Observe</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>



<span class="token punctuation">}</span>


<span class="token keyword">function</span> <span class="token function">defineReative</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span>key<span class="token punctuation">,</span>value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">observe</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>

    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span>key<span class="token punctuation">,</span><span class="token punctuation">{</span>
        <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> value
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">set</span><span class="token punctuation">(</span>newVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'更新了---'</span><span class="token punctuation">)</span>
            value <span class="token operator">=</span> newVal

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>

<span class="token comment">// data.name = 'ppp'</span>
<span class="token comment">// data.obj.name= 'pppp'</span>
data<span class="token punctuation">.</span>arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span><span class="token string">'ppp'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token comment">//数据驱动视图  视图更改影响数据</span>




</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">const</span> toProxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 存放被代理过的对象</span>
<span class="token keyword">const</span> toRaw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 存放已经代理过的对</span>


<span class="token keyword">function</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// 创建响应式对象</span>
  <span class="token keyword">return</span> <span class="token function">createReactiveObject</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">isObject</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">typeof</span> target <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">&amp;&amp;</span> target<span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">hasOwn</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span>key</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> target<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">createReactiveObject</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// 判断target是不是对象,不是对象不必继续</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isObject</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> target<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
 
  <span class="token keyword">let</span> observed <span class="token operator">=</span> toProxy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>observed<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 判断是否被代理过</span>
    <span class="token keyword">return</span> observed<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>toRaw<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 判断是否要重复代理</span>
    <span class="token keyword">return</span> target<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> handlers <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>key<span class="token punctuation">,</span>receiver<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 取值</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;获取&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> res <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">isObject</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// 懒代理，只有当取值时再次做代理，vue2.0中一上来就会全部递归增加getter,setter</span>
        <span class="token operator">?</span> <span class="token function">reactive</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">:</span> res<span class="token punctuation">;</span>
    
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>key<span class="token punctuation">,</span>value<span class="token punctuation">,</span>receiver<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 更改 、 新增属性</span>
        <span class="token keyword">let</span> oldValue <span class="token operator">=</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 获取上次的值</span>
        <span class="token keyword">let</span> hadKey <span class="token operator">=</span> <span class="token function">hasOwn</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 看这个属性是否存在</span>
        <span class="token keyword">let</span> result <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>hadKey<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 新增属性</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'更新 添加'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>oldValue <span class="token operator">!==</span> value<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 修改存在的属性</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'更新 修改'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 当调用push 方法第一次修改时数组长度已经发生变化</span>
        <span class="token comment">// 如果这次的值和上次的值一样则不触发更新</span>
    
          <span class="token keyword">return</span> result<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">deleteProperty</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span>key</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 删除属性</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'删除'</span><span class="token punctuation">)</span>
          <span class="token keyword">const</span> result <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">deleteProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> result<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 开始代理</span>
  observed <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>handlers<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> observed<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token string">'youxuan'</span><span class="token punctuation">,</span>obj<span class="token operator">:</span><span class="token punctuation">{</span>a<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>obj<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取</span>

<span class="token comment">// p.name = 'webyouxuan'; // 设置</span>
<span class="token comment">// p.age = 10</span>
p<span class="token punctuation">.</span>obj<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">10</span>
<span class="token keyword">delete</span> p<span class="token punctuation">.</span>name<span class="token punctuation">;</span> <span class="token comment">// 删除</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="浏览器-渲染-2"><a href="#浏览器-渲染-2" class="header-anchor">#</a> 浏览器 渲染</h2> <p>性能优化
性能优化是前端开发中避不开的问题，性能问题无外乎两方面原因：渲染速度慢、请求时间长。性能优化虽然涉及很多复杂的原因和解决方案，但其实只要通过合理地使用标签，就可以在一定程度上提升渲染速度以及减少请求时间。</p> <p>script 标签：调整加载顺序提升渲染速度
由于浏览器的底层运行机制，渲染引擎在解析 HTML 时，若遇到 script 标签引用文件，则会暂停解析过程，同时通知网络线程加载文件，文件加载后会切换至 JavaScript 引擎来执行对应代码，代码执行完成之后切换至渲染引擎继续渲染页面。</p> <p>在这一过程中可以看到，页面渲染过程中包含了请求文件以及执行文件的时间，但页面的首次渲染可能并不依赖这些文件，这些请求和执行文件的动作反而延长了用户看到页面的时间，从而降低了用户体验。</p> <p>为了减少这些时间损耗，可以借助 script 标签的 3 个属性来实现。</p> <p>async 属性。立即请求文件，但不阻塞渲染引擎，而是文件加载完毕后阻塞渲染引擎并立即执行文件内容。</p> <p>defer 属性。立即请求文件，但不阻塞渲染引擎，等到解析完 HTML 之后再执行文件内容。</p> <p>HTML5 标准 type 属性，对应值为“module”。让浏览器按照 ECMA Script 6 标准将文件当作模块进行解析，默认阻塞效果同 defer，也可以配合 async 在请求完成后立即执行。</p> <p>从图中可以得知，采用 3 种属性都能减少请求文件引起的阻塞时间，只有 defer 属性以及 type=&quot;module&quot; 情况下能保证渲染引擎的优先执行，从而减少执行文件内容消耗的时间，让用户更快地看见页面（即使这些页面内容可能并没有完全地显示）。</p> <p>除此之外还应当注意，当渲染引擎解析 HTML 遇到 script 标签引入文件时，会立即进行一次渲染。所以这也就是为什么构建工具会把编译好的引用 JavaScript 代码的 script 标签放入到 body 标签底部，因为当渲染引擎执行到 body 底部时会先将已解析的内容渲染出来，然后再去请求相应的 JavaScript 文件。如果是内联脚本（即不通过 src 属性引用外部脚本文件直接在 HTML 编写 JavaScript 代码的形式），渲染引擎则不会渲染。</p> <p>link 标签：通过预处理提升渲染速度
dns-prefetch。当 link 标签的 rel 属性值为“dns-prefetch”时，浏览器会对某个域名预先进行 DNS 解析并缓存。这样，当浏览器在请求同域名资源的时候，能省去从域名查询 IP 的过程，从而减少时间损耗。下图是淘宝网设置的 DNS 预解析。</p> <p>preconnect。让浏览器在一个 HTTP 请求正式发给服务器前预先执行一些操作，这包括 DNS 解析、TLS 协商、TCP 握手，通过消除往返延迟来为用户节省时间。</p> <p>prefetch/preload。两个值都是让浏览器预先下载并缓存某个资源，但不同的是，prefetch 可能会在浏览器忙时被忽略，而 preload 则是一定会被预先下载。</p> <p>prerender。浏览器不仅会加载资源，还会解析执行页面，进行预渲染。</p> <h2 id="http-2"><a href="#http-2" class="header-anchor">#</a> http</h2> <p>协议版本	解决的核心问题	解决方式
0.9	HTML 文件传输	确立了客户端请求、服务端响应的通信流程
1.0	不同类型文件传输	设立头部字段
1.1	创建/断开 TCP 连接开销大	建立长连接进行复用
2	并发数有限	二进制分帧
3	TCP 丢包阻塞	采用 UDP 协议</p> <h2 id="强缓存-和-协商缓存-2"><a href="#强缓存-和-协商缓存-2" class="header-anchor">#</a> 强缓存 和 协商缓存</h2> <p>需要注意的是，cache-control 的 max-age 优先级高于 Expires，也就是说如果它们同时出现，浏览器会使用 max-age 的值。</p> <p>http 1.0 Expires</p> <p>http 1.1 Cache-Control</p> <p>no-cache，表示使用协商缓存，即每次使用缓存前必须向服务端确认缓存资源是否更新；</p> <p>no-store，禁止浏览器以及所有中间缓存存储响应内容；</p> <p>public，公有缓存，表示可以被代理服务器缓存，可以被多个用户共享；</p> <p>private，私有缓存，不能被代理服务器缓存，不可以被多个用户共享；</p> <p>max-age，以秒为单位的数值，表示缓存的有效时间；</p> <p>must-revalidate，当缓存过期时，需要去服务端校验缓存的有效性。</p> <p>需要注意的是，cache-control 的 max-age 优先级高于 Expires，也就是说如果它们同时出现，浏览器会使用 max-age 的值。</p> <p>cache-control: public, max-age=31536000</p> <p>协商缓存</p> <p>协商缓存的更新策略是不再指定缓存的有效时间了，而是浏览器直接发送请求到服务端进行确认缓存是否更新，如果请求响应返回的 HTTP 状态为 304，则表示缓存仍然有效。控制缓存的难题就是从浏览器端转移到了服务端。</p> <ol><li>Last-Modified 和 If-Modified-Since</li></ol> <p>服务端要判断缓存有没有过期，只能将双方的资源进行对比。若浏览器直接把资源文件发送给服务端进行比对的话，网络开销太大，而且也会失去缓存的意义，所以显然是不可取的。有一种简单的判断方法，那就是通过响应头部字段 Last-Modified 和请求头部字段 If-Modified-Since 比对双方资源的修改时间。</p> <p>具体工作流程如下：</p> <p>浏览器第一次请求资源，服务端在返回资源的响应头中加入 Last-Modified 字段，该字段表示这个资源在服务端上的最近修改时间；</p> <p>当浏览器再次向服务端请求该资源时，请求头部带上之前服务端返回的修改时间，这个请求头叫 If-Modified-Since；</p> <p>服务端再次收到请求，根据请求头 If-Modified-Since 的值，判断相关资源是否有变化，如果没有，则返回 304 Not Modified，并且不返回资源内容，浏览器使用资源缓存值；否则正常返回资源内容，且更新 Last-Modified 响应头内容。</p> <p>这种方式虽然能判断缓存是否失效，但也存在两个问题：</p> <p>精度问题，Last-Modified 的时间精度为秒，如果在 1 秒内发生修改，那么缓存判断可能会失效；</p> <p>准度问题，考虑这样一种情况，如果一个文件被修改，然后又被还原，内容并没有发生变化，在这种情况下，浏览器的缓存还可以继续使用，但因为修改时间发生变化，也会重新返回重复的内容。</p> <ol start="2"><li>ETag 和 If-None-Match</li></ol> <p>为了解决精度问题和准度问题，HTTP 提供了另一种不依赖于修改时间，而依赖于文件哈希值的精确判断缓存的方式，那就是响应头部字段 ETag 和请求头部字段 If-None-Match。</p> <p>具体工作流程如下：</p> <p>浏览器第一次请求资源，服务端在返响应头中加入 Etag 字段，Etag 字段值为该资源的哈希值；</p> <p>当浏览器再次跟服务端请求这个资源时，在请求头上加上 If-None-Match，值为之前响应头部字段 ETag 的值；</p> <p>服务端再次收到请求，将请求头 If-None-Match 字段的值和响应资源的哈希值进行比对，如果两个值相同，则说明资源没有变化，返回 304 Not Modified；否则就正常返回资源内容，无论是否发生变化，都会将计算出的哈希值放入响应头部的 ETag 字段中。</p> <p>这种缓存比较的方式也会存在一些问题，具体表现在以下两个方面。</p> <p>计算成本。生成哈希值相对于读取文件修改时间而言是一个开销比较大的操作，尤其是对于大文件而言。如果要精确计算则需读取完整的文件内容，如果从性能方面考虑，只读取文件部分内容，又容易判断出错。</p> <p>计算误差。HTTP 并没有规定哈希值的计算方法，所以不同服务端可能会采用不同的哈希值计算方式。这样带来的问题是，同一个资源，在两台服务端产生的 Etag 可能是不相同的，所以对于使用服务器集群来处理请求的网站来说，使用 Etag 的缓存命中率会有所降低。</p> <p>需要注意的是，强制缓存的优先级高于协商缓存，在协商缓存中，Etag 优先级比 Last-Modified 高。既然协商缓存策略也存在一些缺陷，那么我们转移到浏览器端看看 ServiceWorker 能不能给我们带来惊喜。</p> <p>ServiceWorker
ServiceWorker 是浏览器在后台独立于网页运行的脚本，也可以这样理解，它是浏览器和服务端之间的代理服务器。ServiceWorker 非常强大，可以实现包括推送通知和后台同步等功能，更多功能还在进一步扩展，但其最主要的功能是实现离线缓存。</p> <ol><li>使用限制
越强大的东西往往越危险，所以浏览器对 ServiceWorker 做了很多限制：</li></ol> <p>在 ServiceWorker 中无法直接访问 DOM，但可以通过 postMessage 接口发送的消息来与其控制的页面进行通信；</p> <p>ServiceWorker 只能在本地环境下或 HTTPS 网站中使用；</p> <p>ServiceWorker 有作用域的限制，一个 ServiceWorker 脚本只能作用于当前路径及其子路径；</p> <p>由于 ServiceWorker 属于实验性功能，所以兼容性方面会存在一些问题，具体兼容情况请看下面的截图。</p> <p>ServiceWorker 在浏览器中的支持情况</p> <ol start="2"><li>使用方法
在使用 ServiceWorker 脚本之前先要通过“注册”的方式加载它。常见的注册代码如下所示：</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>复制代码
<span class="token keyword">if</span><span class="token function"> </span><span class="token punctuation">(</span><span class="token string">'serviceWorker'</span> <span class="token keyword">in</span> window<span class="token punctuation">.</span>navigator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span>navigator<span class="token punctuation">.</span>serviceWorker
    <span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'./sw.js'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>error<span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'浏览器不支持 ServiceWorker!'</span><span class="token punctuation">)</span>
</code></pre></div><p>首先考虑到浏览器的兼容性，判断 window.navigator 中是否存在 serviceWorker 属性，然后通过调用这个属性的 register 函数来告诉浏览器 ServiceWorker 脚本的路径。</p> <p>浏览器获取到 ServiceWorker 脚本之后会进行解析，解析完成会进行安装。可以通过监听 “install” 事件来监听安装，但这个事件只会在第一次加载脚本的时候触发。要让脚本能够监听浏览器的网络请求，还需要激活脚本。</p> <p>在脚本被激活之后，我们就可以通过监听 fetch 事件来拦截请求并加载缓存的资源了。</p> <p>下面是一个利用 ServiceWorker 内部的 caches 对象来缓存文件的示例代码。</p> <div class="language-js extra-class"><pre class="language-js"><code>
复制代码
<span class="token keyword">const</span> <span class="token constant">CACHE_NAME</span> <span class="token operator">=</span> <span class="token string">'ws'</span>
<span class="token keyword">let</span> preloadUrls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'/index.css'</span><span class="token punctuation">]</span>

self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'install'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token function"> </span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token constant">CACHE_NAME</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token function"> </span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>preloadUrls<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token function"> </span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token function"> </span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token function"> </span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> response<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token constant">CACHE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token function"> </span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> path <span class="token operator">=</span> event<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>location<span class="token punctuation">.</span>origin<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
          <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">e </span><span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>这段代码首先监听 install 事件，在回调函数中调用了 event.waitUntil() 函数并传入了一个 Promise 对象。event.waitUntil 用来监听多个异步操作，包括缓存打开和添加缓存路径。如果其中一个操作失败，则整个 ServiceWorker 启动失败。</p> <p>然后监听了 fetch 事件，在回调函数内部调用了函数 event.respondWith() 并传入了一个 Promise 对象，当捕获到 fetch 请求时，会直接返回 event.respondWith 函数中 Promise 对象的结果。</p> <p>在这个 Promise 对象中，我们通过 caches.match 来和当前请求对象进行匹配，如果匹配上则直接返回匹配的缓存结果，否则返回该请求结果并缓存。</p> <p>总结
缓存是解决性能问题的重要手段，使用缓存的好处很多，除了能让浏览器更快地加载网络资源之外，还会带来其他好处，比如节省网络流量和带宽，以及减少服务端的负担。</p> <p>本课时介绍了 HTTP 缓存策略及 ServiceWorker，HTTP 缓存可以分为强制缓存和协商缓存，强制缓存就是在缓存有效期内直接使用浏览器缓存；协商缓存则需要先询问服务端资源是否发生改变，如果未改变再使用浏览器缓存。</p> <p>ServiceWorker 可以用来实现离线缓存，主要实现原理是拦截浏览器请求并返回缓存的资源文件。</p> <h2 id="bind-call-apply-的区别"><a href="#bind-call-apply-的区别" class="header-anchor">#</a> bind call apply 的区别</h2> <p>都能改变this指向
bind 返回一个回调函数 this指向一旦改变 不能再次改变</p> <p>apply call 立即执行  传参方式不同</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">mycall</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    context <span class="token operator">=</span> context  <span class="token operator">||</span> window<span class="token punctuation">;</span>
   context<span class="token punctuation">.</span>fn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span> <span class="token comment">//假如  当fn被调用的时候 函数谁调用 this指向谁 改变了this指向</span>
   <span class="token keyword">const</span> result <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>
   <span class="token keyword">delete</span> context<span class="token punctuation">.</span>fn
   <span class="token keyword">return</span> result<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'wo'</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">'说'</span> <span class="token operator">+</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">'pp'</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">mycall</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span><span class="token string">'wp'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><p>创建一个新对象；</p> <p>将构造函数的作用域赋给新对象（this 指向新对象）；</p> <p>执行构造函数中的代码（为这个新对象添加属性）；</p> <p>返回新对象。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">myNew</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> obj <span class="token operator">=</span>  Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>

     <span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>

     <span class="token keyword">return</span> r <span class="token keyword">instanceof</span> <span class="token class-name">Object</span> <span class="token operator">?</span> r <span class="token operator">:</span>obj<span class="token punctuation">;</span>
<span class="token punctuation">}</span>



</code></pre></div><h2 id="浏览器加载js-和-css"><a href="#浏览器加载js-和-css" class="header-anchor">#</a> 浏览器加载js 和 css</h2> <p>受浏览器底层限制，浏览器在解析html代码时，遇到script标签，会立即暂停渲染引擎，等js执行完毕后再执行渲染引擎</p> <p>--- async 属性-- 不阻塞 -- 立即请求文件请求文件后会阻塞渲染引擎</p> <p>--- defer --- 不阻塞-- 等html解析完之后再去执行文件内容
--- type=&quot;module&quot;</p> <p>link 便签</p> <p>webpack 优化的时候 会按照按需加载的方式来加载对应模块 -- 合理利用 link 标签的ref属性 进行预加载</p> <p>dns-prefetch -- 解析dns</p> <p>preconnect。让浏览器在一个 HTTP 请求正式发给服务器前预先执行一些操作，这包括 DNS 解析、TLS 协商、TCP 握手，通过消除往返延迟来为用户节省时间。</p> <p>prefetch/preload。两个值都是让浏览器预先下载并缓存某个资源，但不同的是，prefetch 可能会在浏览器忙时被忽略，而 preload 则是一定会被预先下载。</p> <p>prerender。浏览器不仅会加载资源，还会解析执行页面，进行预渲染。</p> <p>script 可以放到最后 执行完毕css再执行js</p> <p>1.vue更偏向于用模板去完成</p> <h2 id="set-2"><a href="#set-2" class="header-anchor">#</a> $set</h2> <p>不能监听到对象新增属性</p> <p>数组不能够操作索引去响应数据的变化</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span>key<span class="token punctuation">,</span>val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     target<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>val<span class="token punctuation">)</span>
     <span class="token keyword">return</span> val<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> ob <span class="token operator">=</span> target<span class="token punctuation">.</span>__ob__<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ob<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val<span class="token punctuation">;</span>
      <span class="token keyword">return</span> val<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">defineReative</span><span class="token punctuation">(</span>ob<span class="token punctuation">.</span>value<span class="token punctuation">,</span>key<span class="token punctuation">,</span>val<span class="token punctuation">)</span>
  ob<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="instaceof"><a href="#instaceof" class="header-anchor">#</a> instaceOf</h2> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">function</span> <span class="token function">instance</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">A</span><span class="token punctuation">,</span><span class="token constant">B</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token constant">B</span> <span class="token operator">=</span> <span class="token class-name">B</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
    <span class="token constant">A</span> <span class="token operator">=</span> <span class="token constant">A</span><span class="token punctuation">.</span>__proto__<span class="token punctuation">;</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token constant">A</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">A</span> <span class="token operator">==</span> <span class="token constant">B</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token constant">A</span> <span class="token operator">=</span> <span class="token constant">A</span><span class="token punctuation">.</span>__proto__<span class="token punctuation">;</span>

    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>
</code></pre></div><h2 id="dipatch-2"><a href="#dipatch-2" class="header-anchor">#</a> $dipatch</h2> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">function</span> <span class="token function">broadcast</span><span class="token punctuation">(</span><span class="token parameter">componentName<span class="token punctuation">,</span> eventName<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">child</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> name <span class="token operator">=</span> child<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>componentName<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">===</span> componentName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      child<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> <span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">broadcast</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> <span class="token punctuation">[</span>componentName<span class="token punctuation">,</span> eventName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>params<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token parameter">componentName<span class="token punctuation">,</span> eventName<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> parent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$parent <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$root<span class="token punctuation">;</span>
      <span class="token keyword">var</span> name <span class="token operator">=</span> parent<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>componentName<span class="token punctuation">;</span>

      <span class="token keyword">while</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>name <span class="token operator">||</span> name <span class="token operator">!==</span> componentName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        parent <span class="token operator">=</span> parent<span class="token punctuation">.</span>$parent<span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          name <span class="token operator">=</span> parent<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>componentName<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        parent<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">broadcast</span><span class="token punctuation">(</span><span class="token parameter">componentName<span class="token punctuation">,</span> eventName<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">broadcast</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> componentName<span class="token punctuation">,</span> eventName<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="vue的模板解析-2"><a href="#vue的模板解析-2" class="header-anchor">#</a> vue的模板解析</h2> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">compileToFunctions</span><span class="token punctuation">(</span><span class="token parameter">template</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// html模板 =&gt; render函数  (ast是用来描述代码的)</span>
    <span class="token comment">// 1.需要将html代码转化成&quot;ast&quot;语法树 可以用ast树来描述语言本身</span>

    <span class="token comment">// 前端必须要掌握的数据结构 (树)</span>
    <span class="token keyword">let</span> ast <span class="token operator">=</span> <span class="token function">parseHTML</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//生成的AST语法树主要是层级关系 包括 标签名 标签属性 父子关系 标签类型</span>

 
     <span class="token keyword">let</span> root<span class="token punctuation">,</span> currentParent<span class="token punctuation">,</span>
         stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//维护dom层级</span>

      <span class="token keyword">while</span> <span class="token punctuation">(</span>html<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     对标签的解析 
    标签分为开始标签和结束标签和文本节点
    解析开始标签拿到 解析到的标签名 标签属性等  如果遇到 <span class="token operator">&gt;</span> 则开始标签解析完毕
    <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 可以拿到当前解析的内容，生成ast<span class="token punctuation">,</span>放到栈中，声明根元素， 并记录当前正在渲染的元素<span class="token punctuation">,</span>
    <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 匹配结束标签 删除栈中pop 记录当前渲染元素 并生成父子关系
    
    解析元素节点 生成ast
   当元素全部解析完  返回 root

    <span class="token comment">// 2.优化静态节点  对静态节点打上标记</span>

    <span class="token comment">// 3.通过这课树 重新的生成代码</span>
    <span class="token keyword">let</span> code <span class="token operator">=</span> <span class="token function">generate</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment">// 1.对文本节点生成_c </span>

     <span class="token comment">//代码生成器</span>
    <span class="token comment">// 4.将字符串变成函数 限制取值范围 通过with来进行取值 稍后调用render函数就可以通过改变this 让这个函数内部取到结果了</span>
    <span class="token keyword">let</span> render <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">with(this){return </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">}</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> render<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="代码生成器-2"><a href="#代码生成器-2" class="header-anchor">#</a> 代码生成器</h2> <p>_c('p',undefined,_v(&quot;多层obj&quot;+_s(obj))
_c('span',{style:{&quot;background-color&quot;:&quot;aqua&quot;,&quot;font-size&quot;:&quot;60px&quot;},name:&quot;zy&quot;},_v(&quot;哈哈&quot;),_c('span',undefined,_v(&quot;wowo&quot;))) code--------</p> <p>//子元素是平级关系的</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">generate</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> children <span class="token operator">=</span> <span class="token function">genChildren</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 儿子的生成</span>
    <span class="token keyword">let</span> code <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_c('</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>el<span class="token punctuation">.</span>tag<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">',</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>
        el<span class="token punctuation">.</span>attrs<span class="token punctuation">.</span>length<span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">genProps</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>attrs<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token operator">:</span><span class="token string">'undefined'</span>
    <span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>
        children<span class="token operator">?</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>children<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token operator">:</span><span class="token string">''</span>
    <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> code<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">genChildren</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> children <span class="token operator">=</span> el<span class="token punctuation">.</span>children<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 将所有转化后的儿子用逗号拼接起来</span>
        <span class="token keyword">return</span> children<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">child</span> <span class="token operator">=&gt;</span> <span class="token function">gen</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//gen  如果是元素节点解析成_c  文本节点 _s</span>
</code></pre></div><h2 id="axios-2"><a href="#axios-2" class="header-anchor">#</a> axios</h2> <p>从浏览器中创建 XMLHttpRequests
从 node.js 创建 http 请求
支持 Promise API
拦截请求和响应
转换请求数据和响应数据
取消请求
自动转换 JSON 数据
客户端支持防御 XSRF</p> <p>axios.all(iterable)
axios.spread(callback)</p> <p>CancelToken是一个构造函数，通过new CancelToken()得到的是一个实例对象，它只有一个属性promise, 它的值是一个能触发取消请求的Promise对象。</p> <p>执行CancelToken函数做了两件事：</p> <p>创建一个Promise对象，且将这个对象赋值给promise属性，其resolve参数被暴露出来以备外部引用。
执行executor函数，将内部定义的cancel函数作为参数传递给executor</p> <p>token值为{promise: Promise对象}
executor函数被执行，即cancel = c执行，因此变量cancel被赋值了，值就是CanelToken内部的那个cancel函数。</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token comment">// axios --- index.js 源码 </span>


<span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span>CancelToken<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//config.cancelToken = source.token: new Promise(() =&gt; )</span>
               config<span class="token punctuation">.</span>CancelToken<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token operator">:</span>string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                   request<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                   <span class="token function">reject</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//此处的message</span>
               <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>

axios<span class="token punctuation">.</span>CancelToken <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CancelToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
axios<span class="token punctuation">.</span>isCancel <span class="token operator">=</span> isCancel<span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Cancel</span> <span class="token punctuation">{</span>
    message<span class="token operator">:</span> string<span class="token punctuation">;</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> message<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">isCancel</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> error <span class="token keyword">instanceof</span> <span class="token class-name">Cancel</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CancelToken</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> resolve<span class="token operator">:</span> any<span class="token punctuation">;</span>

    <span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            token<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">'this----'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>resolve <span class="token operator">=</span> resolve<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function-variable function">cancel</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">message<span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Cancel</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//看下 message 是不是 Cancle实例的</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>实际使用</p> <div class="language-js extra-class"><pre class="language-js"><code>instance<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 请求拦截</span>
      <span class="token comment">// console.log('请求前');</span>
      <span class="token keyword">const</span> Cancel <span class="token operator">=</span> axios<span class="token punctuation">.</span>CancelToken<span class="token punctuation">;</span>
      <span class="token comment">// 每次请求前 将token 放到请求中</span>
      config<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>token <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">;</span>
      config<span class="token punctuation">.</span>cancelToken <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cancel</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// console.log(c);</span>
        store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span>types<span class="token punctuation">.</span><span class="token constant">PUSH_TOKEN</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//订阅</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 请求前  增加请求队列</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>queue<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>toast <span class="token operator">=</span> Toast<span class="token punctuation">.</span><span class="token function">$create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          txt<span class="token operator">:</span> <span class="token string">'正在加载'</span><span class="token punctuation">,</span>
          time<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>toast<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>queue<span class="token punctuation">[</span>url<span class="token punctuation">]</span> <span class="token operator">=</span> url<span class="token punctuation">;</span>
      <span class="token keyword">return</span> config<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> CancelToken <span class="token operator">=</span> axios<span class="token punctuation">.</span>CancelToken<span class="token punctuation">;</span>
<span class="token keyword">let</span> cancel<span class="token punctuation">;</span>

axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user/12345'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  cancelToken<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">CancelToken</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">executor</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// executor 函数接收一个 cancel 函数作为参数</span>
    cancel <span class="token operator">=</span> c<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// cancel the request</span>
<span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="vuex-2"><a href="#vuex-2" class="header-anchor">#</a> vuex</h2> <p>Vuex采用MVC模式中的Model层，规定所有的数据必须通过action—&gt;mutaion—&gt;state这个流程进行来改变状态的。再结合Vue的数据视图双向绑定实现页面的更新。统一页面状态管理，</p> <p>可以让复杂的组件交互变的简单清晰，同时在调试时也可以通过DEVtools去查看状态。</p> <h2 id="对vuex的理解-2"><a href="#对vuex的理解-2" class="header-anchor">#</a> 对vueX的理解</h2> <p>单向数据流 store统一管理state,</p> <p>内部定义 方法 action---dipatch({commit},payload)     mutation - commit(state,payload)</p> <p>实例化过程</p> <p>install 方法 通过Vue.minins 给每个组件注册this.$store</p> <p>可以模块写法</p> <p>实例化的时候 把所有方法都注册到 store实例上的this.$mutations  相同事件名用数组存放</p> <p>如果定义多个相同的事件方法--依次执行</p> <p>所以注意不要同名</p> <p>同名问题 --- 可以通过namespace 触发</p> <p>---调用方便 vuex内部写了帮助函数mapState mapGtters mapAction</p> <p>--- 返回的是一个对象 直接通过解构 把方法都统一放到了组件实例上 进行调用</p> <h2 id="vue和react的不同-2"><a href="#vue和react的不同-2" class="header-anchor">#</a> Vue和React的不同</h2> <p>组件化：React与Vue都鼓励将你的应用分拆成一个个功能明确的模块，这样的组件化使得结构清晰且易复用。</p> <p>虚拟Dom：为高效渲染页面，减少性能的消耗，都采取了Virtual Dom。</p> <p>配套框架：两个框架都专注于UI层，其他的功能如路由、状态管理（vuex,redux）等都交由同伴框架进行处理。</p> <p>构建工具：React可以使用Create React App (CRA)，而Vue对应的则是vue-cli。</p> <p>不同</p> <p>1.ui层</p> <p>vue 侧重模板语法</p> <p>react</p> <ul><li><p>vue更侧重双向数据流 vue通信</p></li> <li><p>react 是单向数据流</p></li></ul> <p>2.domdiff 工作原理
diff 算法是指生成更新补丁的方式，主要应用于虚拟 DOM 树变化后，更新真实 DOM。
所以 diff 算法一定存在这样一个过程：触发更新 → 生成补丁 → 应用补丁</p> <p>React 的 diff 算法，触发更新的时机主要在 state 变化与 hooks 调用之后。
此时触发虚拟 DOM 树变更遍历，采用了深度优先遍历算法。但传统的遍历方式，效率较低。为了优化效率，使用了分治的方式。将单一节点比对转化为了 3 种类型节点的比对，分别是树、组件及元素，以此提升效率。</p> <p>树比对：由于网页视图中较少有跨层级节点移动，两株虚拟 DOM 树只对同一层次的节点进行比较。</p> <p>组件比对：如果组件是同一类型，则进行树比对，如果不是，则直接放入到补丁中。</p> <p>元素比对：主要发生在同层级中，通过标记节点操作生成补丁，节点操作对应真实的 DOM 剪裁操作。</p> <p>自 React 16 起，引入了 Fiber 架构。为了使整个更新过程可随时暂停恢复，节点与树分别采用了 FiberNode 与 FiberTree 进行重构。
fiberNode 使用了双链表的结构，可以直接找到兄弟节点与子节点。</p> <p>整个更新过程由 current 与 workInProgress 两株树双缓冲完成。
workInProgress 更新完成后，再通过修改 current 相关指针指向新节点。</p> <p>React 拥有完整的 Diff 算法策略，且拥有随时中断更新的时间切片能力，
在大批量节点更新的极端情况下，拥有更友好的交互体验。</p> <h2 id="react-hooks-2"><a href="#react-hooks-2" class="header-anchor">#</a> react-hooks</h2> <p>首先用 Hooks 开发需要抛弃生命周期的思考模式，以 effects 的角度重新思考。</p> <p>过去类组件的开发模式中，在 componentDidMount 中放置一个监听事件，
还需要考虑在 componentWillUnmount 中取消监听，甚至可能由于部分值变化，
还需要在其他生命周期函数中对监听事件做特殊处理。
在 Hooks 的设计思路中，
可以将这一系列监听与取消监听放置在一个 useEffect 中，
useEffect 可以不关心组件的生命周期，只需要关心外部依赖的变化即可，</p> <p>对于开发心智而言是极大的减负。这是 Hooks 的设计根本。</p> <p>首先用 Hooks 开发需要抛弃生命周期的思考模式，以 effects 的角度重新思考。过去类组件的开发模式中，
在 componentDidMount 中放置一个监听事件，还需要考虑在 componentWillUnmount 中取消监听，
甚至可能由于部分值变化，还需要在其他生命周期函数中对监听事件做特殊处理。在 Hooks 的设计思路中，可以将这一系列监听与取消监听放置在一个 useEffect 中，useEffect 可以不关心组件的生命周期，只需要关心外部依赖的变化即可，对于开发心智而言是极大的减负。这是 Hooks 的设计根本。</p> <p>在这样一个认知基础上，我总结了一些在团队内部开发实践的心得，做成了开发规范进行推广。</p> <p>第一点就是 React.useMemo 取代 React.memo，因为 React.memo 并不能控制组件内部共享状态的变化，
而 React.useMemo 更适合于 Hooks 的场景。</p> <p>第二点就是常量，在类组件中，我们很习惯将常量写在类中，但在组件函数中，这意味着每次渲染都会重新声明常量，
这是完全无意义的操作。其次就是组件内的函数每次会被重新创建，如果这个函数需要使用函数组件内部的变量，
那么可以用 useCallback 包裹下这个函数。</p> <p>第三点就是 useEffect 的第二个参数容易被错误使用。很多同学习惯在第二个参数放置引用类型的变量，
通常的情况下，引用类型的变量很容易被篡改，难以判断开发者的真实意图，所以更推荐使用值类型的变量。
当然有个小技巧是 JSON 序列化引用类型的变量，也就是通过 JSON.stringify 将引用类型变量转换为字符串来解决。
但不推荐这个操作方式，比较消耗性能。</p> <h2 id="redux"><a href="#redux" class="header-anchor">#</a> redux</h2> <p>View（视图层）：用户界面。该用户界面可以是以任何形式实现出来的，React 组件是一种形式，Vue、Angular 也完全 OK。Flux 架构与 React 之间并不存在耦合关系。</p> <p>Action（动作）：也可以理解为视图层发出的“消息”，它会触发应用状态的改变。</p> <p>Dispatcher（派发器）：它负责对 action 进行分发。</p> <p>Store（数据层）：它是存储应用状态的“仓库”，此外还会定义修改状态的逻辑。store 的变化最终会映射到 view 层上去。</p> <p>Store：它是一个单一的数据源，而且是只读的。</p> <p>Action 人如其名，是“动作”的意思，它是对变化的描述。</p> <p>Reducer 是一个函数，它负责对变化进行分发和处理，最终将新的数据返回给 Store。</p> <p>applyMiddleware.js</p> <p>bindActionCreators.js</p> <p>combineReducers.js</p> <p>compose.js</p> <p>createStore.js</p> <p>createStore 方法可以接收以下 3 个入参：</p> <p>reducer</p> <p>初始状态内容</p> <p>指定中间件</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token comment">// 引入 redux</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>
<span class="token comment">// 创建 store</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>
    reducer<span class="token punctuation">,</span>
    initial_state<span class="token punctuation">,</span>
    <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>middleware1<span class="token punctuation">,</span> middleware2<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>createStore</p> <p>getState</p> <p>subscribe</p> <p>dispatch
Redux 工作流的核心：dispatch 动作</p> <ol><li>通过“上锁”避免“套娃式”的 dispatch</li></ol> <p>在调用 reducer 之前，Redux 首先会将 isDispatching 变量置为 true，待 reducer 执行完毕后，
再将 isDispatching 变量置为 false。这个操作你应该不陌生，
因为在第 11 讲中，setState 的“批处理”也是用类似的“上锁”方式来实现的。
当dispatch action 发生时，Redux 会在 reducer 执行完毕后，
将 listeners 数组中的监听函数逐个执行。这就是 subscribe 与 Redux 主流程之间的关系。</p> <h2 id="componse"><a href="#componse" class="header-anchor">#</a> componse</h2> <p>实现</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">function</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>funcs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>funcs<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token parameter">args</span> <span class="token operator">=&gt;</span> args<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>funcs<span class="token punctuation">.</span>length <span class="token operator">===</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> funcs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> funcs<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">func<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="api限制并发"><a href="#api限制并发" class="header-anchor">#</a> api限制并发</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createRequest</span><span class="token punctuation">(</span><span class="token parameter">tasks<span class="token punctuation">,</span> pool<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> pool <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        callback <span class="token operator">=</span> pool<span class="token punctuation">;</span>
        pool <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> pool <span class="token operator">!==</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">)</span> pool <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> callback <span class="token operator">!==</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token function-variable function">callback</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">//------</span>
    <span class="token keyword">class</span> <span class="token class-name">TaskQueue</span> <span class="token punctuation">{</span>
        running <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        queue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token function">pushTask</span><span class="token punctuation">(</span><span class="token parameter">task</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
            self<span class="token punctuation">.</span>queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
            self<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>running <span class="token operator">&lt;</span> pool <span class="token operator">&amp;&amp;</span> self<span class="token punctuation">.</span>queue<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                self<span class="token punctuation">.</span>running<span class="token operator">++</span><span class="token punctuation">;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>queue<span class="token punctuation">,</span> <span class="token string">'self.queue'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">let</span> task <span class="token operator">=</span> self<span class="token punctuation">.</span>queue<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">task</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    self<span class="token punctuation">.</span>results<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    self<span class="token punctuation">.</span>running<span class="token operator">--</span><span class="token punctuation">;</span>
                    self<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>running <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">callback</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>results<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> <span class="token constant">TQ</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TaskQueue</span><span class="token punctuation">;</span>
    tasks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">task</span> <span class="token operator">=&gt;</span> <span class="token constant">TQ</span><span class="token punctuation">.</span><span class="token function">pushTask</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//使用</span>
<span class="token function">createRequest</span><span class="token punctuation">(</span>tasks<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token parameter">results</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// console.log(results);</span>
    console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'cost'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="componse-2"><a href="#componse-2" class="header-anchor">#</a> componse</h2> <div class="language-js extra-class"><pre class="language-js"><code>
 <span class="token keyword">function</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>funcs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>funcs<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token parameter">args</span> <span class="token operator">=&gt;</span> args<span class="token punctuation">;</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>funcs<span class="token punctuation">.</span>length <span class="token operator">===</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">return</span> funcs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token keyword">return</span> funcs<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">func<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre></div><h2 id="性能优化"><a href="#性能优化" class="header-anchor">#</a> 性能优化</h2> <p>1.较小的图片用base54加载更快</p> <p>2.图片加载启用webp/使用阿里云OSS服务 启用webp/项目私有化部署</p> <p>3.script标签特性
async  异步加载资源 立即执行 执行的过程中会阻塞</p> <p>defer</p> <p>充分利用link标签 dns-prefetch</p> <p>css资源分包处理 实现懒加载</p> <ol start="4"><li><p>性能优化指标 首屏渲染 请求响应速度 performace 可以查看 页面资源加载速度等</p></li> <li><p>tree-shaking</p></li> <li><p>4-2 使用 DllPlugin 可以提高构建速度</p></li></ol> <p>7.开启多个子进程进行打包</p> <ol start="8"><li>文件压缩等</li></ol> <h2 id="reduce"><a href="#reduce" class="header-anchor">#</a> reduce</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">reduce</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">callback<span class="token punctuation">,</span>prev</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">//遍历this 数组</span>
   <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment">//判断有没有设置初始值</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> prev <span class="token operator">===</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token comment">//没有初始值，则调用callback,转入当前值，下一个值，当前index为下一个,当前数组</span>
           prev <span class="token operator">=</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
           <span class="token comment">//有初始值，则调用callback，传入prev为第一个值，第二个为当前的i,当前index为i,当前数组</span>
           prev <span class="token operator">=</span> <span class="token function">callback</span><span class="token punctuation">(</span>prev<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> prev<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> r1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">prevValue<span class="token punctuation">,</span> currentValue<span class="token punctuation">,</span> currentIndex<span class="token punctuation">,</span> array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> prevValue <span class="token operator">+</span> currentValue<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r1<span class="token punctuation">)</span>
</code></pre></div><h2 id="vue-router"><a href="#vue-router" class="header-anchor">#</a> vue-router</h2> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token keyword">let</span> queue <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>router<span class="token punctuation">.</span>beforeHooks<span class="token punctuation">;</span>

        <span class="token keyword">const</span> <span class="token function-variable function">iterator</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">hook<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span> <span class="token comment">// 此迭代函数可以拿到对应的hook</span>
            <span class="token function">hook</span><span class="token punctuation">(</span>route<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>current<span class="token punctuation">,</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">runQueue</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span>iterator<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateRoute</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span><span class="token punctuation">;</span>
            cb <span class="token operator">&amp;&amp;</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 默认第一次cb是hashchange</span>

            <span class="token comment">// 后置的钩子</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><h2 id="异步组件"><a href="#异步组件" class="header-anchor">#</a> 异步组件</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 实现loading效果</span>
<span class="token keyword">import</span> Loading <span class="token keyword">from</span> <span class="token string">'@/components/Loading.vue'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> ErrorComponent <span class="token keyword">from</span> <span class="token string">'../components/error.vue'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Loading<span class="token punctuation">,</span> <span class="token string">'Loading'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Loading<span class="token punctuation">,</span> <span class="token string">'Loading'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">loadable</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">asyncFunction</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'异步加载的组件'</span><span class="token punctuation">,</span> Loading<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">component</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    component<span class="token operator">:</span> <span class="token function">asyncFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    loading<span class="token operator">:</span> Loading<span class="token punctuation">,</span>
    delay<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
    error<span class="token operator">:</span> ErrorComponent<span class="token punctuation">,</span>
    timeout<span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 最终要返回一个组件，组件需要有render，通过render 在去渲染一个异步组件</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token comment">// cli 默认不支持模板</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span>component<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// 组件是一个对象 会变成render函数</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> loadable<span class="token punctuation">;</span>
</code></pre></div><h2 id="表头固定"><a href="#表头固定" class="header-anchor">#</a> 表头固定</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token comment">//固定表头必须有height属性</span>
               <span class="token keyword">this</span><span class="token punctuation">.</span>table <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>table<span class="token punctuation">;</span>
               <span class="token keyword">this</span><span class="token punctuation">.</span>tableWrapper <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>tableWrapper<span class="token punctuation">;</span>
               <span class="token comment">//拷贝一个空表格</span>
               <span class="token keyword">let</span> copyTable <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>table<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//不传参数true只能拷贝父节点</span>
               <span class="token keyword">let</span> thead <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>table<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
               <span class="token comment">//先取高度再移走</span>
               <span class="token keyword">this</span><span class="token punctuation">.</span>tableWrapper<span class="token punctuation">.</span>style<span class="token punctuation">.</span>paddingTop <span class="token operator">=</span> thead<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>height <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>

               copyTable<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>thead<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//将thead移动到新新的空表格上</span>
               <span class="token comment">//被拷贝的元素就没有了</span>
               <span class="token keyword">this</span><span class="token punctuation">.</span>tableWrapper<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>copyTable<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//将拷贝后的插入到新的表格中</span>
               copyTable<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'fixed-header'</span><span class="token punctuation">)</span>
           <span class="token punctuation">}</span>

</code></pre></div><h2 id="树形结构生成"><a href="#树形结构生成" class="header-anchor">#</a> 树形结构生成</h2> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token function">transferData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> Alldata <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">cloneDeep</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> treeMapList <span class="token operator">=</span> Alldata<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">memo<span class="token punctuation">,</span> current</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        memo<span class="token punctuation">[</span>current<span class="token punctuation">[</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> current<span class="token punctuation">;</span>
        <span class="token keyword">return</span> memo<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//   console.log(treeMapList, &quot;treeMapList&quot;);</span>
      <span class="token keyword">let</span> res <span class="token operator">=</span> Alldata<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> current</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        current<span class="token punctuation">.</span>label <span class="token operator">=</span> current<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
        <span class="token comment">//   console.log(arr, current, &quot;arr-current&quot;);</span>
        <span class="token keyword">let</span> pid <span class="token operator">=</span> current<span class="token punctuation">.</span>pid<span class="token punctuation">;</span>
        <span class="token keyword">let</span> parent <span class="token operator">=</span> treeMapList<span class="token punctuation">[</span>pid<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          parent<span class="token punctuation">.</span>children
            <span class="token operator">?</span> parent<span class="token punctuation">.</span>children<span class="token punctuation">.</span>push<span class="token punctuation">[</span>current<span class="token punctuation">]</span>
            <span class="token operator">:</span> <span class="token punctuation">(</span>parent<span class="token punctuation">.</span>children <span class="token operator">=</span> <span class="token punctuation">[</span>current<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pid <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> arr<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>Alldata <span class="token operator">=</span> res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="算法"><a href="#算法" class="header-anchor">#</a> 算法</h2> <div class="language-js extra-class"><pre class="language-js"><code>
</code></pre></div><h2 id="require"><a href="#require" class="header-anchor">#</a> require</h2> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;vm&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Module</span><span class="token punctuation">(</span><span class="token parameter">filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> filename<span class="token punctuation">;</span> <span class="token comment">//当前文件名</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>path <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//父亲目录</span>
<span class="token punctuation">}</span>
Module<span class="token punctuation">.</span>wrapper <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">(function(exports,require,module,__filename,__dirname){</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">})</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

Module<span class="token punctuation">.</span>_extensions <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;.js&quot;</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> content <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token string">&quot;utf8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    content <span class="token operator">=</span> Module<span class="token punctuation">.</span>wrapper<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> content <span class="token operator">+</span> Module<span class="token punctuation">.</span>wrapper<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> fn <span class="token operator">=</span> vm<span class="token punctuation">.</span><span class="token function">runInThisContext</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//让字符串执行</span>
    <span class="token keyword">let</span> exports <span class="token operator">=</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span> <span class="token comment">//指向同一个对象</span>
    <span class="token comment">// let dirname = path.dirname(module.id);</span>
    <span class="token comment">//模块中的this是module.exports</span>
    <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> req<span class="token punctuation">,</span> module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>id<span class="token punctuation">,</span> module<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">&quot;.json&quot;</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> content <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token string">&quot;utf8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//手动将结果赋值给 module.exports</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//解析当前的文件名</span>
Module<span class="token punctuation">.</span><span class="token function-variable function">_resolveFilename</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> absPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> isExists <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>absPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isExists<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> absPath<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 尝试添加 js json后缀</span>
    <span class="token keyword">let</span> keys <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">ownKeys</span><span class="token punctuation">(</span>Module<span class="token punctuation">.</span>_extensions<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> newPath <span class="token operator">=</span> absPath <span class="token operator">+</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//尝试增加后缀</span>
      <span class="token keyword">let</span> flag <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>newPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> newPath<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;module not exists&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name">Module</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">load</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> extensions <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//加载时 获取后缀名 根据不同后缀名 不同处理</span>
  Module<span class="token punctuation">.</span>_extensions<span class="token punctuation">[</span>extensions<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//this当前模块</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
Module<span class="token punctuation">.</span>_cache <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//let r = req('/a') 同时存在 js json</span>
<span class="token keyword">function</span> <span class="token function">req</span><span class="token punctuation">(</span><span class="token parameter">filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//1.解析当前的文件名 尝试添加 js json后缀</span>
  filename <span class="token operator">=</span> Module<span class="token punctuation">.</span><span class="token function">_resolveFilename</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//4.2如果有缓存 直接取出</span>
  <span class="token keyword">let</span> cacheModule <span class="token operator">=</span> Module<span class="token punctuation">.</span>_cache<span class="token punctuation">[</span>filename<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cacheModule<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> cacheModule<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//2.创建一个模块</span>
  <span class="token keyword">let</span> module <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Module</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//4.1如果在文件中多次引用同一个文件 --- 做个缓存</span>
  <span class="token comment">//module.exports = a; a 是一个具体的值 内部变量发生变化 检测不到</span>
  <span class="token comment">//es6模块 内部变量发生变化 取值可以取新新值 只能放在顶层代码块中 不能放在代码块中</span>
  Module<span class="token punctuation">.</span>_cache<span class="token punctuation">[</span>filename<span class="token punctuation">]</span> <span class="token operator">=</span> module<span class="token punctuation">;</span>
  <span class="token comment">//3.加载模块</span>
  module<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span> <span class="token comment">//最终要返还回去</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="events"><a href="#events" class="header-anchor">#</a> events</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_events <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">EventEmitter</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">on</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span>callback</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_events <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 如果用户绑定的不是newListener 让newListener的回调函数执行</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>eventName <span class="token operator">!==</span> <span class="token string">'newListener'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//if(this._events['newListener']){</span>
         <span class="token comment">//   this._events['newListener'].forEach(fn=&gt;fn(eventName))</span>
       <span class="token comment">// }</span>
     <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&quot;newListener&quot;</span><span class="token punctuation">,</span> eventName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>callback<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// {newListener:[fn1]}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token class-name">EventEmitter</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">off</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">fn</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> fn <span class="token operator">!=</span> callback <span class="token operator">&amp;&amp;</span> fn<span class="token punctuation">.</span>l <span class="token operator">!==</span> callback<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name">EventEmitter</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">emit</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fn</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name">EventEmitter</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">once</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token function-variable function">one</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">callback</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 删除掉这个函数</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span>eventName<span class="token punctuation">,</span> one<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 执行完后在删除掉</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  one<span class="token punctuation">.</span>l <span class="token operator">=</span> callback<span class="token punctuation">;</span> <span class="token comment">// one.l = fn; 用来标识 绑定的时候是one是谁的 我删除的时候单纯判断name找不到</span>
  <span class="token comment">/**
      girl.once('失恋', function(w) { 
                  console.log(w+'监听到了执行')
              })
      girl.off('失恋', function(w) { 
          console.log(w+'监听到了执行')
      }) //这时候删除 需要 one.l = callback 标识一下
    **/</span>
  <span class="token comment">// 先绑定一个once函数，等待emit触发完后执行one函数 ，执行原有的逻辑，执行后删除once函数</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>eventName<span class="token punctuation">,</span> one<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="如何实现图片压缩"><a href="#如何实现图片压缩" class="header-anchor">#</a> 如何实现图片压缩</h2> <h2 id="webpack-项目体积过大-怎么优化"><a href="#webpack-项目体积过大-怎么优化" class="header-anchor">#</a> webpack 项目体积过大 怎么优化</h2> <p>其实就是要说整个思路就得  分析工具去分析  然后去找问题。。。</p> <h2 id="如何实现请求并发"><a href="#如何实现请求并发" class="header-anchor">#</a> 如何实现请求并发</h2> <h2 id="promise-all-的原理"><a href="#promise-all-的原理" class="header-anchor">#</a> Promise.all 的原理</h2> <h2 id="如何实现虚拟滚动"><a href="#如何实现虚拟滚动" class="header-anchor">#</a> 如何实现虚拟滚动</h2> <p>用法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>virtual<span class="token operator">-</span>list <span class="token operator">:</span>size<span class="token operator">=</span><span class="token string">&quot;30&quot;</span> <span class="token operator">:</span>remain<span class="token operator">=</span><span class="token string">&quot;8&quot;</span> <span class="token operator">:</span>items<span class="token operator">=</span><span class="token string">&quot;items&quot;</span> <span class="token operator">:</span>variable<span class="token operator">=</span><span class="token string">&quot;true&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Item slot<span class="token operator">-</span>scope<span class="token operator">=</span><span class="token string">&quot;{ item }&quot;</span> <span class="token operator">:</span>item<span class="token operator">=</span><span class="token string">&quot;item&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>virtual<span class="token operator">-</span>list<span class="token operator">&gt;</span>
</code></pre></div><p>items: Array,
size: Number,//当前每一个的高度 可以算出滚动条的高度
remain: Number,//可见多少个  可视区域渲染多少个
variable: Boolean // 不知道固定高度 每一行高度不确定要开启动态计算</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//可渲染的数据</span>
     <span class="token function">visibleData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//会根据start end去截取渲染</span>
       <span class="token keyword">let</span> start <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>start <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>prevCount<span class="token punctuation">;</span> <span class="token comment">//前面多加载一点</span>
       <span class="token keyword">let</span> end <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>end <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>nextCount<span class="token punctuation">;</span> <span class="token comment">//留一点位置 多加载一点</span>
       <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>formatData<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>计算渲染高度
滚动的时候去计算应该渲染多少</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token comment">// 计算开始 获取当前应该从第几个开始</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>start <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>scrollTop <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 计算结束</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>end <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>start <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>remain<span class="token punctuation">;</span> <span class="token comment">//当前可渲染的区域</span>
        <span class="token comment">// 计算偏移量 可视区域计算偏移量</span>
        <span class="token comment">// this.offset = this.start * this.size - this.prevCount * this.size</span>
        <span class="token comment">//让当前渲染的内容在可是区域内</span>
        <span class="token comment">//如果有预留渲染 应该减去前面增加的预留部分</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>offset <span class="token operator">=</span>
          scrollTop <span class="token operator">-</span> <span class="token punctuation">(</span>scrollTop <span class="token operator">%</span> <span class="token keyword">this</span><span class="token punctuation">.</span>size<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>prevCount <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>size<span class="token punctuation">;</span>
</code></pre></div><p>//先预估高度posionts 然后滚动的时候更新每行的position位置 -- getBoundingClientRect</p> <p>-- 然后更新最新真实高度 通过二分查找的方式查找当前开始位置</p> <h2 id="webpack优化"><a href="#webpack优化" class="header-anchor">#</a> webpack优化</h2> <ul><li>代码层面</li></ul> <p>img 如果不需要那么大 可以对图片进行压缩上传</p> <p>数据过多的 考虑到懒加载 和 虚拟滚动去实现</p> <p>数组循环能用some用some 因为可以提前终止掉</p> <p>遍历数组的时候 可以用到广度优先遍历 就是找children id 那个 用栈</p> <p>使用Es6规范导入代码可以实现treeShaking
如果一个函数依赖了另一个函数 可以用高阶函数进行包裹 如果被包裹的函数没有被用到 也会被检测到</p> <p>组件封装 vue是组件级渲染的 每个组件都有一个渲染watcher</p> <ul><li>网络层面
减少HTTP请求数，合并JS、CSS,合理内嵌CSS、JS</li></ul> <p>合理设置服务端缓存，提高服务器处理速度。 (强制缓存、对比缓存)</p> <p>// Expires/Cache-Control   Etag/if-none-match/last-modified/if-modified-since
避免重定向，重定向会降低响应速度 (301,302)</p> <p>使用dns-prefetch,进行DNS预解析</p> <p>采用域名分片技术，将资源放到不同的域名下。接触同一个域名最多处理6个TCP链接问题。</p> <p>采用CDN加速加快访问速度。(指派最近、高度可用)</p> <p>gzip压缩优化 对传输资源进行体积压缩 (html,js,css)</p> <p>// Content-Encoding: gzip
加载数据优先级 : preload（预先请求当前页面需要的资源） prefetch（将来页面中使用的资源） 将数据缓存到HTTP缓存中</p> <p>项目依赖太大 -- 用分析工具分析  ---用DLLPlugin 动态链接库</p> <ul><li><p>http 网络请求这一块</p></li> <li><p>webpack
1.通常来说，我们的代码都可以至少简单区分成业务代码和第三方库。如果不做处理，
每次构建时都需要把所有的代码重新构建一次，耗费大量的时间。
然后大部分情况下，很多第三方库的代码并不会发生变更（除非是版本升级），
这时就可以用到dll：把复用性较高的第三方模块打包到动态链接库中，
在不升级这些库的情况下，动态库不需要重新打包，每次构建只重新打包业务代码。</p></li></ul> <p>2.babel-plugin-import 实现自动按需打包 。实现的就是按需加载</p> <p>import { Button } from 'antd';
这样的引用，会使得最终打包的代码中包含所有 antd 导出来的内容。假设应用中并没有使用 antd 提供的 TimePicker 组件，那么对于打包结果来说，无疑增加了代码体积。在这种情况下，如果组件库提供了 ES Module 版本，
并开启了 Tree Shaking，我们就可以通过“摇树”特性，将不会被使用的代码在构建阶段移除。
Webpack 可以在 package.json 中设置sideEffects: false。
我们在 antd 源码当中可以找到（相关 chore commit）：</p> <p>2.split-chunks-plugin 通过 splitChunk 插件提取公共代码（公共代码分割）。
提供了以下能力
在压缩前体积大于 30KB 的模块；
在按需加载模块时，并行加载的模块不得超过 5 个；
在页面初始化加载时，并行加载的模块不得超过 3 个。</p> <p>3.第三方库Cdn</p> <p>4.css 单独引入 打包成link 利用link的新特性</p> <ol start="5"><li>treeShaking Es6模块 使用不到的代码 可以被抛弃
习惯将常量写在类中，但在组件函数中，这意味着每次渲染都会重新声明常量，
这是完全无意义的操作。其次就是组件内的函数每次会被重新创建，如果这个函数需要使用函数组件内部的变量，
那么可以用 useCallback 包裹下这个函数。</li></ol> <p>第三点就是 useEffect 的第二个参数容易被错误使用。很多同学习惯在第二个参数放置引用类型的变量，
通常的情况下，引用类型的变量很容易被篡改，难以判断开发者的真实意图，所以更推荐使用值类型的变量。
当然有个小技巧是 JSON 序列化引用类型的变量，也就是通过 JSON.stringify 将引用类型变量转换为字符串来解决。
但不推荐这个操作方式，比较消耗性能。</p> <h2 id="redux-2"><a href="#redux-2" class="header-anchor">#</a> redux</h2> <p>View（视图层）：用户界面。该用户界面可以是以任何形式实现出来的，React 组件是一种形式，Vue、Angular 也完全 OK。Flux 架构与 React 之间并不存在耦合关系。</p> <p>Action（动作）：也可以理解为视图层发出的“消息”，它会触发应用状态的改变。</p> <p>Dispatcher（派发器）：它负责对 action 进行分发。</p> <p>Store（数据层）：它是存储应用状态的“仓库”，此外还会定义修改状态的逻辑。store 的变化最终会映射到 view 层上去。</p> <p>Store：它是一个单一的数据源，而且是只读的。</p> <p>Action 人如其名，是“动作”的意思，它是对变化的描述。</p> <p>Reducer 是一个函数，它负责对变化进行分发和处理，最终将新的数据返回给 Store。</p> <p>applyMiddleware.js</p> <p>bindActionCreators.js</p> <p>combineReducers.js</p> <p>compose.js</p> <p>createStore.js</p> <p>createStore 方法可以接收以下 3 个入参：</p> <p>reducer</p> <p>初始状态内容</p> <p>指定中间件</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token comment">// 引入 redux</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>
<span class="token comment">// 创建 store</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>
    reducer<span class="token punctuation">,</span>
    initial_state<span class="token punctuation">,</span>
    <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>middleware1<span class="token punctuation">,</span> middleware2<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>createStore</p> <p>getState</p> <p>subscribe</p> <p>dispatch
Redux 工作流的核心：dispatch 动作</p> <ol><li>通过“上锁”避免“套娃式”的 dispatch</li></ol> <p>在调用 reducer 之前，Redux 首先会将 isDispatching 变量置为 true，待 reducer 执行完毕后，
再将 isDispatching 变量置为 false。这个操作你应该不陌生，
因为在第 11 讲中，setState 的“批处理”也是用类似的“上锁”方式来实现的。
当dispatch action 发生时，Redux 会在 reducer 执行完毕后，
将 listeners 数组中的监听函数逐个执行。这就是 subscribe 与 Redux 主流程之间的关系。</p> <h2 id="componse-3"><a href="#componse-3" class="header-anchor">#</a> componse</h2> <p>实现</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">function</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>funcs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>funcs<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token parameter">args</span> <span class="token operator">=&gt;</span> args<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>funcs<span class="token punctuation">.</span>length <span class="token operator">===</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> funcs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> funcs<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">func<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="api限制并发-2"><a href="#api限制并发-2" class="header-anchor">#</a> api限制并发</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createRequest</span><span class="token punctuation">(</span><span class="token parameter">tasks<span class="token punctuation">,</span> pool<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> pool <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        callback <span class="token operator">=</span> pool<span class="token punctuation">;</span>
        pool <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> pool <span class="token operator">!==</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">)</span> pool <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> callback <span class="token operator">!==</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token function-variable function">callback</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">//------</span>
    <span class="token keyword">class</span> <span class="token class-name">TaskQueue</span> <span class="token punctuation">{</span>
        running <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        queue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token function">pushTask</span><span class="token punctuation">(</span><span class="token parameter">task</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
            self<span class="token punctuation">.</span>queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
            self<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>running <span class="token operator">&lt;</span> pool <span class="token operator">&amp;&amp;</span> self<span class="token punctuation">.</span>queue<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                self<span class="token punctuation">.</span>running<span class="token operator">++</span><span class="token punctuation">;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>queue<span class="token punctuation">,</span> <span class="token string">'self.queue'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">let</span> task <span class="token operator">=</span> self<span class="token punctuation">.</span>queue<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">task</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    self<span class="token punctuation">.</span>results<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    self<span class="token punctuation">.</span>running<span class="token operator">--</span><span class="token punctuation">;</span>
                    self<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>running <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">callback</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>results<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> <span class="token constant">TQ</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TaskQueue</span><span class="token punctuation">;</span>
    tasks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">task</span> <span class="token operator">=&gt;</span> <span class="token constant">TQ</span><span class="token punctuation">.</span><span class="token function">pushTask</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//使用</span>
<span class="token function">createRequest</span><span class="token punctuation">(</span>tasks<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token parameter">results</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// console.log(results);</span>
    console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'cost'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="componse-4"><a href="#componse-4" class="header-anchor">#</a> componse</h2> <div class="language-js extra-class"><pre class="language-js"><code>
 <span class="token keyword">function</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>funcs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>funcs<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token parameter">args</span> <span class="token operator">=&gt;</span> args<span class="token punctuation">;</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>funcs<span class="token punctuation">.</span>length <span class="token operator">===</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">return</span> funcs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token keyword">return</span> funcs<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">func<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre></div><h2 id="性能优化-2"><a href="#性能优化-2" class="header-anchor">#</a> 性能优化</h2> <p>1.较小的图片用base54加载更快</p> <p>2.图片加载启用webp/使用阿里云OSS服务 启用webp/项目私有化部署</p> <p>3.script标签特性
async  异步加载资源 立即执行 执行的过程中会阻塞</p> <p>defer</p> <p>充分利用link标签 dns-prefetch</p> <p>css资源分包处理 实现懒加载</p> <ol start="4"><li><p>性能优化指标 首屏渲染 请求响应速度 performace 可以查看 页面资源加载速度等</p></li> <li><p>tree-shaking</p></li> <li><p>4-2 使用 DllPlugin 可以提高构建速度</p></li></ol> <p>7.开启多个子进程进行打包</p> <ol start="8"><li>文件压缩等</li></ol> <h2 id="reduce-2"><a href="#reduce-2" class="header-anchor">#</a> reduce</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">reduce</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">callback<span class="token punctuation">,</span>prev</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">//遍历this 数组</span>
   <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment">//判断有没有设置初始值</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> prev <span class="token operator">===</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token comment">//没有初始值，则调用callback,转入当前值，下一个值，当前index为下一个,当前数组</span>
           prev <span class="token operator">=</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
           <span class="token comment">//有初始值，则调用callback，传入prev为第一个值，第二个为当前的i,当前index为i,当前数组</span>
           prev <span class="token operator">=</span> <span class="token function">callback</span><span class="token punctuation">(</span>prev<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> prev<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> r1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">prevValue<span class="token punctuation">,</span> currentValue<span class="token punctuation">,</span> currentIndex<span class="token punctuation">,</span> array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> prevValue <span class="token operator">+</span> currentValue<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r1<span class="token punctuation">)</span>
</code></pre></div><h2 id="vue-router-2"><a href="#vue-router-2" class="header-anchor">#</a> vue-router</h2> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token keyword">let</span> queue <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>router<span class="token punctuation">.</span>beforeHooks<span class="token punctuation">;</span>

        <span class="token keyword">const</span> <span class="token function-variable function">iterator</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">hook<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span> <span class="token comment">// 此迭代函数可以拿到对应的hook</span>
            <span class="token function">hook</span><span class="token punctuation">(</span>route<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>current<span class="token punctuation">,</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">runQueue</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span>iterator<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateRoute</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span><span class="token punctuation">;</span>
            cb <span class="token operator">&amp;&amp;</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 默认第一次cb是hashchange</span>

            <span class="token comment">// 后置的钩子</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><h2 id="异步组件-2"><a href="#异步组件-2" class="header-anchor">#</a> 异步组件</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 实现loading效果</span>
<span class="token keyword">import</span> Loading <span class="token keyword">from</span> <span class="token string">'@/components/Loading.vue'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> ErrorComponent <span class="token keyword">from</span> <span class="token string">'../components/error.vue'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Loading<span class="token punctuation">,</span> <span class="token string">'Loading'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Loading<span class="token punctuation">,</span> <span class="token string">'Loading'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">loadable</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">asyncFunction</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'异步加载的组件'</span><span class="token punctuation">,</span> Loading<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">component</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    component<span class="token operator">:</span> <span class="token function">asyncFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    loading<span class="token operator">:</span> Loading<span class="token punctuation">,</span>
    delay<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
    error<span class="token operator">:</span> ErrorComponent<span class="token punctuation">,</span>
    timeout<span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 最终要返回一个组件，组件需要有render，通过render 在去渲染一个异步组件</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token comment">// cli 默认不支持模板</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span>component<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// 组件是一个对象 会变成render函数</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> loadable<span class="token punctuation">;</span>
</code></pre></div><h2 id="表头固定-2"><a href="#表头固定-2" class="header-anchor">#</a> 表头固定</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token comment">//固定表头必须有height属性</span>
               <span class="token keyword">this</span><span class="token punctuation">.</span>table <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>table<span class="token punctuation">;</span>
               <span class="token keyword">this</span><span class="token punctuation">.</span>tableWrapper <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>tableWrapper<span class="token punctuation">;</span>
               <span class="token comment">//拷贝一个空表格</span>
               <span class="token keyword">let</span> copyTable <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>table<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//不传参数true只能拷贝父节点</span>
               <span class="token keyword">let</span> thead <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>table<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
               <span class="token comment">//先取高度再移走</span>
               <span class="token keyword">this</span><span class="token punctuation">.</span>tableWrapper<span class="token punctuation">.</span>style<span class="token punctuation">.</span>paddingTop <span class="token operator">=</span> thead<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>height <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>

               copyTable<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>thead<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//将thead移动到新新的空表格上</span>
               <span class="token comment">//被拷贝的元素就没有了</span>
               <span class="token keyword">this</span><span class="token punctuation">.</span>tableWrapper<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>copyTable<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//将拷贝后的插入到新的表格中</span>
               copyTable<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'fixed-header'</span><span class="token punctuation">)</span>
           <span class="token punctuation">}</span>

</code></pre></div><h2 id="树形结构生成-2"><a href="#树形结构生成-2" class="header-anchor">#</a> 树形结构生成</h2> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token function">transferData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> Alldata <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">cloneDeep</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> treeMapList <span class="token operator">=</span> Alldata<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">memo<span class="token punctuation">,</span> current</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        memo<span class="token punctuation">[</span>current<span class="token punctuation">[</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> current<span class="token punctuation">;</span>
        <span class="token keyword">return</span> memo<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//   console.log(treeMapList, &quot;treeMapList&quot;);</span>
      <span class="token keyword">let</span> res <span class="token operator">=</span> Alldata<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> current</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        current<span class="token punctuation">.</span>label <span class="token operator">=</span> current<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
        <span class="token comment">//   console.log(arr, current, &quot;arr-current&quot;);</span>
        <span class="token keyword">let</span> pid <span class="token operator">=</span> current<span class="token punctuation">.</span>pid<span class="token punctuation">;</span>
        <span class="token keyword">let</span> parent <span class="token operator">=</span> treeMapList<span class="token punctuation">[</span>pid<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          parent<span class="token punctuation">.</span>children
            <span class="token operator">?</span> parent<span class="token punctuation">.</span>children<span class="token punctuation">.</span>push<span class="token punctuation">[</span>current<span class="token punctuation">]</span>
            <span class="token operator">:</span> <span class="token punctuation">(</span>parent<span class="token punctuation">.</span>children <span class="token operator">=</span> <span class="token punctuation">[</span>current<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pid <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> arr<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>Alldata <span class="token operator">=</span> res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="require-2"><a href="#require-2" class="header-anchor">#</a> require</h2> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;vm&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Module</span><span class="token punctuation">(</span><span class="token parameter">filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> filename<span class="token punctuation">;</span> <span class="token comment">//当前文件名</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>path <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//父亲目录</span>
<span class="token punctuation">}</span>
Module<span class="token punctuation">.</span>wrapper <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">(function(exports,require,module,__filename,__dirname){</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">})</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

Module<span class="token punctuation">.</span>_extensions <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;.js&quot;</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> content <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token string">&quot;utf8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    content <span class="token operator">=</span> Module<span class="token punctuation">.</span>wrapper<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> content <span class="token operator">+</span> Module<span class="token punctuation">.</span>wrapper<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> fn <span class="token operator">=</span> vm<span class="token punctuation">.</span><span class="token function">runInThisContext</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//让字符串执行</span>
    <span class="token keyword">let</span> exports <span class="token operator">=</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span> <span class="token comment">//指向同一个对象</span>
    <span class="token comment">// let dirname = path.dirname(module.id);</span>
    <span class="token comment">//模块中的this是module.exports</span>
    <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> req<span class="token punctuation">,</span> module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>id<span class="token punctuation">,</span> module<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">&quot;.json&quot;</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> content <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token string">&quot;utf8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//手动将结果赋值给 module.exports</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//解析当前的文件名</span>
Module<span class="token punctuation">.</span><span class="token function-variable function">_resolveFilename</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> absPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> isExists <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>absPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isExists<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> absPath<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 尝试添加 js json后缀</span>
    <span class="token keyword">let</span> keys <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">ownKeys</span><span class="token punctuation">(</span>Module<span class="token punctuation">.</span>_extensions<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> newPath <span class="token operator">=</span> absPath <span class="token operator">+</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//尝试增加后缀</span>
      <span class="token keyword">let</span> flag <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>newPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> newPath<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;module not exists&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name">Module</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">load</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> extensions <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//加载时 获取后缀名 根据不同后缀名 不同处理</span>
  Module<span class="token punctuation">.</span>_extensions<span class="token punctuation">[</span>extensions<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//this当前模块</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
Module<span class="token punctuation">.</span>_cache <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//let r = req('/a') 同时存在 js json</span>
<span class="token keyword">function</span> <span class="token function">req</span><span class="token punctuation">(</span><span class="token parameter">filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//1.解析当前的文件名 尝试添加 js json后缀</span>
  filename <span class="token operator">=</span> Module<span class="token punctuation">.</span><span class="token function">_resolveFilename</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//4.2如果有缓存 直接取出</span>
  <span class="token keyword">let</span> cacheModule <span class="token operator">=</span> Module<span class="token punctuation">.</span>_cache<span class="token punctuation">[</span>filename<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cacheModule<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> cacheModule<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//2.创建一个模块</span>
  <span class="token keyword">let</span> module <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Module</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//4.1如果在文件中多次引用同一个文件 --- 做个缓存</span>
  <span class="token comment">//module.exports = a; a 是一个具体的值 内部变量发生变化 检测不到</span>
  <span class="token comment">//es6模块 内部变量发生变化 取值可以取新新值 只能放在顶层代码块中 不能放在代码块中</span>
  Module<span class="token punctuation">.</span>_cache<span class="token punctuation">[</span>filename<span class="token punctuation">]</span> <span class="token operator">=</span> module<span class="token punctuation">;</span>
  <span class="token comment">//3.加载模块</span>
  module<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span> <span class="token comment">//最终要返还回去</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="events源码模拟"><a href="#events源码模拟" class="header-anchor">#</a> events源码模拟</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_events <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">EventEmitter</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">on</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span>callback</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_events <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 如果用户绑定的不是newListener 让newListener的回调函数执行</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>eventName <span class="token operator">!==</span> <span class="token string">'newListener'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//if(this._events['newListener']){</span>
         <span class="token comment">//   this._events['newListener'].forEach(fn=&gt;fn(eventName))</span>
       <span class="token comment">// }</span>
     <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&quot;newListener&quot;</span><span class="token punctuation">,</span> eventName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>callback<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// {newListener:[fn1]}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token class-name">EventEmitter</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">off</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">fn</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> fn <span class="token operator">!=</span> callback <span class="token operator">&amp;&amp;</span> fn<span class="token punctuation">.</span>l <span class="token operator">!==</span> callback<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name">EventEmitter</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">emit</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fn</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name">EventEmitter</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">once</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token function-variable function">one</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">callback</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 删除掉这个函数</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span>eventName<span class="token punctuation">,</span> one<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 执行完后在删除掉</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  one<span class="token punctuation">.</span>l <span class="token operator">=</span> callback<span class="token punctuation">;</span> <span class="token comment">// one.l = fn; 用来标识 绑定的时候是one是谁的 我删除的时候单纯判断name找不到</span>
  <span class="token comment">/**
      girl.once('失恋', function(w) { 
                  console.log(w+'监听到了执行')
              })
      girl.off('失恋', function(w) { 
          console.log(w+'监听到了执行')
      }) //这时候删除 需要 one.l = callback 标识一下
    **/</span>
  <span class="token comment">// 先绑定一个once函数，等待emit触发完后执行one函数 ，执行原有的逻辑，执行后删除once函数</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>eventName<span class="token punctuation">,</span> one<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="如何实现图片压缩-2"><a href="#如何实现图片压缩-2" class="header-anchor">#</a> 如何实现图片压缩</h2> <h2 id="webpack-项目体积过大-怎么优化-2"><a href="#webpack-项目体积过大-怎么优化-2" class="header-anchor">#</a> webpack 项目体积过大 怎么优化</h2> <p>其实就是要说整个思路就得  分析工具去分析  然后去找问题。。。</p> <h2 id="如何实现请求并发-2"><a href="#如何实现请求并发-2" class="header-anchor">#</a> 如何实现请求并发</h2> <h2 id="promise-all-的原理-2"><a href="#promise-all-的原理-2" class="header-anchor">#</a> Promise.all 的原理</h2> <h2 id="如何实现虚拟滚动-2"><a href="#如何实现虚拟滚动-2" class="header-anchor">#</a> 如何实现虚拟滚动</h2> <p>用法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>virtual<span class="token operator">-</span>list <span class="token operator">:</span>size<span class="token operator">=</span><span class="token string">&quot;30&quot;</span> <span class="token operator">:</span>remain<span class="token operator">=</span><span class="token string">&quot;8&quot;</span> <span class="token operator">:</span>items<span class="token operator">=</span><span class="token string">&quot;items&quot;</span> <span class="token operator">:</span>variable<span class="token operator">=</span><span class="token string">&quot;true&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Item slot<span class="token operator">-</span>scope<span class="token operator">=</span><span class="token string">&quot;{ item }&quot;</span> <span class="token operator">:</span>item<span class="token operator">=</span><span class="token string">&quot;item&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>virtual<span class="token operator">-</span>list<span class="token operator">&gt;</span>
</code></pre></div><p>items: Array,
size: Number,//当前每一个的高度 可以算出滚动条的高度
remain: Number,//可见多少个  可视区域渲染多少个
variable: Boolean // 不知道固定高度 每一行高度不确定要开启动态计算</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//可渲染的数据</span>
     <span class="token function">visibleData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//会根据start end去截取渲染</span>
       <span class="token keyword">let</span> start <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>start <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>prevCount<span class="token punctuation">;</span> <span class="token comment">//前面多加载一点</span>
       <span class="token keyword">let</span> end <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>end <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>nextCount<span class="token punctuation">;</span> <span class="token comment">//留一点位置 多加载一点</span>
       <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>formatData<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>计算渲染高度
滚动的时候去计算应该渲染多少</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token comment">// 计算开始 获取当前应该从第几个开始</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>start <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>scrollTop <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 计算结束</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>end <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>start <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>remain<span class="token punctuation">;</span> <span class="token comment">//当前可渲染的区域</span>
        <span class="token comment">// 计算偏移量 可视区域计算偏移量</span>
        <span class="token comment">// this.offset = this.start * this.size - this.prevCount * this.size</span>
        <span class="token comment">//让当前渲染的内容在可是区域内</span>
        <span class="token comment">//如果有预留渲染 应该减去前面增加的预留部分</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>offset <span class="token operator">=</span>
          scrollTop <span class="token operator">-</span> <span class="token punctuation">(</span>scrollTop <span class="token operator">%</span> <span class="token keyword">this</span><span class="token punctuation">.</span>size<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>prevCount <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>size<span class="token punctuation">;</span>
</code></pre></div><p>//先预估高度posionts 然后滚动的时候更新每行的position位置 -- getBoundingClientRect</p> <p>-- 然后更新最新真实高度 通过二分查找的方式查找当前开始位置</p> <h2 id="webpack优化-2"><a href="#webpack优化-2" class="header-anchor">#</a> webpack优化</h2> <ul><li>代码层面</li></ul> <p>img 如果不需要那么大 可以对图片进行压缩上传</p> <p>数据过多的 考虑到懒加载 和 虚拟滚动去实现</p> <p>数组循环能用some用some 因为可以提前终止掉</p> <p>遍历数组的时候 可以用到广度优先遍历 就是找children id 那个 用栈</p> <p>使用Es6规范导入代码可以实现treeShaking
如果一个函数依赖了另一个函数 可以用高阶函数进行包裹 如果被包裹的函数没有被用到 也会被检测到</p> <p>组件封装 vue是组件级渲染的 每个组件都有一个渲染watcher</p> <ul><li>网络层面
减少HTTP请求数，合并JS、CSS,合理内嵌CSS、JS</li></ul> <p>合理设置服务端缓存，提高服务器处理速度。 (强制缓存、对比缓存)</p> <p>// Expires/Cache-Control   Etag/if-none-match/last-modified/if-modified-since
避免重定向，重定向会降低响应速度 (301,302)</p> <p>使用dns-prefetch,进行DNS预解析</p> <p>采用域名分片技术，将资源放到不同的域名下。接触同一个域名最多处理6个TCP链接问题。</p> <p>采用CDN加速加快访问速度。(指派最近、高度可用)</p> <p>gzip压缩优化 对传输资源进行体积压缩 (html,js,css)</p> <p>// Content-Encoding: gzip
加载数据优先级 : preload（预先请求当前页面需要的资源） prefetch（将来页面中使用的资源） 将数据缓存到HTTP缓存中</p> <p>项目依赖太大 -- 用分析工具分析  ---用DLLPlugin 动态链接库</p> <ul><li><p>http 网络请求这一块</p></li> <li><p>webpack
1.通常来说，我们的代码都可以至少简单区分成业务代码和第三方库。如果不做处理，
每次构建时都需要把所有的代码重新构建一次，耗费大量的时间。
然后大部分情况下，很多第三方库的代码并不会发生变更（除非是版本升级），
这时就可以用到dll：把复用性较高的第三方模块打包到动态链接库中，
在不升级这些库的情况下，动态库不需要重新打包，每次构建只重新打包业务代码。</p></li></ul> <p>2.babel-plugin-import 实现自动按需打包 。实现的就是按需加载</p> <p>import { Button } from 'antd';
这样的引用，会使得最终打包的代码中包含所有 antd 导出来的内容。假设应用中并没有使用 antd 提供的 TimePicker 组件，那么对于打包结果来说，无疑增加了代码体积。在这种情况下，如果组件库提供了 ES Module 版本，
并开启了 Tree Shaking，我们就可以通过“摇树”特性，将不会被使用的代码在构建阶段移除。
Webpack 可以在 package.json 中设置sideEffects: false。
我们在 antd 源码当中可以找到（相关 chore commit）：</p> <p>2.split-chunks-plugin 通过 splitChunk 插件提取公共代码（公共代码分割）。
提供了以下能力
在压缩前体积大于 30KB 的模块；
在按需加载模块时，并行加载的模块不得超过 5 个；
在页面初始化加载时，并行加载的模块不得超过 3 个。</p> <p>3.第三方库Cdn</p> <p>4.css 单独引入 打包成link 利用link的新特性</p> <ol start="5"><li>treeShaking Es6模块 使用不到的代码 可以被抛弃</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/fish-vuePress/webframe/interview/questions.html" class="prev">
        代码题
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/fish-vuePress/assets/js/app.e38c1a38.js" defer></script><script src="/fish-vuePress/assets/js/4.47c64f60.js" defer></script><script src="/fish-vuePress/assets/js/113.ec95cc9c.js" defer></script>
  </body>
</html>
