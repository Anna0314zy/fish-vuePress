<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>源码解读,一文彻底搞懂Events模块 | 小鱼儿的博客</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="专注前端技术栈分享,从前端到Node.js再到数据库">
    
    <link rel="preload" href="/fish-vuePress/assets/css/0.styles.af3f7b63.css" as="style"><link rel="preload" href="/fish-vuePress/assets/js/app.df5f89c4.js" as="script"><link rel="preload" href="/fish-vuePress/assets/js/5.edcfac08.js" as="script"><link rel="preload" href="/fish-vuePress/assets/js/64.6da0341b.js" as="script"><link rel="prefetch" href="/fish-vuePress/assets/js/10.b77df3ea.js"><link rel="prefetch" href="/fish-vuePress/assets/js/100.a0d590cb.js"><link rel="prefetch" href="/fish-vuePress/assets/js/101.0c4817e4.js"><link rel="prefetch" href="/fish-vuePress/assets/js/102.78764042.js"><link rel="prefetch" href="/fish-vuePress/assets/js/103.a96d5da9.js"><link rel="prefetch" href="/fish-vuePress/assets/js/104.a28a3fb7.js"><link rel="prefetch" href="/fish-vuePress/assets/js/105.2cec88b8.js"><link rel="prefetch" href="/fish-vuePress/assets/js/106.e18e3f35.js"><link rel="prefetch" href="/fish-vuePress/assets/js/107.3744efd2.js"><link rel="prefetch" href="/fish-vuePress/assets/js/108.ced67a25.js"><link rel="prefetch" href="/fish-vuePress/assets/js/109.f57e1134.js"><link rel="prefetch" href="/fish-vuePress/assets/js/11.97b74358.js"><link rel="prefetch" href="/fish-vuePress/assets/js/110.7c61f586.js"><link rel="prefetch" href="/fish-vuePress/assets/js/111.8e889bff.js"><link rel="prefetch" href="/fish-vuePress/assets/js/112.39a52113.js"><link rel="prefetch" href="/fish-vuePress/assets/js/113.dae7f961.js"><link rel="prefetch" href="/fish-vuePress/assets/js/114.2d597a8d.js"><link rel="prefetch" href="/fish-vuePress/assets/js/115.9553737f.js"><link rel="prefetch" href="/fish-vuePress/assets/js/116.063d8847.js"><link rel="prefetch" href="/fish-vuePress/assets/js/117.13e26da9.js"><link rel="prefetch" href="/fish-vuePress/assets/js/118.3529b5be.js"><link rel="prefetch" href="/fish-vuePress/assets/js/119.8792b07b.js"><link rel="prefetch" href="/fish-vuePress/assets/js/12.3ecb1de5.js"><link rel="prefetch" href="/fish-vuePress/assets/js/120.ed65532d.js"><link rel="prefetch" href="/fish-vuePress/assets/js/121.8c4731cc.js"><link rel="prefetch" href="/fish-vuePress/assets/js/122.4d92baeb.js"><link rel="prefetch" href="/fish-vuePress/assets/js/123.210e85e7.js"><link rel="prefetch" href="/fish-vuePress/assets/js/124.1e513801.js"><link rel="prefetch" href="/fish-vuePress/assets/js/125.d9e5ebae.js"><link rel="prefetch" href="/fish-vuePress/assets/js/126.107bfe67.js"><link rel="prefetch" href="/fish-vuePress/assets/js/127.14edacab.js"><link rel="prefetch" href="/fish-vuePress/assets/js/128.888bc9d6.js"><link rel="prefetch" href="/fish-vuePress/assets/js/129.92bb5f4a.js"><link rel="prefetch" href="/fish-vuePress/assets/js/13.824408f4.js"><link rel="prefetch" href="/fish-vuePress/assets/js/130.e9dca7f9.js"><link rel="prefetch" href="/fish-vuePress/assets/js/131.6bc5662c.js"><link rel="prefetch" href="/fish-vuePress/assets/js/132.1bfdc2ca.js"><link rel="prefetch" href="/fish-vuePress/assets/js/133.99f9ca2f.js"><link rel="prefetch" href="/fish-vuePress/assets/js/134.69c60897.js"><link rel="prefetch" href="/fish-vuePress/assets/js/135.85a830bc.js"><link rel="prefetch" href="/fish-vuePress/assets/js/136.b5627c7c.js"><link rel="prefetch" href="/fish-vuePress/assets/js/137.bcadb89c.js"><link rel="prefetch" href="/fish-vuePress/assets/js/14.ebcb0a05.js"><link rel="prefetch" href="/fish-vuePress/assets/js/15.d3a0b0df.js"><link rel="prefetch" href="/fish-vuePress/assets/js/16.92300b13.js"><link rel="prefetch" href="/fish-vuePress/assets/js/17.e7cd0ca8.js"><link rel="prefetch" href="/fish-vuePress/assets/js/18.9b1b98e6.js"><link rel="prefetch" href="/fish-vuePress/assets/js/19.a6853cc0.js"><link rel="prefetch" href="/fish-vuePress/assets/js/2.3e0c97ad.js"><link rel="prefetch" href="/fish-vuePress/assets/js/20.eb68a5fa.js"><link rel="prefetch" href="/fish-vuePress/assets/js/21.b3e94a5d.js"><link rel="prefetch" href="/fish-vuePress/assets/js/22.7e6803a4.js"><link rel="prefetch" href="/fish-vuePress/assets/js/23.7a26abb3.js"><link rel="prefetch" href="/fish-vuePress/assets/js/24.3a0e2284.js"><link rel="prefetch" href="/fish-vuePress/assets/js/25.2f09a139.js"><link rel="prefetch" href="/fish-vuePress/assets/js/26.fdd61db3.js"><link rel="prefetch" href="/fish-vuePress/assets/js/27.88ee342e.js"><link rel="prefetch" href="/fish-vuePress/assets/js/28.2dba197d.js"><link rel="prefetch" href="/fish-vuePress/assets/js/29.0b89f09e.js"><link rel="prefetch" href="/fish-vuePress/assets/js/3.961388cf.js"><link rel="prefetch" href="/fish-vuePress/assets/js/30.0b4504ec.js"><link rel="prefetch" href="/fish-vuePress/assets/js/31.35a942d3.js"><link rel="prefetch" href="/fish-vuePress/assets/js/32.f6f62b31.js"><link rel="prefetch" href="/fish-vuePress/assets/js/33.1fce904f.js"><link rel="prefetch" href="/fish-vuePress/assets/js/34.86a7f705.js"><link rel="prefetch" href="/fish-vuePress/assets/js/35.a0d3c71e.js"><link rel="prefetch" href="/fish-vuePress/assets/js/36.d4aa17d5.js"><link rel="prefetch" href="/fish-vuePress/assets/js/37.e84a19da.js"><link rel="prefetch" href="/fish-vuePress/assets/js/38.5a3d6630.js"><link rel="prefetch" href="/fish-vuePress/assets/js/39.72e8a86b.js"><link rel="prefetch" href="/fish-vuePress/assets/js/4.deb713bc.js"><link rel="prefetch" href="/fish-vuePress/assets/js/40.171e086b.js"><link rel="prefetch" href="/fish-vuePress/assets/js/41.3d3d2a08.js"><link rel="prefetch" href="/fish-vuePress/assets/js/42.1b56fbe9.js"><link rel="prefetch" href="/fish-vuePress/assets/js/43.55d66008.js"><link rel="prefetch" href="/fish-vuePress/assets/js/44.1f65c599.js"><link rel="prefetch" href="/fish-vuePress/assets/js/45.bd0206b1.js"><link rel="prefetch" href="/fish-vuePress/assets/js/46.aafec962.js"><link rel="prefetch" href="/fish-vuePress/assets/js/47.ac94a28e.js"><link rel="prefetch" href="/fish-vuePress/assets/js/48.2a025aa5.js"><link rel="prefetch" href="/fish-vuePress/assets/js/49.469aaa8c.js"><link rel="prefetch" href="/fish-vuePress/assets/js/50.08274f17.js"><link rel="prefetch" href="/fish-vuePress/assets/js/51.9b109d30.js"><link rel="prefetch" href="/fish-vuePress/assets/js/52.85094941.js"><link rel="prefetch" href="/fish-vuePress/assets/js/53.610ff2c3.js"><link rel="prefetch" href="/fish-vuePress/assets/js/54.1441c891.js"><link rel="prefetch" href="/fish-vuePress/assets/js/55.b8bbb84d.js"><link rel="prefetch" href="/fish-vuePress/assets/js/56.440ddff2.js"><link rel="prefetch" href="/fish-vuePress/assets/js/57.844af420.js"><link rel="prefetch" href="/fish-vuePress/assets/js/58.3394b61f.js"><link rel="prefetch" href="/fish-vuePress/assets/js/59.5e352a87.js"><link rel="prefetch" href="/fish-vuePress/assets/js/6.81d396d4.js"><link rel="prefetch" href="/fish-vuePress/assets/js/60.5ae989c0.js"><link rel="prefetch" href="/fish-vuePress/assets/js/61.0864cf11.js"><link rel="prefetch" href="/fish-vuePress/assets/js/62.c7442a3b.js"><link rel="prefetch" href="/fish-vuePress/assets/js/63.d893bc29.js"><link rel="prefetch" href="/fish-vuePress/assets/js/65.e2789671.js"><link rel="prefetch" href="/fish-vuePress/assets/js/66.5b4f4293.js"><link rel="prefetch" href="/fish-vuePress/assets/js/67.a0798723.js"><link rel="prefetch" href="/fish-vuePress/assets/js/68.53f11a09.js"><link rel="prefetch" href="/fish-vuePress/assets/js/69.63cb2a8a.js"><link rel="prefetch" href="/fish-vuePress/assets/js/7.6897ca43.js"><link rel="prefetch" href="/fish-vuePress/assets/js/70.804547f9.js"><link rel="prefetch" href="/fish-vuePress/assets/js/71.5787158b.js"><link rel="prefetch" href="/fish-vuePress/assets/js/72.946799be.js"><link rel="prefetch" href="/fish-vuePress/assets/js/73.9d9e52b5.js"><link rel="prefetch" href="/fish-vuePress/assets/js/74.28bafc8a.js"><link rel="prefetch" href="/fish-vuePress/assets/js/75.bd946076.js"><link rel="prefetch" href="/fish-vuePress/assets/js/76.a566a607.js"><link rel="prefetch" href="/fish-vuePress/assets/js/77.3e7bfce0.js"><link rel="prefetch" href="/fish-vuePress/assets/js/78.ec1d52b5.js"><link rel="prefetch" href="/fish-vuePress/assets/js/79.492d0e3b.js"><link rel="prefetch" href="/fish-vuePress/assets/js/8.49a8a0b3.js"><link rel="prefetch" href="/fish-vuePress/assets/js/80.f68ea700.js"><link rel="prefetch" href="/fish-vuePress/assets/js/81.a15fa2be.js"><link rel="prefetch" href="/fish-vuePress/assets/js/82.786ff7c0.js"><link rel="prefetch" href="/fish-vuePress/assets/js/83.6b9d4900.js"><link rel="prefetch" href="/fish-vuePress/assets/js/84.48c296d1.js"><link rel="prefetch" href="/fish-vuePress/assets/js/85.567505d3.js"><link rel="prefetch" href="/fish-vuePress/assets/js/86.1b6fdd4e.js"><link rel="prefetch" href="/fish-vuePress/assets/js/87.90cefee1.js"><link rel="prefetch" href="/fish-vuePress/assets/js/88.f7c32624.js"><link rel="prefetch" href="/fish-vuePress/assets/js/89.0f22b52a.js"><link rel="prefetch" href="/fish-vuePress/assets/js/9.7a3a195f.js"><link rel="prefetch" href="/fish-vuePress/assets/js/90.b23071bb.js"><link rel="prefetch" href="/fish-vuePress/assets/js/91.9b06412d.js"><link rel="prefetch" href="/fish-vuePress/assets/js/92.44c6f292.js"><link rel="prefetch" href="/fish-vuePress/assets/js/93.ced630dd.js"><link rel="prefetch" href="/fish-vuePress/assets/js/94.c5d880af.js"><link rel="prefetch" href="/fish-vuePress/assets/js/95.7ea00f99.js"><link rel="prefetch" href="/fish-vuePress/assets/js/96.08a9387a.js"><link rel="prefetch" href="/fish-vuePress/assets/js/97.7cf3b129.js"><link rel="prefetch" href="/fish-vuePress/assets/js/98.92843a37.js"><link rel="prefetch" href="/fish-vuePress/assets/js/99.3fad2047.js">
    <link rel="stylesheet" href="/fish-vuePress/assets/css/0.styles.af3f7b63.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/fish-vuePress/" class="home-link router-link-active"><!----> <span class="site-name">小鱼儿的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/fish-vuePress/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/fish-vuePress/node-quick/" class="nav-link">
  node
</a></div><div class="nav-item"><a href="/fish-vuePress/webframe/" class="nav-link">
  前端基础
</a></div><div class="nav-item"><a href="/fish-vuePress/vue-quick/" class="nav-link">
  快速掌握vue
</a></div><div class="nav-item"><a href="/fish-vuePress/database/" class="nav-link">
  数据库
</a></div><div class="nav-item"><a href="/fish-vuePress/react/" class="nav-link">
  react
</a></div><div class="nav-item"><a href="/fish-vuePress/webpack/" class="nav-link">
  webpack
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/fish-vuePress/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/fish-vuePress/node-quick/" class="nav-link">
  node
</a></div><div class="nav-item"><a href="/fish-vuePress/webframe/" class="nav-link">
  前端基础
</a></div><div class="nav-item"><a href="/fish-vuePress/vue-quick/" class="nav-link">
  快速掌握vue
</a></div><div class="nav-item"><a href="/fish-vuePress/database/" class="nav-link">
  数据库
</a></div><div class="nav-item"><a href="/fish-vuePress/react/" class="nav-link">
  react
</a></div><div class="nav-item"><a href="/fish-vuePress/webpack/" class="nav-link">
  webpack
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/fish-vuePress/node/" aria-current="page" class="sidebar-link">node目录</a></li><li><a href="/fish-vuePress/node/promise.html" class="sidebar-link">深度了解promise</a></li><li><a href="/fish-vuePress/node/what.html" class="sidebar-link">node.js究竟是什么</a></li><li><a href="/fish-vuePress/node/event_loop.html" class="sidebar-link">node事件循环</a></li><li><a href="/fish-vuePress/node/util.html" class="sidebar-link">node-模块util</a></li><li><a href="/fish-vuePress/node/path.html" class="sidebar-link">node核心模块-path</a></li><li><a href="/fish-vuePress/node/module_fs.html" class="sidebar-link">node核心模块-fs</a></li><li><a href="/fish-vuePress/node/stream.html" class="sidebar-link">node核心模块-stream</a></li><li><a href="/fish-vuePress/node/buffer.html" class="sidebar-link">node核心模块-buffer</a></li><li><a href="/fish-vuePress/node/processAndThread.html" class="sidebar-link">深入理解进程与线程</a></li><li><a href="/fish-vuePress/node/queue.html" class="sidebar-link">Node.js中的消息队列</a></li><li><a href="/fish-vuePress/node/overflow.html" class="sidebar-link">Node.js 内存溢出时如何处理？</a></li><li><a href="/fish-vuePress/node/events.html" aria-current="page" class="active sidebar-link">[源码解读]一文彻底搞懂Events模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fish-vuePress/node/events.html#面试会问" class="sidebar-link">面试会问</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/node/events.html#发布-订阅者模式" class="sidebar-link">发布/订阅者模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fish-vuePress/node/events.html#生活中的发布-订阅者模式" class="sidebar-link">生活中的发布/订阅者模式</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/node/events.html#警察抓小偷" class="sidebar-link" style="padding-left:3rem;">警察抓小偷</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/node/events.html#订阅了某个报社的报纸" class="sidebar-link" style="padding-left:3rem;">订阅了某个报社的报纸</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/node/events.html#你订阅了我的公众号" class="sidebar-link" style="padding-left:3rem;">你订阅了我的公众号</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/node/events.html#实例的代码实现与分析" class="sidebar-link">实例的代码实现与分析</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/node/events.html#发布-订阅者模式的优缺点" class="sidebar-link">发布/订阅者模式的优缺点</a></li></ul></li><li class="sidebar-sub-header"><a href="/fish-vuePress/node/events.html#eventemitter-与-发布-订阅模式的关系" class="sidebar-link">EventEmitter 与 发布/订阅模式的关系</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fish-vuePress/node/events.html#事件的基本组成要素" class="sidebar-link">事件的基本组成要素</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/node/events.html#eventemitter-定义" class="sidebar-link">EventEmitter 定义</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/node/events.html#eventes-的一些常用官方api源码与发布-订阅模式对比学习" class="sidebar-link">EventEs 的一些常用官方API源码与发布/订阅模式对比学习</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/node/events.html#events-模块" class="sidebar-link" style="padding-left:3rem;">Events 模块</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/node/events.html#on-方法" class="sidebar-link" style="padding-left:3rem;">on 方法</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/node/events.html#emit方法" class="sidebar-link" style="padding-left:3rem;">emit方法</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/node/events.html#once方法" class="sidebar-link" style="padding-left:3rem;">once方法</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/node/events.html#off方法" class="sidebar-link" style="padding-left:3rem;">off方法</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/node/events.html#prependlistener方法" class="sidebar-link" style="padding-left:3rem;">prependListener方法</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/node/events.html#其他一些不太常用api" class="sidebar-link" style="padding-left:3rem;">其他一些不太常用api</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/node/events.html#api学习后的小练习" class="sidebar-link" style="padding-left:3rem;">Api学习后的小练习</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/node/events.html#手写代码后的说明" class="sidebar-link" style="padding-left:3rem;">手写代码后的说明</a></li></ul></li><li class="sidebar-sub-header"><a href="/fish-vuePress/node/events.html#阅读源码后一些疑问的解释" class="sidebar-link">阅读源码后一些疑问的解释</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fish-vuePress/node/events.html#监听函数的执行顺序是同步-or-异步" class="sidebar-link">监听函数的执行顺序是同步 or 异步？</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/node/events.html#事件循环中的事件是什么情况下产生的-什么情况下触发的" class="sidebar-link">事件循环中的事件是什么情况下产生的？什么情况下触发的？</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/node/events.html#事件产生" class="sidebar-link" style="padding-left:3rem;">事件产生</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/node/events.html#事件触发" class="sidebar-link" style="padding-left:3rem;">事件触发</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/node/events.html#事件类型为error的问题" class="sidebar-link">事件类型为error的问题</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/node/events.html#如何修改eventemitter的最大监听数量" class="sidebar-link">如何修改EventEmitter的最大监听数量？</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/node/events.html#一个打印warn详细内容的小技巧" class="sidebar-link" style="padding-left:3rem;">一个打印warn详细内容的小技巧</a></li></ul></li><li class="sidebar-sub-header"><a href="/fish-vuePress/node/events.html#eventemitter的应用场景" class="sidebar-link">EventEmitter的应用场景</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/node/events.html#发布-订阅模式与观察者模式的一点说明" class="sidebar-link">发布/订阅模式与观察者模式的一点说明</a></li></ul></li><li><a href="/fish-vuePress/node/errors.html" class="sidebar-link">nodejs十个常见误区</a></li><li><a href="/fish-vuePress/node/AsyncIO.html" class="sidebar-link">Node 与底层之间如何执行异步 I/O 调用</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p><strong>前言</strong></p> <p>为什么写这篇文章？</p> <ul><li>清楚的记得刚找node工作和面试官聊到了事件循环，然后面试官问事件是如何产生的？什么情况下产生事件。。。</li> <li>Events 在哪些场景应用到了？</li> <li>之前封装了一个 RxJava 的开源网络请求框架，也是基于发布-订阅模式，语言都是相通的，挺有趣。表情符号</li> <li>Events 模块是我公众号 Node.js 进阶路线的一部分</li></ul> <p>作者简介：koala，专注完整的 Node.js 技术栈分享，从 JavaScript 到 Node.js,再到后端数据库，祝您成为优秀的高级 Node.js 工程师。【程序员成长指北】作者，Github 博客开源项目 https://github.com/koala-coding/goodBlog</p> <h2 id="面试会问"><a href="#面试会问" class="header-anchor">#</a> 面试会问</h2> <blockquote><ul><li>说一下 Node.js 哪里应用到了发布/订阅模式</li> <li>Events 模块在实际项目开发中有使用过吗？具体应用场景是？</li> <li>Events 监听函数的执行顺序是异步还是同步的？</li> <li>说几个 Events 模块的常用函数吧？</li> <li>模拟实现 Node.js 的核心模块 Events</li></ul></blockquote> <p>文章首发<a href="https://github.com/koala-coding/goodBlog" target="_blank" rel="noopener noreferrer">Github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 博客开源项目 <a href="https://github.com/koala-coding/goodBlog" target="_blank" rel="noopener noreferrer">https://github.com/koala-coding/goodBlog<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="发布-订阅者模式"><a href="#发布-订阅者模式" class="header-anchor">#</a> 发布/订阅者模式</h2> <p><code>发布/订阅者模式</code>应该是我在开发过程中遇到的最多的设计模式。<code>发布/订阅者模式</code>，也可以称之为消息机制，定义了一种依赖关系，这种依赖关系可以理解为 <code>1对N</code> (注意：不一定是1对多，有时候也会1对1哦)，观察者们同时监听某一个对象相应的状态变换，一旦变化则通知到所有观察者，从而触发观察者相应的事件，该设计模式解决了主体对象与观察者之间功能的<code>耦合</code>。</p> <h3 id="生活中的发布-订阅者模式"><a href="#生活中的发布-订阅者模式" class="header-anchor">#</a> 生活中的发布/订阅者模式</h3> <h4 id="警察抓小偷"><a href="#警察抓小偷" class="header-anchor">#</a> 警察抓小偷</h4> <p>在现实生活中，警察抓小偷是一个典型的观察者模式「这以一个惯犯在街道逛街然后被抓为例子」，这里小偷就是被观察者，各个干警就是观察者，干警时时观察着小偷，当小偷正在偷东西「就给干警发送出一条信号，实际上小偷不可能告诉干警我有偷东西」，干警收到信号，出击抓小偷。这就是一个观察者模式</p> <h4 id="订阅了某个报社的报纸"><a href="#订阅了某个报社的报纸" class="header-anchor">#</a> 订阅了某个报社的报纸</h4> <p>生活中就像是去报社订报纸，你喜欢读什么报就去报社去交钱订阅，当发布了新报纸的时候，报社会向所有订阅了报纸的每一个人发送一份，订阅者就可以接收到。</p> <h4 id="你订阅了我的公众号"><a href="#你订阅了我的公众号" class="header-anchor">#</a> 你订阅了我的公众号</h4> <p>我这个微信公号作者是发布者，您这些微信用户是订阅者「我发送一篇文章的时候，关注了【程序员成长指北】的订阅者们都可以收到文章。</p> <h3 id="实例的代码实现与分析"><a href="#实例的代码实现与分析" class="header-anchor">#</a> 实例的代码实现与分析</h3> <p>以大家<code>订阅公众号</code>为例子，看看<code>发布/订阅模式</code>如何实现的。(以订阅报纸作为例子的原因，可以增加一个<code>type</code>参数，用于区分订阅不同类型的公众号，如有的人订阅的是前端公众号，有的人订阅的是 Node.js 公众号，使用此属性来标记。这样和接下来要讲的 EventEmitter 源码更相符，另一个原因是这样你只要打开一个订阅号文章是不是就想到了发布-订阅者模式呢。)</p> <p>代码如下:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> officeAccounts <span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token comment">// 初始化定义一个存储类型对象</span>
    subscribes<span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token string">'any'</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 添加订阅号</span>
    <span class="token function-variable function">subscribe</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'any'</span><span class="token punctuation">,</span>fn<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>subscribes<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>subscribes<span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>subscribes<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//将订阅方法存在数组中</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 退订</span>
    <span class="token function-variable function">unSubscribe</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'any'</span><span class="token punctuation">,</span>fn<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>subscribes<span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">=</span> 
        <span class="token keyword">this</span><span class="token punctuation">.</span>subscribes<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> item<span class="token operator">!=</span>fn<span class="token punctuation">;</span><span class="token comment">// 将退订的方法从数组中移除 </span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 发布订阅</span>
    <span class="token function-variable function">publish</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'any'</span><span class="token punctuation">,</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>subscribes<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">item</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 根据不同的类型调用相应的方法</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre></div><p>以上就是一个最简单的观察者模式的实现，可以看到代码非常的简单，核心原理就是将订阅的方法按分类存在一个数组中，当发布时取出执行即可</p> <p>接下里看小明订阅【程序员成长指北】文章的代码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> xiaoming <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">readArticle</span><span class="token operator">:</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">info</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'小明收到的'</span><span class="token punctuation">,</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> xiaogang <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">readArticle</span><span class="token operator">:</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">info</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'小刚收到的'</span><span class="token punctuation">,</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

officeAccounts<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'程序员成长指北'</span><span class="token punctuation">,</span>xiaoming<span class="token punctuation">.</span>readArticle<span class="token punctuation">)</span><span class="token punctuation">;</span>
officeAccounts<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'程序员成长指北'</span><span class="token punctuation">,</span>xiaogang<span class="token punctuation">.</span>readArticle<span class="token punctuation">)</span><span class="token punctuation">;</span>
officeAccounts<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'某公众号'</span><span class="token punctuation">,</span>xiaoming<span class="token punctuation">.</span>readArticle<span class="token punctuation">)</span><span class="token punctuation">;</span>

officeAccounts<span class="token punctuation">.</span><span class="token function">unSubscribe</span><span class="token punctuation">(</span><span class="token string">'某公众号'</span><span class="token punctuation">,</span>xiaoming<span class="token punctuation">.</span>readArticle<span class="token punctuation">)</span><span class="token punctuation">;</span>

officeAccounts<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">'程序员成长指北'</span><span class="token punctuation">,</span><span class="token string">'程序员成长指北的Node文章'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
officeAccounts<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">'某公众号'</span><span class="token punctuation">,</span><span class="token string">'某公众号的文章'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>运行结果:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>小明收到的 程序员成长指北的Node文章
小刚收到的 程序员成长指北的Node文章
</code></pre></div><ul><li>结论</li></ul> <p>通过观察现实生活中的三个例子以及代码实例发现发布/订阅模式的确是1对N的关系。当发布者的状态发生改变时，所有订阅者都会得到通知。</p> <p><img src="http://img.xiaogangzai.cn/node_events_01.jpg" alt=""></p> <ul><li>发布/订阅模式的特点和结构
三要素：</li></ul> <ol><li>发布者</li> <li>订阅者</li> <li>事件(订阅)</li></ol> <h3 id="发布-订阅者模式的优缺点"><a href="#发布-订阅者模式的优缺点" class="header-anchor">#</a> 发布/订阅者模式的优缺点</h3> <ul><li>优点</li></ul> <p>主体和观察者之间完全透明，所有的消息传递过程都通过消息调度中心完成，也就是说具体的业务逻辑代码将会是在消息调度中心内，而主体和观察者之间实现了完全的<strong>松耦合</strong>。对象直接的解耦，异步编程中，可以更松耦合的代码编写。</p> <ul><li>缺点</li></ul> <p>程序易读性显著降低；多个发布者和订阅者嵌套在一起的时候，程序难以跟踪，其实还是代码不易读，嘿嘿。</p> <h2 id="eventemitter-与-发布-订阅模式的关系"><a href="#eventemitter-与-发布-订阅模式的关系" class="header-anchor">#</a> EventEmitter 与 发布/订阅模式的关系</h2> <p>Node.js 中的 EventEmitter
模块就是用了发布/订阅这种设计模式，发布/订阅 模式在主体与观察者之间引入消息调度中心，主体和观察者之间完全透明，所  有的消息传递过程都通过消息调度中心完成，也就是说具体的业务逻辑代码将会是在消息调度中心内完成。</p> <h3 id="事件的基本组成要素"><a href="#事件的基本组成要素" class="header-anchor">#</a> 事件的基本组成要素</h3> <p><img src="http://img.xiaogangzai.cn/node_events_02.jpg" alt=""></p> <p>通过Api的对比，来看看Events模块</p> <h3 id="eventemitter-定义"><a href="#eventemitter-定义" class="header-anchor">#</a> EventEmitter 定义</h3> <p>Events是 Node.js 中一个使用率很高的模块，其它原生node.js模块都是基于它来完成的，比如流、HTTP等。它的核心思想就是 Events 模块的功能就是一个<code>事件绑定与触发</code>，所有继承自它的实例都具备事件处理的能力。</p> <h3 id="eventes-的一些常用官方api源码与发布-订阅模式对比学习"><a href="#eventes-的一些常用官方api源码与发布-订阅模式对比学习" class="header-anchor">#</a> EventEs 的一些常用官方API源码与发布/订阅模式对比学习</h3> <p>本模块的官方 Api 讲解不是直接带大家学习文档，而是
通过<code>对比</code>发布/订阅设计模式自己手写一个版本 Events 的核心代码来学习并记住Api</p> <h4 id="events-模块"><a href="#events-模块" class="header-anchor">#</a> Events 模块</h4> <p>Events 模块只有一个 EventEmitter 类，首先定义类的基本结构</p> <div class="language- extra-class"><pre class="language-text"><code>function EventEmitter() {
    //私有属性，保存订阅方法
    this._events = {};
}

//默认设置最大监听数
EventEmitter.defaultMaxListeners = 10;

module.exports = EventEmitter;
</code></pre></div><h4 id="on-方法"><a href="#on-方法" class="header-anchor">#</a> on 方法</h4> <p>on 方法，该方法用于订阅事件(这里 on 和 addListener 说明下)，Node.js 源码中这样把它们俩赋值了下，我也不太懂为什么？知道的小伙伴可以告诉我为什么要这样做哦。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token class-name">EventEmitter</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">addListener</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">addListener</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> listener</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">_addListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> type<span class="token punctuation">,</span> listener<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name">EventEmitter</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>on <span class="token operator">=</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>addListener<span class="token punctuation">;</span>
</code></pre></div><p>接下来是我们对on方法的具体实践：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token class-name">EventEmitter</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>on <span class="token operator">=</span>
    <span class="token class-name">EventEmitter</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">addListener</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> listener<span class="token punctuation">,</span> flag</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">//保证存在实例属性</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_events <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//从头部插入</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>listener<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
		<span class="token comment">//绑定事件，触发newListener</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">!==</span> <span class="token string">'newListener'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'newListener'</span><span class="token punctuation">,</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>因为有其它子类需要继承自EventEmitter，因此要判断子类是否存在_event属性，这样做是为了保证子类必须存在此实例属性。而flag标记是一个订阅方法的插入标识，如果为'true'就视为插入在数组的头部。可以看到，这就是观察者模式的订阅方法实现。</p> <h4 id="emit方法"><a href="#emit方法" class="header-anchor">#</a> emit方法</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token class-name">EventEmitter</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">emit</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fn</span> <span class="token operator">=&gt;</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>emit方法就是将订阅方法取出执行，使用call方法来修正this的指向，使其指向子类的实例。</p> <h4 id="once方法"><a href="#once方法" class="header-anchor">#</a> once方法</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token class-name">EventEmitter</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">once</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> listener</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

    <span class="token comment">//中间函数，在调用完之后立即删除订阅</span>
    <span class="token keyword">function</span> <span class="token function">only</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        _this<span class="token punctuation">.</span><span class="token function">removeListener</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> only<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//origin保存原回调的引用，用于remove时的判断</span>
    only<span class="token punctuation">.</span>origin <span class="token operator">=</span> listener<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> only<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>once方法非常有趣，它的功能是将事件订阅“一次”，当这个事件触发过就不会再次触发了。其原理是将订阅的方法再包裹一层函数，在执行后将此函数移除即可。</p> <h4 id="off方法"><a href="#off方法" class="header-anchor">#</a> off方法</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token class-name">EventEmitter</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>off <span class="token operator">=</span>
    <span class="token class-name">EventEmitter</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">removeListener</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> listener</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//过滤掉退订的方法，从数组中移除</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">=</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">fn</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> fn <span class="token operator">!==</span> listener <span class="token operator">&amp;&amp;</span> fn<span class="token punctuation">.</span>origin <span class="token operator">!==</span> listener
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>off方法即为退订，原理同观察者模式一样，将订阅方法从数组中移除即可。</p> <h4 id="prependlistener方法"><a href="#prependlistener方法" class="header-anchor">#</a> prependListener方法</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token class-name">EventEmitter</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">prependListener</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> listener</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> listener<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>码此方法不必多说了，调用on方法将标记传为true（插入订阅方法在头部）即可。
以上，就将EventEmitter类的核心方法实现了。</p> <h4 id="其他一些不太常用api"><a href="#其他一些不太常用api" class="header-anchor">#</a> 其他一些不太常用api</h4> <ul><li><code>emitter.listenerCount(eventName)</code>可以获取事件注册的<code>listener</code>个数</li> <li><code>emitter.listeners(eventName)</code>可以获取事件注册的<code>listener</code>数组副本。</li></ul> <h4 id="api学习后的小练习"><a href="#api学习后的小练习" class="header-anchor">#</a> Api学习后的小练习</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//event.js 文件</span>
<span class="token keyword">var</span> events <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'events'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">var</span> emitter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">events<span class="token punctuation">.</span>EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
emitter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'someEvent'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">arg1<span class="token punctuation">,</span> arg2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'listener1'</span><span class="token punctuation">,</span> arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
emitter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'someEvent'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">arg1<span class="token punctuation">,</span> arg2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'listener2'</span><span class="token punctuation">,</span> arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
emitter<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'someEvent'</span><span class="token punctuation">,</span> <span class="token string">'arg1 参数'</span><span class="token punctuation">,</span> <span class="token string">'arg2 参数'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><p>执行以上代码，运行的结果如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>$ node event<span class="token punctuation">.</span>js 
listener1 arg1 参数 arg2 参数
listener2 arg1 参数 arg2 参数
</code></pre></div><h4 id="手写代码后的说明"><a href="#手写代码后的说明" class="header-anchor">#</a> 手写代码后的说明</h4> <p>手写Events模块代码的时候注意以下几点：</p> <ul><li>使用订阅/发布模式</li> <li>事件的核心组成有哪些</li> <li>写源码时候考虑一些范围和极限判断</li></ul> <p>注意:我上面的手写代码并不是性能最好和最完善的，目的只是带大家先弄懂记住他。举个例子：
最初的定义EventEmitter类，源码中并不是直接定义 <code>this._events = {}</code>，请看：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token keyword">function</span> <span class="token function">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  EventEmitter<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

EventEmitter<span class="token punctuation">.</span><span class="token function-variable function">init</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_events <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">||</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_events <span class="token operator">===</span> Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span>_events<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_events <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_eventsCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>_maxListeners <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_maxListeners <span class="token operator">||</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>同样是实现一个类，但是源码中更注意性能，我们可能认为简单的一个 <code>this._events = {}</code>;就可以了，但是通过<code>jsperf</code>(一个小彩蛋，有需要的搜以下，查看性能工具) 比较两者的性能，源码中高了很多，我就不具体一一讲解了，附上源码地址，有兴趣的可以去学习</p> <blockquote><p>lib/events源码地址  https://github.com/nodejs/node/blob/master/lib/events.js</p></blockquote> <p>源码篇幅过长，给了地址可以对比继续研究，毕竟是公众号文章，不想被说。但是一些疑问还是要讲的，嘿嘿。</p> <p><img src="http://img.xiaogangzai.cn/node_events_03.jpg" alt=""></p> <h2 id="阅读源码后一些疑问的解释"><a href="#阅读源码后一些疑问的解释" class="header-anchor">#</a> 阅读源码后一些疑问的解释</h2> <h3 id="监听函数的执行顺序是同步-or-异步"><a href="#监听函数的执行顺序是同步-or-异步" class="header-anchor">#</a> 监听函数的执行顺序是同步 or 异步？</h3> <p>看一段代码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> EventEmitter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'events'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">MyEmitter</span> <span class="token keyword">extends</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> myEmitter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myEmitter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'event'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'listener1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myEmitter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'event'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'listener2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'我是异步中的输出'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myEmitter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'event'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'listener3'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myEmitter<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'event'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>输出结果如下:</p> <div class="language- extra-class"><pre class="language-text"><code>// 输出结果
listener1
listener2
listener3
end
我是异步中的输出
</code></pre></div><p>EventEmitter触发事件的时候，各<code>监听函数的调用</code>是同步的（注意：监听函数的调用是同步的，'end'的输出在最后），但是并不是说监听函数里不能包含异步的代码，代码中listener2那个事件就加了一个异步的函数，它是最后输出的。</p> <h3 id="事件循环中的事件是什么情况下产生的-什么情况下触发的"><a href="#事件循环中的事件是什么情况下产生的-什么情况下触发的" class="header-anchor">#</a> 事件循环中的事件是什么情况下产生的？什么情况下触发的？</h3> <p>我为什么要把这个单独写成一个小标题来讲，因为发现网上好多文章都是错的，或者不明确，给大家造成了误导。</p> <p>看这里，某API网站的一段话，具体网站名称在这里就不说了，不想招黑，这段内容没问题，但是对于刚接触事件机制的小伙伴容易混淆</p> <p><img src="http://img.xiaogangzai.cn/node_events_04.jpg" alt="">
以<code>fs.open</code>为例子，看一下到底什么时候产生了事件，什么时候触发，和EventEmitter有什么关系呢？</p> <p><img src="http://img.xiaogangzai.cn/node_events_05.jpg" alt=""></p> <p>流程的一个说明：本图中详细绘制了从 异步调用开始---&gt;异步调用请求封装---&gt;请求对象传入I/O线程池完成I/O操作---&gt;将完成的I/O结果交给I/O观察者---&gt;从I/O观察者中取出回调函数和结果调用执行。</p> <h4 id="事件产生"><a href="#事件产生" class="header-anchor">#</a> 事件产生</h4> <p>关于事件你看图中第三部分，事件循环那里。Node.js 所有的异步 I/O 操作(net.Server， fs.readStream 等)在<code>完成后</code>都会添加一个事件到事件循环的事件队列中。</p> <h4 id="事件触发"><a href="#事件触发" class="header-anchor">#</a> 事件触发</h4> <p>事件的触发，我们只需要关注图中第三部分，事件循环会在事件队列中取出事件处理。<code>fs.open</code>产生事件的对象都是 events.EventEmitter 的实例，继承了EventEmitter，从事件循环取出事件的时候，触发这个事件和回调函数。</p> <p>越写越多，越写越想，总是这样，需要控制一下。</p> <p><img src="http://img.xiaogangzai.cn/node_events_06.jpg" alt=""></p> <h3 id="事件类型为error的问题"><a href="#事件类型为error的问题" class="header-anchor">#</a> 事件类型为error的问题</h3> <p>当我们直接为EventEmitter定义一个error事件，它包含了错误的语义，我们在遇到 异常的时候通常会触发 error 事件。</p> <p>当 error 被触发时，EventEmitter 规定如果没有响 应的监听器，Node.js 会把它当作异常，退出程序并输出错误信息。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> events <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'events'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">var</span> emitter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">events<span class="token punctuation">.</span>EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
emitter<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><p>运行时会报错</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>node<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">201</span> 
<span class="token keyword">throw</span> e<span class="token punctuation">;</span> <span class="token comment">// process.nextTick error, or 'error' event on first tick </span>
<span class="token operator">^</span> 
Error<span class="token operator">:</span> Uncaught<span class="token punctuation">,</span> unspecified <span class="token string">'error'</span> event<span class="token punctuation">.</span> 
at EventEmitter<span class="token punctuation">.</span><span class="token function">emit</span> <span class="token punctuation">(</span>events<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">50</span><span class="token operator">:</span><span class="token number">15</span><span class="token punctuation">)</span> 
at Object<span class="token punctuation">.</span><span class="token operator">&lt;</span>anonymous<span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token operator">/</span>home<span class="token operator">/</span>byvoid<span class="token operator">/</span>error<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">5</span><span class="token operator">:</span><span class="token number">9</span><span class="token punctuation">)</span> 
at Module<span class="token punctuation">.</span><span class="token function">_compile</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">441</span><span class="token operator">:</span><span class="token number">26</span><span class="token punctuation">)</span> 
at Object<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">js</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">459</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">)</span> 
at Module<span class="token punctuation">.</span><span class="token function">load</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">348</span><span class="token operator">:</span><span class="token number">31</span><span class="token punctuation">)</span> 
at Function<span class="token punctuation">.</span><span class="token function">_load</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">308</span><span class="token operator">:</span><span class="token number">12</span><span class="token punctuation">)</span> 
at Array<span class="token punctuation">.</span><span class="token number">0</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">479</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">)</span> 
at EventEmitter<span class="token punctuation">.</span><span class="token function">_tickCallback</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">192</span><span class="token operator">:</span><span class="token number">40</span><span class="token punctuation">)</span> 
</code></pre></div><p>我们一般要为会触发 error 事件的对象设置监听器，避免遇到错误后整个程序崩溃。</p> <h3 id="如何修改eventemitter的最大监听数量"><a href="#如何修改eventemitter的最大监听数量" class="header-anchor">#</a> 如何修改EventEmitter的最大监听数量？</h3> <p>默认情况下针对单一事件的最大listener数量是10，如果超过10个的话listener还是会执行，只是控制台会有警告信息，告警信息里面已经提示了操作建议，可以通过调用emitter.setMaxListeners()来调整最大listener的限制</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">(</span>node<span class="token operator">:</span><span class="token number">9379</span><span class="token punctuation">)</span> MaxListenersExceededWarning<span class="token operator">:</span> Possible EventEmitter memory leak detected<span class="token punctuation">.</span> <span class="token number">11</span> event listeners added<span class="token punctuation">.</span> Use emitter<span class="token punctuation">.</span><span class="token function">setMaxListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span> to increase limit

</code></pre></div><h4 id="一个打印warn详细内容的小技巧"><a href="#一个打印warn详细内容的小技巧" class="header-anchor">#</a> 一个打印warn详细内容的小技巧</h4> <p>上面的警告信息的粒度不够，并不能告诉我们是哪里的代码出了问题，可以通过process.on('warning')来获得更具体的信息（emitter、event、eventCount）</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'warning'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token punctuation">{</span> MaxListenersExceededWarning<span class="token operator">:</span> Possible EventEmitter memory leak detected<span class="token punctuation">.</span> <span class="token number">11</span> event listeners added<span class="token punctuation">.</span> Use emitter<span class="token punctuation">.</span><span class="token function">setMaxListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span> to increase limit
    at <span class="token function">_addListener</span> <span class="token punctuation">(</span>events<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">289</span><span class="token operator">:</span><span class="token number">19</span><span class="token punctuation">)</span>
    at MyEmitter<span class="token punctuation">.</span><span class="token function">prependListener</span> <span class="token punctuation">(</span>events<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">313</span><span class="token operator">:</span><span class="token number">14</span><span class="token punctuation">)</span>
    at Object<span class="token punctuation">.</span><span class="token operator">&lt;</span>anonymous<span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token operator">/</span>Users<span class="token operator">/</span>xiji<span class="token operator">/</span>workspace<span class="token operator">/</span>learn<span class="token operator">/</span>event<span class="token operator">-</span>emitter<span class="token operator">/</span>b<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">34</span><span class="token operator">:</span><span class="token number">11</span><span class="token punctuation">)</span>
    at Module<span class="token punctuation">.</span><span class="token function">_compile</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">641</span><span class="token operator">:</span><span class="token number">30</span><span class="token punctuation">)</span>
    at Object<span class="token punctuation">.</span>Module<span class="token punctuation">.</span>_extensions<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">js</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">652</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">)</span>
    at Module<span class="token punctuation">.</span><span class="token function">load</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">560</span><span class="token operator">:</span><span class="token number">32</span><span class="token punctuation">)</span>
    at <span class="token function">tryModuleLoad</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">503</span><span class="token operator">:</span><span class="token number">12</span><span class="token punctuation">)</span>
    at Function<span class="token punctuation">.</span>Module<span class="token punctuation">.</span><span class="token function">_load</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">495</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>
    at Function<span class="token punctuation">.</span>Module<span class="token punctuation">.</span><span class="token function">runMain</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">682</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">)</span>
    at <span class="token function">startup</span> <span class="token punctuation">(</span>bootstrap_node<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">191</span><span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">)</span>
  name<span class="token operator">:</span> <span class="token string">'MaxListenersExceededWarning'</span><span class="token punctuation">,</span>
  emitter<span class="token operator">:</span>
   MyEmitter <span class="token punctuation">{</span>
     domain<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
     _events<span class="token operator">:</span> <span class="token punctuation">{</span> event<span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
     _eventsCount<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
     _maxListeners<span class="token operator">:</span> <span class="token keyword">undefined</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  type<span class="token operator">:</span> <span class="token string">'event'</span><span class="token punctuation">,</span>
  count<span class="token operator">:</span> <span class="token number">11</span> <span class="token punctuation">}</span>

</code></pre></div><h2 id="eventemitter的应用场景"><a href="#eventemitter的应用场景" class="header-anchor">#</a> EventEmitter的应用场景</h2> <ul><li>不能try/catch的错误异常抛出可以使用它</li> <li>好多常用模块继承自EventEmitter
比如<code>fs</code>模块 <code>net</code>模块</li> <li>面试题会考</li> <li>前端开发中也经常用到发布/订阅模式(思想与Events模块相同)</li></ul> <h2 id="发布-订阅模式与观察者模式的一点说明"><a href="#发布-订阅模式与观察者模式的一点说明" class="header-anchor">#</a> 发布/订阅模式与观察者模式的一点说明</h2> <p>观察者模式与发布-订阅者模式，在平时你可以认为他们是一个东西，但是在某些场合(比如面试)可能需要稍加注意，看一下二者的区别对比</p> <p>借用网上的一张图</p> <p><img src="http://img.xiaogangzai.cn/node_events_07.jpg" alt="">
从图中可以看出，发布-订阅模式中间包含一个Event Channel</p> <ol><li>观察者模式 中的观察者和被观察者之间还是存在耦合的，两者必须确切的知道对方的存在才能进行消息的传递。</li> <li>发布-订阅模式 中的发布者和订阅者不需要知道对方的存在，他们通过消息代理来进行通信，解耦更加彻底。</li></ol> <p>参考文章:</p> <ol><li>Node.js 官网</li> <li>朴灵老师的Node.js深入浅出</li> <li>events在github中的源码地址 https://github.com/nodejs/node/blob/master/lib/events.js</li> <li>JavaScript设计模式精讲-SHERlocked93</li></ol> <p>加入我们一起学习吧！</p> <p><img src="http://img.xiaogangzai.cn/leading.png" alt=""></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/fish-vuePress/node/overflow.html" class="prev">
        Node.js 内存溢出时如何处理？
      </a></span> <span class="next"><a href="/fish-vuePress/node/errors.html">
        nodejs十个常见误区
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/fish-vuePress/assets/js/app.df5f89c4.js" defer></script><script src="/fish-vuePress/assets/js/5.edcfac08.js" defer></script><script src="/fish-vuePress/assets/js/64.6da0341b.js" defer></script>
  </body>
</html>
