<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>javascript中的闭包 | 小鱼儿的博客</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="专注 Node.js 技术栈分享，从前端到Node.js再到数据库">
    
    <link rel="preload" href="/fish-vuePress/assets/css/0.styles.0de575c4.css" as="style"><link rel="preload" href="/fish-vuePress/assets/js/app.e38c1a38.js" as="script"><link rel="preload" href="/fish-vuePress/assets/js/4.47c64f60.js" as="script"><link rel="preload" href="/fish-vuePress/assets/js/123.b45ae2a4.js" as="script"><link rel="prefetch" href="/fish-vuePress/assets/js/10.c86ad536.js"><link rel="prefetch" href="/fish-vuePress/assets/js/100.759ca827.js"><link rel="prefetch" href="/fish-vuePress/assets/js/101.4bded0a8.js"><link rel="prefetch" href="/fish-vuePress/assets/js/102.d65e75b9.js"><link rel="prefetch" href="/fish-vuePress/assets/js/103.d88365ec.js"><link rel="prefetch" href="/fish-vuePress/assets/js/104.69a8c662.js"><link rel="prefetch" href="/fish-vuePress/assets/js/105.59e6d7e0.js"><link rel="prefetch" href="/fish-vuePress/assets/js/106.14dbbcea.js"><link rel="prefetch" href="/fish-vuePress/assets/js/107.d38478ec.js"><link rel="prefetch" href="/fish-vuePress/assets/js/108.db8ad882.js"><link rel="prefetch" href="/fish-vuePress/assets/js/109.8f587cf1.js"><link rel="prefetch" href="/fish-vuePress/assets/js/11.754b29d5.js"><link rel="prefetch" href="/fish-vuePress/assets/js/110.c5e894a3.js"><link rel="prefetch" href="/fish-vuePress/assets/js/111.2df69db0.js"><link rel="prefetch" href="/fish-vuePress/assets/js/112.728cf1ce.js"><link rel="prefetch" href="/fish-vuePress/assets/js/113.ec95cc9c.js"><link rel="prefetch" href="/fish-vuePress/assets/js/114.7431d85e.js"><link rel="prefetch" href="/fish-vuePress/assets/js/115.0b11823c.js"><link rel="prefetch" href="/fish-vuePress/assets/js/116.de262d5e.js"><link rel="prefetch" href="/fish-vuePress/assets/js/117.b4ff302e.js"><link rel="prefetch" href="/fish-vuePress/assets/js/118.fb6742d2.js"><link rel="prefetch" href="/fish-vuePress/assets/js/119.28604668.js"><link rel="prefetch" href="/fish-vuePress/assets/js/12.f04e1f1f.js"><link rel="prefetch" href="/fish-vuePress/assets/js/120.d703c437.js"><link rel="prefetch" href="/fish-vuePress/assets/js/121.ff692d5f.js"><link rel="prefetch" href="/fish-vuePress/assets/js/122.5207210d.js"><link rel="prefetch" href="/fish-vuePress/assets/js/124.e3ba7b0d.js"><link rel="prefetch" href="/fish-vuePress/assets/js/125.a90be7d2.js"><link rel="prefetch" href="/fish-vuePress/assets/js/126.e14a08e2.js"><link rel="prefetch" href="/fish-vuePress/assets/js/127.08c070b6.js"><link rel="prefetch" href="/fish-vuePress/assets/js/128.31684ed5.js"><link rel="prefetch" href="/fish-vuePress/assets/js/129.4c4c425a.js"><link rel="prefetch" href="/fish-vuePress/assets/js/13.9f4bb48a.js"><link rel="prefetch" href="/fish-vuePress/assets/js/130.c887a352.js"><link rel="prefetch" href="/fish-vuePress/assets/js/131.f00cc32c.js"><link rel="prefetch" href="/fish-vuePress/assets/js/132.46a6efdd.js"><link rel="prefetch" href="/fish-vuePress/assets/js/133.6e8821b8.js"><link rel="prefetch" href="/fish-vuePress/assets/js/134.c0016c2e.js"><link rel="prefetch" href="/fish-vuePress/assets/js/135.5906d1ca.js"><link rel="prefetch" href="/fish-vuePress/assets/js/136.a250c35a.js"><link rel="prefetch" href="/fish-vuePress/assets/js/137.838c25a1.js"><link rel="prefetch" href="/fish-vuePress/assets/js/138.04d6feca.js"><link rel="prefetch" href="/fish-vuePress/assets/js/139.99fc80a8.js"><link rel="prefetch" href="/fish-vuePress/assets/js/14.05d29434.js"><link rel="prefetch" href="/fish-vuePress/assets/js/140.5a894eb5.js"><link rel="prefetch" href="/fish-vuePress/assets/js/141.0da10d3c.js"><link rel="prefetch" href="/fish-vuePress/assets/js/142.fdc49fcd.js"><link rel="prefetch" href="/fish-vuePress/assets/js/143.c5ecdffa.js"><link rel="prefetch" href="/fish-vuePress/assets/js/144.127e53eb.js"><link rel="prefetch" href="/fish-vuePress/assets/js/145.6339ec5a.js"><link rel="prefetch" href="/fish-vuePress/assets/js/146.b72ef101.js"><link rel="prefetch" href="/fish-vuePress/assets/js/147.a3fdaba8.js"><link rel="prefetch" href="/fish-vuePress/assets/js/148.60641d79.js"><link rel="prefetch" href="/fish-vuePress/assets/js/15.dcbeae73.js"><link rel="prefetch" href="/fish-vuePress/assets/js/16.7c89b3f8.js"><link rel="prefetch" href="/fish-vuePress/assets/js/17.527e7d63.js"><link rel="prefetch" href="/fish-vuePress/assets/js/18.7377f0d6.js"><link rel="prefetch" href="/fish-vuePress/assets/js/19.f5ba7f79.js"><link rel="prefetch" href="/fish-vuePress/assets/js/2.4bfdb790.js"><link rel="prefetch" href="/fish-vuePress/assets/js/20.b2243522.js"><link rel="prefetch" href="/fish-vuePress/assets/js/21.242b4d91.js"><link rel="prefetch" href="/fish-vuePress/assets/js/22.edb03dd2.js"><link rel="prefetch" href="/fish-vuePress/assets/js/23.09942154.js"><link rel="prefetch" href="/fish-vuePress/assets/js/24.6b33d47e.js"><link rel="prefetch" href="/fish-vuePress/assets/js/25.e51c2d41.js"><link rel="prefetch" href="/fish-vuePress/assets/js/26.577501f9.js"><link rel="prefetch" href="/fish-vuePress/assets/js/27.ec96f26b.js"><link rel="prefetch" href="/fish-vuePress/assets/js/28.20187a02.js"><link rel="prefetch" href="/fish-vuePress/assets/js/29.666c814c.js"><link rel="prefetch" href="/fish-vuePress/assets/js/3.9d9f38a6.js"><link rel="prefetch" href="/fish-vuePress/assets/js/30.bc05f7f4.js"><link rel="prefetch" href="/fish-vuePress/assets/js/31.3d280341.js"><link rel="prefetch" href="/fish-vuePress/assets/js/32.fdeaae53.js"><link rel="prefetch" href="/fish-vuePress/assets/js/33.9389c9ae.js"><link rel="prefetch" href="/fish-vuePress/assets/js/34.729b9efa.js"><link rel="prefetch" href="/fish-vuePress/assets/js/35.85bc9fac.js"><link rel="prefetch" href="/fish-vuePress/assets/js/36.464db47b.js"><link rel="prefetch" href="/fish-vuePress/assets/js/37.304de13a.js"><link rel="prefetch" href="/fish-vuePress/assets/js/38.a6f8671e.js"><link rel="prefetch" href="/fish-vuePress/assets/js/39.c7e19da5.js"><link rel="prefetch" href="/fish-vuePress/assets/js/40.fcb99a2f.js"><link rel="prefetch" href="/fish-vuePress/assets/js/41.6ca6eb36.js"><link rel="prefetch" href="/fish-vuePress/assets/js/42.f5056026.js"><link rel="prefetch" href="/fish-vuePress/assets/js/43.96291ec5.js"><link rel="prefetch" href="/fish-vuePress/assets/js/44.8436df96.js"><link rel="prefetch" href="/fish-vuePress/assets/js/45.39dc596b.js"><link rel="prefetch" href="/fish-vuePress/assets/js/46.0e73ce90.js"><link rel="prefetch" href="/fish-vuePress/assets/js/47.518dd04b.js"><link rel="prefetch" href="/fish-vuePress/assets/js/48.f36a449a.js"><link rel="prefetch" href="/fish-vuePress/assets/js/49.39d6e895.js"><link rel="prefetch" href="/fish-vuePress/assets/js/5.92e70f46.js"><link rel="prefetch" href="/fish-vuePress/assets/js/50.70b27645.js"><link rel="prefetch" href="/fish-vuePress/assets/js/51.e03f1f19.js"><link rel="prefetch" href="/fish-vuePress/assets/js/52.b6e55d8a.js"><link rel="prefetch" href="/fish-vuePress/assets/js/53.3730ee57.js"><link rel="prefetch" href="/fish-vuePress/assets/js/54.f2f22eee.js"><link rel="prefetch" href="/fish-vuePress/assets/js/55.b6c04cef.js"><link rel="prefetch" href="/fish-vuePress/assets/js/56.dd65b0d6.js"><link rel="prefetch" href="/fish-vuePress/assets/js/57.71e5285b.js"><link rel="prefetch" href="/fish-vuePress/assets/js/58.00297228.js"><link rel="prefetch" href="/fish-vuePress/assets/js/59.8d3ec4fa.js"><link rel="prefetch" href="/fish-vuePress/assets/js/6.7f1d02bc.js"><link rel="prefetch" href="/fish-vuePress/assets/js/60.dc481572.js"><link rel="prefetch" href="/fish-vuePress/assets/js/61.2b7311e6.js"><link rel="prefetch" href="/fish-vuePress/assets/js/62.54467563.js"><link rel="prefetch" href="/fish-vuePress/assets/js/63.f7739a24.js"><link rel="prefetch" href="/fish-vuePress/assets/js/64.ea92fd67.js"><link rel="prefetch" href="/fish-vuePress/assets/js/65.64813ff6.js"><link rel="prefetch" href="/fish-vuePress/assets/js/66.2c6c49f1.js"><link rel="prefetch" href="/fish-vuePress/assets/js/67.ed60e5c9.js"><link rel="prefetch" href="/fish-vuePress/assets/js/68.87948def.js"><link rel="prefetch" href="/fish-vuePress/assets/js/69.51414141.js"><link rel="prefetch" href="/fish-vuePress/assets/js/7.5066cb77.js"><link rel="prefetch" href="/fish-vuePress/assets/js/70.933862e1.js"><link rel="prefetch" href="/fish-vuePress/assets/js/71.394703c7.js"><link rel="prefetch" href="/fish-vuePress/assets/js/72.7b500072.js"><link rel="prefetch" href="/fish-vuePress/assets/js/73.52593ae5.js"><link rel="prefetch" href="/fish-vuePress/assets/js/74.6f25fbb4.js"><link rel="prefetch" href="/fish-vuePress/assets/js/75.9f29b3cc.js"><link rel="prefetch" href="/fish-vuePress/assets/js/76.690b7ad7.js"><link rel="prefetch" href="/fish-vuePress/assets/js/77.0c6ea2b4.js"><link rel="prefetch" href="/fish-vuePress/assets/js/78.319bd089.js"><link rel="prefetch" href="/fish-vuePress/assets/js/79.df0dfc28.js"><link rel="prefetch" href="/fish-vuePress/assets/js/8.f9028607.js"><link rel="prefetch" href="/fish-vuePress/assets/js/80.d1f63bac.js"><link rel="prefetch" href="/fish-vuePress/assets/js/81.e1cf6dc5.js"><link rel="prefetch" href="/fish-vuePress/assets/js/82.fafff4c2.js"><link rel="prefetch" href="/fish-vuePress/assets/js/83.f33da300.js"><link rel="prefetch" href="/fish-vuePress/assets/js/84.9348707d.js"><link rel="prefetch" href="/fish-vuePress/assets/js/85.7ace8919.js"><link rel="prefetch" href="/fish-vuePress/assets/js/86.0d8934a6.js"><link rel="prefetch" href="/fish-vuePress/assets/js/87.78b06dda.js"><link rel="prefetch" href="/fish-vuePress/assets/js/88.4da01134.js"><link rel="prefetch" href="/fish-vuePress/assets/js/89.9fc01a7f.js"><link rel="prefetch" href="/fish-vuePress/assets/js/9.27f97ad6.js"><link rel="prefetch" href="/fish-vuePress/assets/js/90.8684053a.js"><link rel="prefetch" href="/fish-vuePress/assets/js/91.46ffb1f5.js"><link rel="prefetch" href="/fish-vuePress/assets/js/92.313cf08a.js"><link rel="prefetch" href="/fish-vuePress/assets/js/93.c2643a36.js"><link rel="prefetch" href="/fish-vuePress/assets/js/94.f3055a01.js"><link rel="prefetch" href="/fish-vuePress/assets/js/95.940056d7.js"><link rel="prefetch" href="/fish-vuePress/assets/js/96.43739845.js"><link rel="prefetch" href="/fish-vuePress/assets/js/97.e243aa4a.js"><link rel="prefetch" href="/fish-vuePress/assets/js/98.561f7a88.js"><link rel="prefetch" href="/fish-vuePress/assets/js/99.921a1c32.js">
    <link rel="stylesheet" href="/fish-vuePress/assets/css/0.styles.0de575c4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/fish-vuePress/" class="home-link router-link-active"><!----> <span class="site-name">小鱼儿的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/fish-vuePress/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/fish-vuePress/node-quick/" class="nav-link">
  node
</a></div><div class="nav-item"><a href="/fish-vuePress/webframe/" class="nav-link router-link-active">
  前端基础
</a></div><div class="nav-item"><a href="/fish-vuePress/vue-quick/" class="nav-link">
  快速掌握vue
</a></div><div class="nav-item"><a href="/fish-vuePress/database/" class="nav-link">
  数据库
</a></div><div class="nav-item"><a href="/fish-vuePress/react/" class="nav-link">
  react
</a></div><div class="nav-item"><a href="/fish-vuePress/webpack/" class="nav-link">
  webpack
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/fish-vuePress/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/fish-vuePress/node-quick/" class="nav-link">
  node
</a></div><div class="nav-item"><a href="/fish-vuePress/webframe/" class="nav-link router-link-active">
  前端基础
</a></div><div class="nav-item"><a href="/fish-vuePress/vue-quick/" class="nav-link">
  快速掌握vue
</a></div><div class="nav-item"><a href="/fish-vuePress/database/" class="nav-link">
  数据库
</a></div><div class="nav-item"><a href="/fish-vuePress/react/" class="nav-link">
  react
</a></div><div class="nav-item"><a href="/fish-vuePress/webpack/" class="nav-link">
  webpack
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/fish-vuePress/webframe/" aria-current="page" class="sidebar-link">前端</a></li><li><a href="/fish-vuePress/webframe/javascript/promise.html" class="sidebar-link">深度了解promise</a></li><li><a href="/fish-vuePress/webframe/js/regexp.html" class="sidebar-link">正则</a></li><li><a href="/fish-vuePress/webframe/js/JS2.html" class="sidebar-link">js数据类型</a></li><li><a href="/fish-vuePress/webframe/js/math.html" class="sidebar-link">前端算法</a></li><li><a href="/fish-vuePress/webframe/js/modules.html" class="sidebar-link">其他</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>javascript</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fish-vuePress/webframe/javascript/" aria-current="page" class="sidebar-link">目录</a></li><li><a href="/fish-vuePress/webframe/javascript/datatype.html" class="sidebar-link">数据类型]面试常问javascript数据类型</a></li><li><a href="/fish-vuePress/webframe/javascript/scoped.html" class="sidebar-link">[作用域]作用域于作用域链</a></li><li><a href="/fish-vuePress/webframe/javascript/closure.html" aria-current="page" class="active sidebar-link">javascript中的闭包这一篇就够了</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/javascript/closure.html#快速导航" class="sidebar-link">快速导航</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/javascript/closure.html#什么是闭包" class="sidebar-link">什么是闭包</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/javascript/closure.html#闭包的常见案例分析" class="sidebar-link">闭包的常见案例分析</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/javascript/closure.html#闭包与内存泄漏" class="sidebar-link">闭包与内存泄漏</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/javascript/closure.html#闭包的应用" class="sidebar-link">闭包的应用</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/javascript/closure.html#面试题分析" class="sidebar-link">面试题分析</a></li><li class="sidebar-sub-header"><a href="/fish-vuePress/webframe/javascript/closure.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/fish-vuePress/webframe/javascript/copy.html" class="sidebar-link">[赋值拷贝]js中赋值•浅拷贝•深拷贝</a></li><li><a href="/fish-vuePress/webframe/javascript/prototype.html" class="sidebar-link">javascript中原型链</a></li><li><a href="/fish-vuePress/webframe/javascript/this.html" class="sidebar-link">this的各种讲解</a></li><li><a href="/fish-vuePress/webframe/javascript/exports.html" class="sidebar-link">exports和module.exports的区别</a></li><li><a href="/fish-vuePress/webframe/javascript/recircleFun.html" class="sidebar-link">聊聊面试必考-递归思想与实战</a></li><li><a href="/fish-vuePress/webframe/javascript/unique.html" class="sidebar-link">js中数组去重(面试如何回答)</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>es6</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>tool</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>面试题</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="快速导航"><a href="#快速导航" class="header-anchor">#</a> 快速导航</h2> <ul><li><a href="#%E5%BF%AB%E9%80%9F%E5%AF%BC%E8%88%AA">快速导航</a></li> <li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF%E9%97%AD%E5%8C%85">什么是闭包</a></li> <li><a href="#%E9%97%AD%E5%8C%85%E7%9A%84%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90">闭包的常见案例分析</a>
- <a href="#%E6%A1%88%E4%BE%8B1-%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D">案例1-基本介绍</a>
- <a href="#%E6%A1%88%E4%BE%8B2-%E5%89%8D%E7%AB%AF%E5%AE%9E%E7%8E%B0%E7%82%B9%E5%87%BB%E4%BA%8B%E4%BB%B6">案例2-前端实现点击事件</a>
- <a href="#%E6%A1%88%E4%BE%8B3-ajax%E8%AF%B7%E6%B1%82">案例3-ajax请求</a>
- <a href="#%E6%A1%88%E4%BE%8B4-for%E5%BE%AA%E7%8E%AF%E6%A1%88%E4%BE%8B">案例4-for循环案例</a></li> <li><a href="#%E9%97%AD%E5%8C%85%E4%B8%8E%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F">闭包与内存泄漏</a></li> <li><a href="#%E9%97%AD%E5%8C%85%E7%9A%84%E5%BA%94%E7%94%A8">闭包的应用</a></li> <li><a href="#%E9%9D%A2%E8%AF%95%E9%A2%98%E5%88%86%E6%9E%90">面试题分析</a></li> <li><a href="#%E6%80%BB%E7%BB%93">总结</a></li></ul> <h2 id="什么是闭包"><a href="#什么是闭包" class="header-anchor">#</a> 什么是闭包</h2> <blockquote><p>维基百科中的概念</p></blockquote> <ul><li>在计算机科学中，闭包(也称词法闭包或函数闭包)是指一个函数或函数的引用，与一个引用环境绑定在一起，这个引用环境是一个存储该函数每个非局部变量(也叫自由变量)的表。</li> <li>闭包，不同于一般的函数，它允许一个函数在立即词法作用域外调用时，仍可访问非本地变量</li></ul> <blockquote><p>学术上</p></blockquote> <ul><li>闭包是指在 JavaScript 中，内部函数总是可以访问<strong>其所在的</strong>外部函数中声明的参数和变量，即使在其外部函数被返回return掉（寿命终结）了之后。</li></ul> <blockquote><p>个人理解</p></blockquote> <ul><li>闭包是在函数里面定义一个函数，该函数可以是匿名函数，该子函数能够读写父函数的局部变量。</li></ul> <h2 id="闭包的常见案例分析"><a href="#闭包的常见案例分析" class="header-anchor">#</a> 闭包的常见案例分析</h2> <p><strong>案例分析是从浅入深希望大家都看完!</strong></p> <h5 id="案例1-基本介绍"><a href="#案例1-基本介绍" class="header-anchor">#</a> 案例1-基本介绍</h5> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> localVal<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> localVal<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//输出30</span>


<span class="token keyword">function</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> localVal<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>localVal<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span> localVal<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> func<span class="token operator">=</span><span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//输出10</span>
</code></pre></div><p>两段代码，在第二段代码中，函数A内的匿名函数可以访问到函数A中的局部变量这就是闭包的基本使用。</p> <h5 id="案例2-前端实现点击事件"><a href="#案例2-前端实现点击事件" class="header-anchor">#</a> 案例2-前端实现点击事件</h5> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">!</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> localData<span class="token operator">=</span><span class="token string">&quot;localData here&quot;</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>localData<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>前端原始点击事件操作也用到了闭包来访问外部的局部变量。</p> <h5 id="案例3-ajax请求"><a href="#案例3-ajax请求" class="header-anchor">#</a> 案例3-ajax请求</h5> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">!</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> localData<span class="token operator">=</span><span class="token string">&quot;localData here&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> url<span class="token operator">=</span><span class="token string">&quot;http://www.baidu.com&quot;</span><span class="token punctuation">;</span>
    $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      url<span class="token operator">:</span>url<span class="token punctuation">,</span>
      <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token comment">//do sth...</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>localData<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在ajax请求的方法中也用到了闭包，访问外部的局部变量。</p> <h5 id="案例4-for循环案例"><a href="#案例4-for循环案例" class="header-anchor">#</a> 案例4-for循环案例</h5> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> arrays <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    arrays<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'&gt;&gt;&gt; '</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//all are 3</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>上面的这段代码，刚看了代码一定会以为陆续打印出1，2，3，实际输出的是3，3，3，出现这种情况的原因是<strong>匿名函数保存的是引用</strong>，当for循环结束的时候，i已经变成3了，所以打印的时候变成3。出现这种情况的解决办法是利用闭包解决问题。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        tasks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'&gt;&gt;&gt; '</span> <span class="token operator">+</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>闭包里的匿名函数</strong>，读取变量的顺序，先读取本地变量，再读取父函数的局部变量，如果找不到到全局里面搜索，<strong>i作为局部变量存到闭包里面</strong>，所以调整后的代码可以能正常打印1，2，3。</p> <h2 id="闭包与内存泄漏"><a href="#闭包与内存泄漏" class="header-anchor">#</a> 闭包与内存泄漏</h2> <ul><li>javascript回收后内存的方式:</li></ul> <p>javascript的主要通过计数器方式回收内存，假设有a，b，c三个对象，当a引用b的时候，那么b的引用计算器增加1(通俗的说用到那个对象哪个对象引用计算器增加1)，同时b引用c的时候，c引用计数器增加1，当a被释放的时候，b的引用计数器减少1，变成0的时候这个对象被释放，c计数器变成0，被释放,但是当遇到b和c之间互相引用的时候，无法通过计数器方式释放内存。</p> <ul><li>闭包可以导致上面所说b和c互相引用无法释放内存
第一个案例的代码拿过来分析：</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> localVal<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>localVal<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span> localVal<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> func<span class="token operator">=</span><span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//输出10</span>
</code></pre></div><p>当A函数结束的时候，想要释放，发现它的localVal变量被匿名函数引用，所有A函数无法释放，导致内存泄漏。但是也有好处，闭包正是可以做到这一点，因为它不会释放外部的引用，从而函数内部的值可以得以保留。</p> <p>说明:闭包不代表一定会带来内存泄漏，良好的使用闭包是不会造成内存泄漏的。</p> <h2 id="闭包的应用"><a href="#闭包的应用" class="header-anchor">#</a> 闭包的应用</h2> <ul><li>封装</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> <span class="token function-variable function">person</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    
    <span class="token comment">//变量作用域为函数内部，外部无法访问    </span>
    <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">;</span>       
       
    <span class="token keyword">return</span> <span class="token punctuation">{</span>    
       <span class="token function-variable function">getName</span> <span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    
           <span class="token keyword">return</span> name<span class="token punctuation">;</span>    
       <span class="token punctuation">}</span><span class="token punctuation">,</span>    
       <span class="token function-variable function">setName</span> <span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">newName</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    
           name <span class="token operator">=</span> newName<span class="token punctuation">;</span>    
       <span class="token punctuation">}</span>    
    <span class="token punctuation">}</span>    
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
     
<span class="token function">print</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//直接访问，结果为undefined    </span>
<span class="token function">print</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
person<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;kaola&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
<span class="token function">print</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
   
得到结果如下：  
   
<span class="token keyword">undefined</span>  
<span class="token keyword">default</span>  
kaola
</code></pre></div><ul><li>实例中的for循环另一种形式</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>doucument<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML<span class="token operator">=</span><span class="token string">&quot;&lt;div id=div1&gt;aaa&lt;/div&gt;&quot;</span><span class="token operator">+</span><span class="token string">&quot;&lt;div id=div2&gt;bbb&lt;/div&gt;&quot;</span><span class="token operator">+</span><span class="token string">&quot;&lt;div id=div3&gt;ccc&lt;/div&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">4</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token operator">!</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           <span class="token function">alert</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1,2,3 </span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>结果缓存</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> CachedSearchBox <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    
    <span class="token keyword">var</span> cache <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    
       count <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    
    <span class="token keyword">return</span> <span class="token punctuation">{</span>    
       <span class="token function-variable function">attachSearchBox</span> <span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">dsid</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    
           <span class="token keyword">if</span><span class="token punctuation">(</span>dsid <span class="token keyword">in</span> cache<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//如果结果在缓存中    </span>
              <span class="token keyword">return</span> cache<span class="token punctuation">[</span>dsid<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//直接返回缓存中的对象    </span>
           <span class="token punctuation">}</span>    
           <span class="token keyword">var</span> fsb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">uikit<span class="token punctuation">.</span>webctrl<span class="token punctuation">.</span>SearchBox</span><span class="token punctuation">(</span>dsid<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//新建    </span>
           cache<span class="token punctuation">[</span>dsid<span class="token punctuation">]</span> <span class="token operator">=</span> fsb<span class="token punctuation">;</span><span class="token comment">//更新缓存    </span>
           <span class="token keyword">if</span><span class="token punctuation">(</span>count<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//保正缓存的大小&lt;=100    </span>
              <span class="token keyword">delete</span> cache<span class="token punctuation">[</span>count<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    
           <span class="token punctuation">}</span>    
           <span class="token keyword">return</span> fsb<span class="token punctuation">;</span>          
       <span class="token punctuation">}</span><span class="token punctuation">,</span>    
     
       <span class="token function-variable function">clearSearchBox</span> <span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">dsid</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    
           <span class="token keyword">if</span><span class="token punctuation">(</span>dsid <span class="token keyword">in</span> cache<span class="token punctuation">)</span><span class="token punctuation">{</span>    
              cache<span class="token punctuation">[</span>dsid<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">clearSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      
           <span class="token punctuation">}</span>    
       <span class="token punctuation">}</span>    
    <span class="token punctuation">}</span><span class="token punctuation">;</span>    
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
     
CachedSearchBox<span class="token punctuation">.</span><span class="token function">attachSearchBox</span><span class="token punctuation">(</span><span class="token string">&quot;input&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>说明：开发中会碰到很多情况，设想我们有一个处理过程很耗时的函数对象，每次调用都会花费很长时间，那么我们就需要将计算出来的值存储起来，当调用这个函数的时候，首先在缓存中查找，如果找不到，则进行计算，然后更新缓存并返回值，如果找到了，直接返回查找到的值即可。闭包正是可以做到这一点，因为它不会释放外部的引用，从而函数内部的值可以得以保留。</p> <h2 id="面试题分析"><a href="#面试题分析" class="header-anchor">#</a> 面试题分析</h2> <p>闭包测试题: 求输出结果</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token parameter">n<span class="token punctuation">,</span>o</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">fun</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">m</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//[2]</span>
            <span class="token keyword">return</span> <span class="token function">fun</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[1]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> a<span class="token operator">=</span><span class="token function">fun</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
a<span class="token punctuation">.</span><span class="token function">fun</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
a<span class="token punctuation">.</span><span class="token function">fun</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
a<span class="token punctuation">.</span><span class="token function">fun</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> b<span class="token operator">=</span><span class="token function">fun</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fun</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fun</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fun</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> c<span class="token operator">=</span><span class="token function">fun</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fun</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
c<span class="token punctuation">.</span><span class="token function">fun</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
c<span class="token punctuation">.</span><span class="token function">fun</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>由于分析内容比较多，大家可直接参考这篇文章
https://cnodejs.org/topic/567ed16eaacb6923221de48f</p> <p>分析内容说明，在看这篇文章的时候，注意两点可能会看的更明白：</p> <ul><li>JS的词法作用域,JS变量作用域存在于函数体中即函数体，并且变量的作用域是在函数定义声明的时候就是确定的，而非在函数运行时。</li> <li>在JS中调用函数的时候，如果用一个参数的方法调用两个参数的方法，这时候只是第二个参数未定义，代码不会报错停止运行，正常流程往下走，像面试题中仍然会返回一个对象。</li></ul> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <ol><li>闭包其实是在函数内部定义一个函数。</li> <li>闭包在使用的时候不会释放<strong>外部的引用</strong>，闭包函数内部的值会得到保留。</li> <li>闭包里面的匿名函数，读取变量的顺序，先读取本地变量，再读取父函数的局部变量。</li> <li>对于闭包外部无法引用它内部的变量，因此<strong>在函数内部创建的变量</strong>执行完后会立刻释放资源，不污染全局对象。</li> <li>闭包使用的时候要考虑到内存泄漏，因为不释放<strong>外部引用</strong>，但是合理的使用闭包是内存使用不是内存泄漏。</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/fish-vuePress/webframe/javascript/scoped.html" class="prev">
        [作用域]作用域于作用域链
      </a></span> <span class="next"><a href="/fish-vuePress/webframe/javascript/copy.html">
        [赋值拷贝]js中赋值•浅拷贝•深拷贝
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/fish-vuePress/assets/js/app.e38c1a38.js" defer></script><script src="/fish-vuePress/assets/js/4.47c64f60.js" defer></script><script src="/fish-vuePress/assets/js/123.b45ae2a4.js" defer></script>
  </body>
</html>
